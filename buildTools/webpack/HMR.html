<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Zohnny前端小册</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Zohnny前端小册">
    
    <link rel="preload" href="/assets/css/0.styles.9a0b0289.css" as="style"><link rel="preload" href="/assets/js/app.e8c3aa62.js" as="script"><link rel="preload" href="/assets/js/2.1d5e0d04.js" as="script"><link rel="preload" href="/assets/js/17.f8c4932c.js" as="script"><link rel="prefetch" href="/assets/js/10.0bc17075.js"><link rel="prefetch" href="/assets/js/100.194dcfa0.js"><link rel="prefetch" href="/assets/js/101.f8977d49.js"><link rel="prefetch" href="/assets/js/102.68d460f2.js"><link rel="prefetch" href="/assets/js/103.3ac580e7.js"><link rel="prefetch" href="/assets/js/104.9d4751c7.js"><link rel="prefetch" href="/assets/js/105.a5f0c700.js"><link rel="prefetch" href="/assets/js/106.e56dcf3c.js"><link rel="prefetch" href="/assets/js/107.1f1c30b4.js"><link rel="prefetch" href="/assets/js/108.68ca0fc6.js"><link rel="prefetch" href="/assets/js/109.50ce68c2.js"><link rel="prefetch" href="/assets/js/11.979bcc85.js"><link rel="prefetch" href="/assets/js/110.f56975a0.js"><link rel="prefetch" href="/assets/js/111.52d900c7.js"><link rel="prefetch" href="/assets/js/112.00424531.js"><link rel="prefetch" href="/assets/js/113.ea237985.js"><link rel="prefetch" href="/assets/js/114.57f07f83.js"><link rel="prefetch" href="/assets/js/115.ec061508.js"><link rel="prefetch" href="/assets/js/116.944ac05b.js"><link rel="prefetch" href="/assets/js/117.51a3bd3d.js"><link rel="prefetch" href="/assets/js/118.b1708a32.js"><link rel="prefetch" href="/assets/js/119.547f729e.js"><link rel="prefetch" href="/assets/js/12.f7837a85.js"><link rel="prefetch" href="/assets/js/120.77b77710.js"><link rel="prefetch" href="/assets/js/121.a6f28bc6.js"><link rel="prefetch" href="/assets/js/13.8e015820.js"><link rel="prefetch" href="/assets/js/14.34a558be.js"><link rel="prefetch" href="/assets/js/15.60fac476.js"><link rel="prefetch" href="/assets/js/16.be05c3ca.js"><link rel="prefetch" href="/assets/js/18.5e0519af.js"><link rel="prefetch" href="/assets/js/19.db909a84.js"><link rel="prefetch" href="/assets/js/20.8cc2df06.js"><link rel="prefetch" href="/assets/js/21.f4b0b435.js"><link rel="prefetch" href="/assets/js/22.d559c9b3.js"><link rel="prefetch" href="/assets/js/23.74ba9f22.js"><link rel="prefetch" href="/assets/js/24.2a4117e9.js"><link rel="prefetch" href="/assets/js/25.73c08c20.js"><link rel="prefetch" href="/assets/js/26.c19cc994.js"><link rel="prefetch" href="/assets/js/27.81cd809b.js"><link rel="prefetch" href="/assets/js/28.6791b309.js"><link rel="prefetch" href="/assets/js/29.391ab5ba.js"><link rel="prefetch" href="/assets/js/3.1efbb513.js"><link rel="prefetch" href="/assets/js/30.0b1d7a71.js"><link rel="prefetch" href="/assets/js/31.1f2bb083.js"><link rel="prefetch" href="/assets/js/32.cae2775b.js"><link rel="prefetch" href="/assets/js/33.1e9405be.js"><link rel="prefetch" href="/assets/js/34.9210faf9.js"><link rel="prefetch" href="/assets/js/35.2ac222fd.js"><link rel="prefetch" href="/assets/js/36.c1aa7d10.js"><link rel="prefetch" href="/assets/js/37.47ed6a00.js"><link rel="prefetch" href="/assets/js/38.0743fb65.js"><link rel="prefetch" href="/assets/js/39.f1abc33e.js"><link rel="prefetch" href="/assets/js/4.c29c9b60.js"><link rel="prefetch" href="/assets/js/40.4c2c9b8b.js"><link rel="prefetch" href="/assets/js/41.f38fd71e.js"><link rel="prefetch" href="/assets/js/42.59cc5e7a.js"><link rel="prefetch" href="/assets/js/43.54713365.js"><link rel="prefetch" href="/assets/js/44.cc7cdb87.js"><link rel="prefetch" href="/assets/js/45.cdc6ea0c.js"><link rel="prefetch" href="/assets/js/46.2ab8048b.js"><link rel="prefetch" href="/assets/js/47.f6a00ea3.js"><link rel="prefetch" href="/assets/js/48.8349de8f.js"><link rel="prefetch" href="/assets/js/49.98c2ddda.js"><link rel="prefetch" href="/assets/js/5.40944f1c.js"><link rel="prefetch" href="/assets/js/50.425c325b.js"><link rel="prefetch" href="/assets/js/51.b4870e91.js"><link rel="prefetch" href="/assets/js/52.aef0d698.js"><link rel="prefetch" href="/assets/js/53.e07d00ac.js"><link rel="prefetch" href="/assets/js/54.b7687687.js"><link rel="prefetch" href="/assets/js/55.65cf97ed.js"><link rel="prefetch" href="/assets/js/56.3444efc3.js"><link rel="prefetch" href="/assets/js/57.5377eb7e.js"><link rel="prefetch" href="/assets/js/58.e5099448.js"><link rel="prefetch" href="/assets/js/59.d09bc881.js"><link rel="prefetch" href="/assets/js/6.732df0ed.js"><link rel="prefetch" href="/assets/js/60.eba8f995.js"><link rel="prefetch" href="/assets/js/61.bd8ab09f.js"><link rel="prefetch" href="/assets/js/62.0bd4e7fc.js"><link rel="prefetch" href="/assets/js/63.640df805.js"><link rel="prefetch" href="/assets/js/64.35c8b8f7.js"><link rel="prefetch" href="/assets/js/65.affde9cb.js"><link rel="prefetch" href="/assets/js/66.9f8cabb6.js"><link rel="prefetch" href="/assets/js/67.00890bbe.js"><link rel="prefetch" href="/assets/js/68.0936ba21.js"><link rel="prefetch" href="/assets/js/69.a33cdaf9.js"><link rel="prefetch" href="/assets/js/7.31bb07dc.js"><link rel="prefetch" href="/assets/js/70.1df3e127.js"><link rel="prefetch" href="/assets/js/71.f4124ef5.js"><link rel="prefetch" href="/assets/js/72.01e6c977.js"><link rel="prefetch" href="/assets/js/73.b07f15a4.js"><link rel="prefetch" href="/assets/js/74.f72cdef2.js"><link rel="prefetch" href="/assets/js/75.ee885b7d.js"><link rel="prefetch" href="/assets/js/76.84c918df.js"><link rel="prefetch" href="/assets/js/77.a28fd7f5.js"><link rel="prefetch" href="/assets/js/78.482bfb70.js"><link rel="prefetch" href="/assets/js/79.091c9dbf.js"><link rel="prefetch" href="/assets/js/8.c0da64f7.js"><link rel="prefetch" href="/assets/js/80.df33fddc.js"><link rel="prefetch" href="/assets/js/81.6e6db080.js"><link rel="prefetch" href="/assets/js/82.e9138597.js"><link rel="prefetch" href="/assets/js/83.31c363ff.js"><link rel="prefetch" href="/assets/js/84.1e1be0f3.js"><link rel="prefetch" href="/assets/js/85.c861f43f.js"><link rel="prefetch" href="/assets/js/86.5a205712.js"><link rel="prefetch" href="/assets/js/87.d9dc3fb3.js"><link rel="prefetch" href="/assets/js/88.4297aa82.js"><link rel="prefetch" href="/assets/js/89.0a4430b5.js"><link rel="prefetch" href="/assets/js/9.0c30cda9.js"><link rel="prefetch" href="/assets/js/90.c95ae974.js"><link rel="prefetch" href="/assets/js/91.ff322a2a.js"><link rel="prefetch" href="/assets/js/92.6272aacc.js"><link rel="prefetch" href="/assets/js/93.f34792ac.js"><link rel="prefetch" href="/assets/js/94.5cd9fa78.js"><link rel="prefetch" href="/assets/js/95.4c0963b8.js"><link rel="prefetch" href="/assets/js/96.4b8520b9.js"><link rel="prefetch" href="/assets/js/97.cdf1abbd.js"><link rel="prefetch" href="/assets/js/98.4d55767c.js"><link rel="prefetch" href="/assets/js/99.0a1d65d6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9a0b0289.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Zohnny前端小册</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/basic/basic/" class="nav-link">
  基础
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  css
</a></div><div class="nav-item"><a href="/browser/theory/" class="nav-link">
  浏览器相关
</a></div><div class="nav-item"><a href="/nodejs/" class="nav-link">
  nodejs
</a></div><div class="nav-item"><a href="/babel/" class="nav-link">
  babel
</a></div><div class="nav-item"><a href="/buildTools/webpack/" class="nav-link router-link-active">
  打包工具
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue/reactive/" class="nav-link">
  响应式
</a></li><li class="dropdown-item"><!----> <a href="/vue/compiler/" class="nav-link">
  模版编译
</a></li><li class="dropdown-item"><!----> <a href="/vue/vnode/" class="nav-link">
  虚拟DOM
</a></li><li class="dropdown-item"><!----> <a href="/vue/whole-process/" class="nav-link">
  整体流程
</a></li><li class="dropdown-item"><!----> <a href="/vue/vuex/" class="nav-link">
  Vuex&amp;Vue-router
</a></li></ul></div></div><div class="nav-item"><a href="/mobile/" class="nav-link">
  移动端
</a></div><div class="nav-item"><a href="/code-reviews/" class="nav-link">
  LC
</a></div><div class="nav-item"><a href="/project/B/batch_download.html" class="nav-link">
  项目
</a></div><div class="nav-item"><a href="/news/vue3.html" class="nav-link">
  前沿
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://0zcl.github.io/utils-library/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  公共函数库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://0zcl.github.io/h5-sdk/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  h5-sdk
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/0zcl/h5_template" target="_blank" rel="noopener noreferrer" class="nav-link external">
  移动端多页面模版
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/0zcl/zcl-mobile-ui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  移动端组件库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://gitlab.61info.com:8190/zcl/tpc-cli" target="_blank" rel="noopener noreferrer" class="nav-link external">
  zcl脚手架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/Dachuizi-6" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/basic/basic/" class="nav-link">
  基础
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  css
</a></div><div class="nav-item"><a href="/browser/theory/" class="nav-link">
  浏览器相关
</a></div><div class="nav-item"><a href="/nodejs/" class="nav-link">
  nodejs
</a></div><div class="nav-item"><a href="/babel/" class="nav-link">
  babel
</a></div><div class="nav-item"><a href="/buildTools/webpack/" class="nav-link router-link-active">
  打包工具
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue/reactive/" class="nav-link">
  响应式
</a></li><li class="dropdown-item"><!----> <a href="/vue/compiler/" class="nav-link">
  模版编译
</a></li><li class="dropdown-item"><!----> <a href="/vue/vnode/" class="nav-link">
  虚拟DOM
</a></li><li class="dropdown-item"><!----> <a href="/vue/whole-process/" class="nav-link">
  整体流程
</a></li><li class="dropdown-item"><!----> <a href="/vue/vuex/" class="nav-link">
  Vuex&amp;Vue-router
</a></li></ul></div></div><div class="nav-item"><a href="/mobile/" class="nav-link">
  移动端
</a></div><div class="nav-item"><a href="/code-reviews/" class="nav-link">
  LC
</a></div><div class="nav-item"><a href="/project/B/batch_download.html" class="nav-link">
  项目
</a></div><div class="nav-item"><a href="/news/vue3.html" class="nav-link">
  前沿
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://0zcl.github.io/utils-library/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  公共函数库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://0zcl.github.io/h5-sdk/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  h5-sdk
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/0zcl/h5_template" target="_blank" rel="noopener noreferrer" class="nav-link external">
  移动端多页面模版
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/0zcl/zcl-mobile-ui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  移动端组件库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://gitlab.61info.com:8190/zcl/tpc-cli" target="_blank" rel="noopener noreferrer" class="nav-link external">
  zcl脚手架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/Dachuizi-6" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webpack基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>webpack深入</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/buildTools/webpack/source.html" class="sidebar-link">源码深入</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/buildTools/webpack/source.html#webpack5-启动流程源码分析" class="sidebar-link">webpack5 启动流程源码分析</a></li><li class="sidebar-sub-header"><a href="/buildTools/webpack/source.html#webpack核心模块tapable用法简析" class="sidebar-link">webpack核心模块tapable用法简析</a></li><li class="sidebar-sub-header"><a href="/buildTools/webpack/source.html#webpack工作流程" class="sidebar-link">webpack工作流程</a></li></ul></li><li><a href="/buildTools/webpack/zcl-pack.html" class="sidebar-link">手写简易webpack</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/buildTools/webpack/zcl-pack.html#流程" class="sidebar-link">流程</a></li><li class="sidebar-sub-header"><a href="/buildTools/webpack/zcl-pack.html#代码解析" class="sidebar-link">代码解析</a></li></ul></li><li><a href="/buildTools/webpack/loader.html" class="sidebar-link">webpack-loader机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/buildTools/webpack/loader.html#loader介绍" class="sidebar-link">loader介绍</a></li><li class="sidebar-sub-header"><a href="/buildTools/webpack/loader.html#面试" class="sidebar-link">面试</a></li></ul></li><li><a href="/buildTools/webpack/plugin.html" class="sidebar-link">webpack-插件机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/buildTools/webpack/plugin.html#plugin介绍" class="sidebar-link">plugin介绍</a></li><li class="sidebar-sub-header"><a href="/buildTools/webpack/plugin.html#面试" class="sidebar-link">面试</a></li></ul></li><li><a href="/buildTools/webpack/__webpack_require__.html" class="sidebar-link">webpack 模块加载原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/buildTools/webpack/__webpack_require__.html#commonjs-规范" class="sidebar-link">CommonJS 规范</a></li><li class="sidebar-sub-header"><a href="/buildTools/webpack/__webpack_require__.html#es6-module" class="sidebar-link">ES6 module</a></li><li class="sidebar-sub-header"><a href="/buildTools/webpack/__webpack_require__.html#webpack-require-r" class="sidebar-link">_webpackrequire__.r()</a></li><li class="sidebar-sub-header"><a href="/buildTools/webpack/__webpack_require__.html#webpack-require-o" class="sidebar-link">_webpackrequire__.o()</a></li><li class="sidebar-sub-header"><a href="/buildTools/webpack/__webpack_require__.html#webpack-require-d" class="sidebar-link">_webpackrequire__.d()</a></li><li class="sidebar-sub-header"><a href="/buildTools/webpack/__webpack_require__.html#export-default本质" class="sidebar-link">export default本质</a></li><li class="sidebar-sub-header"><a href="/buildTools/webpack/__webpack_require__.html#webpack-require-n" class="sidebar-link">_webpackrequire__.n()</a></li><li class="sidebar-sub-header"><a href="/buildTools/webpack/__webpack_require__.html#按需加载" class="sidebar-link">按需加载</a></li></ul></li><li><a href="/buildTools/webpack/lazy-load.html" class="sidebar-link">懒加载(未完全理解)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/buildTools/webpack/lazy-load.html#分析" class="sidebar-link">分析</a></li><li class="sidebar-sub-header"><a href="/buildTools/webpack/lazy-load.html#webpack-require-e" class="sidebar-link">_webpackrequire__.e</a></li><li class="sidebar-sub-header"><a href="/buildTools/webpack/lazy-load.html#webpackjsonpcallback" class="sidebar-link">webpackJsonpCallback</a></li><li class="sidebar-sub-header"><a href="/buildTools/webpack/lazy-load.html#总结-webpack懒加载原理" class="sidebar-link">总结：webpack懒加载原理</a></li></ul></li><li><a href="/buildTools/webpack/HMR.html" aria-current="page" class="active sidebar-link">热更新原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/buildTools/webpack/HMR.html#websocket" class="sidebar-link">websocket</a></li><li class="sidebar-sub-header"><a href="/buildTools/webpack/HMR.html#热更新实现" class="sidebar-link">热更新实现</a></li><li class="sidebar-sub-header"><a href="/buildTools/webpack/HMR.html#源码解析" class="sidebar-link">源码解析</a></li><li class="sidebar-sub-header"><a href="/buildTools/webpack/HMR.html#一、webpack-dev-server启动本地服务" class="sidebar-link">一、webpack-dev-server启动本地服务</a></li><li class="sidebar-sub-header"><a href="/buildTools/webpack/HMR.html#二、修改webpack-config-js的entry配置" class="sidebar-link">二、修改webpack.config.js的entry配置</a></li><li class="sidebar-sub-header"><a href="/buildTools/webpack/HMR.html#三、监听webpack编译结束" class="sidebar-link">三、监听webpack编译结束</a></li><li class="sidebar-sub-header"><a href="/buildTools/webpack/HMR.html#四、webpack监听文件变化" class="sidebar-link">四、webpack监听文件变化</a></li><li class="sidebar-sub-header"><a href="/buildTools/webpack/HMR.html#五、浏览器接收到热更新的通知" class="sidebar-link">五、浏览器接收到热更新的通知</a></li><li class="sidebar-sub-header"><a href="/buildTools/webpack/HMR.html#面试" class="sidebar-link">面试</a></li></ul></li><li><a href="/buildTools/webpack/proxy.html" class="sidebar-link">webpack proxy原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/buildTools/webpack/proxy.html#webpack-proxy原理" class="sidebar-link">webpack proxy原理</a></li><li class="sidebar-sub-header"><a href="/buildTools/webpack/proxy.html#跨域" class="sidebar-link">跨域</a></li><li class="sidebar-sub-header"><a href="/buildTools/webpack/proxy.html#总结" class="sidebar-link">总结</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>杂</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>webpack、webpack-cli、webpack-dev-server、webpack-dev-middleware版本如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string-property property">&quot;webpack&quot;</span><span class="token operator">:</span> <span class="token string">&quot;5.11.1&quot;</span><span class="token punctuation">,</span>
<span class="token string-property property">&quot;webpack-cli&quot;</span><span class="token operator">:</span> <span class="token string">&quot;4.3.1&quot;</span><span class="token punctuation">,</span>
<span class="token string-property property">&quot;webpack-dev-server&quot;</span><span class="token operator">:</span> <span class="token string">&quot;3.11.1&quot;</span>
<span class="token string-property property">&quot;webpack-dev-middleware&quot;</span><span class="token operator">:</span> <span class="token string">&quot;3.7.2&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="websocket"><a href="#websocket" class="header-anchor">#</a> websocket</h2> <p>有了HTTP协议，为什么还需要<code>WebSocket</code>?</p> <p>答：HTTP 协议有一个缺陷：通信只能由客户端发起</p> <p>WebSoket特点：服务器可以主动向客户端推送信息，客户端也可以主动向服务器发送信息</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">&quot;wss://echo.websocket.org&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 实例对象的onopen属性，用于指定连接成功后的回调函数</span>
ws<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Connection open ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;Hello WebSockets!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 实例对象的onmessage属性，用于指定收到服务器数据后的回调函数</span>
ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&quot;Received Message: &quot;</span> <span class="token operator">+</span> evt<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  ws<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 实例对象的onclose属性，用于指定连接关闭后的回调函数</span>
ws<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Connection closed.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 输出：</span>
<span class="token comment">// &quot;Connection open ...&quot;</span>
<span class="token comment">// &quot;Received Message: Hello WebSockets!&quot;</span>
<span class="token comment">// &quot;Connection closed.&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><img src="data:image/png;base64,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" alt="socket"></p> <h2 id="热更新实现"><a href="#热更新实现" class="header-anchor">#</a> 热更新实现</h2> <p>HMR作为一个Webpack内置的功能，可以通过HotModuleReplacementPlugin或--hot开启</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">hot</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>项目启动后，进行构建打包，控制台会输出构建过程，我们可以观察到生成了一个 Hash值：<code>a93fd735d02d98633356</code></p> <p><img src="/assets/img/28.c3afe33a.png" alt="hash"></p> <p>在我们每次修改代码保存后，控制台都会出现 Compiling…字样，触发新的编译中...可以在控制台中观察到：</p> <ul><li>新的Hash值：a61bdd6e82294ed06fa3</li> <li>新的json文件： a93fd735d02d98633356.hot-update.json</li> <li>新的js文件：index.a93fd735d02d98633356.hot-update.js</li></ul> <p><img src="/assets/img/29.e6a6a3d8.png" alt="hash"></p> <p>结论：上次输出的<code>Hash</code>会作为本次编译新生成的文件标识，本次输出的<code>Hash</code>会作为下次热更新的标识</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">openPhotoAlbum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>appSDK<span class="token punctuation">.</span><span class="token function">openPhotoAlbum</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'res'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token comment">// </span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 更改后</span>
<span class="token function">openPhotoAlbum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>appSDK<span class="token punctuation">.</span><span class="token function">openPhotoAlbum</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'res2'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token comment">// </span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>更改Vue文件openPhotoAlbum方法的打印语句，保存文件后，从webpack服务的打印可知，此时HMR热更新产生了两个新文件<code>main.1925dbfa6ec6ac69aef2.hot-update.js</code>、<code>main.1925dbfa6ec6ac69aef2.hot-update.json</code></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>asset main<span class="token punctuation">.</span>1925dbfa6ec6ac69aef2<span class="token punctuation">.</span>hot<span class="token operator">-</span>update<span class="token punctuation">.</span>js <span class="token number">12.5</span> KiB <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span> <span class="token punctuation">[</span>immutable<span class="token punctuation">]</span> <span class="token punctuation">[</span>hmr<span class="token punctuation">]</span> <span class="token punctuation">(</span>name<span class="token punctuation">:</span> main<span class="token punctuation">)</span>
asset index<span class="token punctuation">.</span>html <span class="token number">771</span> <span class="token builtin">bytes</span> <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
asset main<span class="token punctuation">.</span>1925dbfa6ec6ac69aef2<span class="token punctuation">.</span>hot<span class="token operator">-</span>update<span class="token punctuation">.</span>json <span class="token number">28</span> <span class="token builtin">bytes</span> <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span> <span class="token punctuation">[</span>immutable<span class="token punctuation">]</span> <span class="token punctuation">[</span>hmr<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>接下来看看浏览器怎么处理热更新的</p> <ol><li>浏览器的<code>WebSocket</code>服务，接收到本次热更新产生的Hash <code>3ba7245632a597574ef3</code> <img src="/assets/img/30.b1e0510e.png" alt="hash"></li> <li>浏览器判断本次接收的Hash，如果与上次相同，则代表本次编译没修改文件；如果与上次Hash不同，则请求.json和.js文件
<img src="/assets/img/31.80c287a6.png" alt="json"></li></ol> <ul><li>c 表示当前要热更新的文件对应的是main模块</li> <li>js文件：是本次修改的代码。格式化并删除部分代码后显示如下，js是要更新的模块, 也使用了<code>JSONP</code>原理</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// main.1925dbfa6ec6ac69aef2.hot-update.js</span>
self<span class="token punctuation">[</span><span class="token string">&quot;webpackHotUpdate_i61_h5_sdk&quot;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">&quot;main&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string-property property">&quot;./node_modules/babel-loader/lib/index.js!./node_modules/vue-loader/lib/index.js??vue-loader-options!./example/src/API.vue?vue&amp;type=script&amp;lang=js&amp;&quot;</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>
    <span class="token parameter">module<span class="token punctuation">,</span>
    exports<span class="token punctuation">,</span>
    __webpack_require__</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> _Object$defineProperty <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span>
      <span class="token comment">/*! @babel/runtime-corejs3/core-js-stable/object/define-property */</span> <span class="token string">&quot;./node_modules/@babel/runtime-corejs3/core-js-stable/object/define-property.js&quot;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">_Object$defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">&quot;__esModule&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    exports<span class="token punctuation">.</span>default <span class="token operator">=</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> _default <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">data</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">openPhotoAlbum</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">openPhotoAlbum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>appSDK<span class="token punctuation">.</span><span class="token function">openPhotoAlbum</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'res2'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    exports<span class="token punctuation">.</span>default <span class="token operator">=</span> _default<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h2 id="源码解析"><a href="#源码解析" class="header-anchor">#</a> 源码解析</h2> <ul><li>浏览器是如何知道本地代码重新编译了，并迅速请求了新生成的文件？
答：derServer会通过compiler的done钩子来监听webpack的编译结束，只要编译结束就触发钩子，通过websocket给浏览器发送通知。浏览器拿到本次编译产生的Hash，如果与上次相同，则代表本次编译没修改文件；如果与上次Hash不同，则请求.json和.js文件</li> <li>是谁告知了浏览器？
答：编译结束后，本地的WebSocket服务给浏览器发通知，ok和hash事件，浏览器就可以拿到本次编译产生的Hash</li></ul> <p>带着疑问来看源码吧</p> <h2 id="一、webpack-dev-server启动本地服务"><a href="#一、webpack-dev-server启动本地服务" class="header-anchor">#</a> 一、webpack-dev-server启动本地服务</h2> <p>webpack-dev-server的package.json中的bin命令，可以找到命令的入口文件bin/webpack-dev-server.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// node_modules/webpack-dev-server/bin/webpack-dev-server.js</span>
<span class="token comment">// 生成webpack编译主引擎 compiler</span>
<span class="token keyword">let</span> compiler <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 启动本地服务</span>
<span class="token keyword">let</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Server</span><span class="token punctuation">(</span>compiler<span class="token punctuation">,</span> options<span class="token punctuation">,</span> log<span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>port<span class="token punctuation">,</span> options<span class="token punctuation">.</span>host<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">throw</span> err<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>看看new Server做了啥</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// node_modules/webpack-dev-server/lib/Server.js</span>
<span class="token keyword">class</span> <span class="token class-name">Server</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setupApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">setupApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 依赖了express</span>
    	<span class="token keyword">this</span><span class="token punctuation">.</span>app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>listeningApp <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">listen</span><span class="token punctuation">(</span><span class="token parameter">port<span class="token punctuation">,</span> hostname<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>listeningApp<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> hostname<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// 启动express服务后，启动websocket服务</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createSocketServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>                                   
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><ol><li>启动webpack, 生成compiler实例。compiler上有很多方法，比如可以启动 webpack 所有编译工作，以及监听本地文件的变化。</li> <li>使用express框架启动本地server，让浏览器可以请求本地的静态资源。</li> <li>本地server启动之后，再去启动websocket服务。通过websocket，可以建立本地服务和浏览器的双向通信。</li></ol> <h2 id="二、修改webpack-config-js的entry配置"><a href="#二、修改webpack-config-js的entry配置" class="header-anchor">#</a> 二、修改webpack.config.js的entry配置</h2> <p>启动本地服务前，调用了<code>updateCompiler -&gt; updateCompiler -&gt; addEntries</code>，addEntries中有2 段关键性代码。一个是获取websocket客户端代码路径，另一个是根据配置获取webpack热更新代码路径。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// node_modules/webpack-dev-server/lib/Server.js</span>
<span class="token function">updateCompiler</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>compiler<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// node_modules/webpack-dev-server/utils/updateCompiler.js</span>
<span class="token function">addEntries</span><span class="token punctuation">(</span>webpackConfig<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// node_modules/webpack-dev-server/lib/utils/addEntries.js</span>
<span class="token keyword">const</span> clientEntry <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>
  <span class="token string">'../../client/'</span>
<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>domain<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sockHost<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sockPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sockPort<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

<span class="token comment">/** @type {(string[] | string)} */</span>
<span class="token keyword">let</span> hotEntry<span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>hotOnly<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  hotEntry <span class="token operator">=</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'webpack/hot/only-dev-server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  hotEntry <span class="token operator">=</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'webpack/hot/dev-server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>修改后的webpack入口配置如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 修改后的entry入口</span>
<span class="token punctuation">{</span> <span class="token literal-property property">entry</span><span class="token operator">:</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">index</span><span class="token operator">:</span> 
        <span class="token punctuation">[</span>
            <span class="token comment">// 上面获取的clientEntry</span>
            <span class="token string">'xxx/node_modules/webpack-dev-server/client/index.js?http://localhost:8080'</span><span class="token punctuation">,</span>
            <span class="token comment">// 上面获取的hotEntry</span>
            <span class="token string">'xxx/node_modules/webpack/hot/dev-server.js'</span><span class="token punctuation">,</span>
            <span class="token comment">// 开发配置的入口</span>
            <span class="token string">'./src/index.js'</span>
    	<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>      
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>为什么要新增了 2 个文件？在入口默默增加了 2 个文件，那就意味会一同打包到bundle文件中去。</p> <h3 id="webpack-dev-server-client-index-js"><a href="#webpack-dev-server-client-index-js" class="header-anchor">#</a> webpack-dev-server/client/index.js</h3> <p>第 1 步 webpack-dev-server初始化 的过程中，启动的是本地服务端的websocket。那客户端也就是我们的浏览器, 因此需要把websocket客户端通信代码塞到bundle文件中</p> <h3 id="webpack-hot-dev-server-js"><a href="#webpack-hot-dev-server-js" class="header-anchor">#</a> webpack/hot/dev-server.js</h3> <p>要是用于检查更新逻辑的 ？？？ 见下面第五点</p> <h2 id="三、监听webpack编译结束"><a href="#三、监听webpack编译结束" class="header-anchor">#</a> 三、监听webpack编译结束</h2> <p>修改好入口配置后，又调用了setupHooks方法。这个方法是用来注册监听事件的，监听每次webpack编译完成。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setupHooks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">addHooks</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> done <span class="token punctuation">}</span> <span class="token operator">=</span> compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">;</span>
    <span class="token comment">// 监听webpack的done钩子，tapable提供的监听方法</span>
    done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'webpack-dev-server'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_sendStats</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sockets<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getStats</span><span class="token punctuation">(</span>stats<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_stats <span class="token operator">=</span> stats<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>当监听到一次webpack编译结束，就会调用_sendStats方法通过websocket给浏览器发送通知，ok和hash事件，这样浏览器就可以拿到最新的hash值了，做检查更新逻辑。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 通过websoket给客户端发消息</span>
<span class="token function">_sendStats</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sockWrite</span><span class="token punctuation">(</span>sockets<span class="token punctuation">,</span> <span class="token string">'hash'</span><span class="token punctuation">,</span> stats<span class="token punctuation">.</span>hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sockWrite</span><span class="token punctuation">(</span>sockets<span class="token punctuation">,</span> <span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="四、webpack监听文件变化"><a href="#四、webpack监听文件变化" class="header-anchor">#</a> 四、webpack监听文件变化</h2> <p>每次修改代码，就会触发编译。说明我们还需要监听本地代码的变化，主要是通过setupDevMiddleware方法实现的。</p> <p>webpack-dev-middleware和webpack-dev-server的区别</p> <ul><li>webpack-dev-server: 只负责启动服务和前置准备工作</li> <li>webpack-dev-middleware: 所有文件相关的操作都抽离到webpack-dev-middleware库，主要是本地文件的编译、输出和监听
接下来看看<code>webpack-dev-middleware</code>做了什么事:</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// node_modules/webpack-dev-middleware/index.js</span>
compiler<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>watchOptions<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*错误处理*/</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 通过“memory-fs”库将打包后的文件写入内存</span>
<span class="token function">setFs</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> compiler<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>调用compiler.watch方法。compiler主要做了2件事
<ol><li>先对本地文件代码进行编译打包，也就是webpack的一系列编译流程</li> <li>编译结束后，开启对本地文件的监听，当文件发生变化，重新编译，编译完成之后继续监听。</li></ol></li> <li>执行setFs方法。利用<code>memory-fs</code>库将编译后的文件打包到内存。这就是为什么在开发的过程中，你会发现dist目录没有打包后的代码，因为都在内存中。原因就在于访问内存中的代码比访问文件系统中的文件更快</li></ul> <p>为什么代码的改动保存会自动编译，重新打包？</p> <p>答：compiler.watch监听本地文件的变化，通过文件的生成时间是否有变化</p> <h2 id="五、浏览器接收到热更新的通知"><a href="#五、浏览器接收到热更新的通知" class="header-anchor">#</a> 五、浏览器接收到热更新的通知</h2> <p>当监听到一次webpack编译结束，_sendStats方法就通过websoket给浏览器发送通知，检查下是否需要热更新。下面重点讲的就是_sendStats方法中的ok和hash事件都做了什么？</p> <p>那浏览器是如何接收到websocket的消息呢？回忆下第 2 步骤增加的入口文件，也就是websocket客户端代码。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string">'xxx/node_modules/webpack-dev-server/client/index.js?http://localhost:8080'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这个文件的代码会被打包到bundle.js中，运行在浏览器中。来看下这个文件的核心代码吧。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// webpack-dev-server/client/index.js</span>
<span class="token keyword">var</span> socket <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./socket'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> onSocketMessage <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">hash</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token parameter">_hash</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 更新currentHash值</span>
        status<span class="token punctuation">.</span>currentHash <span class="token operator">=</span> _hash<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">ok</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string">'Ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 进行更新检查等操作</span>
        <span class="token function">reloadApp</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 连接服务地址socketUrl，?http://localhost:8080，本地服务地址</span>
<span class="token function">socket</span><span class="token punctuation">(</span>socketUrl<span class="token punctuation">,</span> onSocketMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">reloadApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'[WDS] App hot update...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// hotEmitter其实就是EventEmitter的实例</span>
        <span class="token keyword">var</span> hotEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack/hot/emitter'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        hotEmitter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'webpackHotUpdate'</span><span class="token punctuation">,</span> currentHash<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>socket方法建立了websocket和服务端的连接，并注册了 2 个监听事件。</p> <ol><li>hash事件，更新最新一次打包后的hash值。</li> <li>ok事件，进行热更新检查。</li></ol> <p>当socket收到ok, 即触发ok事件，会调用reloadApp方法，reloadApp又利用node.js的EventEmitter，发出<code>webpackHotUpdate</code>事件</p> <p>为什么不直接进行检查更新呢？</p> <p>答：个人理解就是为了更好的维护代码，以及职责划分的更明确。websocket仅仅用于客户端（浏览器）和服务端进行通信。而真正做事情的活还是交回给了webpack。</p> <p>那webpack怎么做的呢？再来回忆下第 2 步。入口文件还有一个文件没有讲到，就是：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string">'xxx/node_modules/webpack/hot/dev-server.js'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这个文件的代码同样会被打包到bundle.js中，运行在浏览器中。这个文件做了什么就显而易见了吧！先瞄一眼代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// node_modules/webpack/hot/dev-server.js</span>
<span class="token keyword">var</span> <span class="token function-variable function">check</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">updatedModules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 容错，直接刷新页面</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>updatedModules<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                window<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            
            <span class="token comment">// 热更新结束，打印信息</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">upToDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;[HMR] App is up to date.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            window<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> hotEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./emitter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
hotEmitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;webpackHotUpdate&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">currentHash</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lastHash <span class="token operator">=</span> currentHash<span class="token punctuation">;</span>
    <span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>这里webpack监听到了webpackHotUpdate事件，并获取最新了最新的hash值，然后终于进行检查更新了。检查更新呢调用的是<code>module.hot.check</code>方法。
简单说下module.hot.check，这里会获取本次编译的Hash，利用上一次保存的Hash，请求.json和.js文件。</p> <p>其实后续还有hotApply热更新模块替换，我就不再往下深入研究了，有兴趣可见：<a href="https://juejin.cn/post/6844904008432222215#heading-0" target="_blank" rel="noopener noreferrer">轻松理解webpack热更新原理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="面试"><a href="#面试" class="header-anchor">#</a> 面试</h2> <p>问1：说下热更新原理</p> <p>答：</p> <ol><li>webpack-dev-server启动了两个服务，一个用于提供静态资源访问，一个是WebSocket，用于本地和浏览器双向通信</li> <li>webpack服务根据修改的内容，会生成两个补丁文件：.json和.js文件</li> <li>webpack-dev-server通过compiler的done钩子，监听编译结束，编译结束时，WebSocket服务端向客户端浏览器的WebSocket发送ok和hash</li> <li>浏览器收到通知后，会发起http请求去服务器获取.json和.js文件。利用JSONP解析.js文件并局部刷新页面</li></ol> <p>问2：WebSocket是长连接还是短连接？有了HTTP协议，为什么还需要WebSocket？</p> <p>答：
长连接。因为WebSocket可以双向通信</p> <p>问3：浏览器是如何知道本地代码重新编译了，并迅速请求了新生成的文件？</p> <p>答：webpack-dev-server通过compiler的done钩子来监听webpack编译的结束，只要webpack编译结束就触发钩子，通过WebSocket服务端给客户端浏览器发送通知(含有本次编译产生的hash)，浏览器收到通知后，再发起HTTP请求新生成的文件</p> <p>问4：为什么浏览器能够收到WebSocket服务端的通知？</p> <p>答：websocket客户端运行在浏览器中，所以浏览器能收到WebSocket服务端的通知。webpack-dev-server会调用<code>addEntries</code>给webpack的entry入口添加<code>webpack-dev-server/client</code>客户端代码，而客户端的代码包含了WebSocket客户端通信的代码，最终WebSocket客户端通信的代码会添加的build.js中，运行来浏览器中。因此websocket客户端运行在浏览器中，所以浏览器能收到WebSocket服务端的通知。</p> <p>问5：为什么代码的改动保存会 自动编译？</p> <p>答：compiler.watch监听本地文件的变化，通过判断文件生成时间是否变化</p> <p>Webpack 如何实现热更新的呢？首先是建立起浏览器端和服务器端之间的通信，浏览器会接收服务器端推送的消息，如果需要热更新，浏览器发起http请求去服务器端获取打包好的资源解析并局部刷新页面</p> <p><a href="https://juejin.cn/post/6844904008432222215#heading-0" target="_blank" rel="noopener noreferrer">轻松理解webpack热更新原理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://juejin.cn/post/6939678015823544350#comment" target="_blank" rel="noopener noreferrer">【Webpack 进阶】聊聊 Webpack 热更新以及原理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">7/26/2021, 3:57:29 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/buildTools/webpack/lazy-load.html" class="prev">
        懒加载(未完全理解)
      </a></span> <span class="next"><a href="/buildTools/webpack/proxy.html">
        webpack proxy原理
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.e8c3aa62.js" defer></script><script src="/assets/js/2.1d5e0d04.js" defer></script><script src="/assets/js/17.f8c4932c.js" defer></script>
  </body>
</html>
