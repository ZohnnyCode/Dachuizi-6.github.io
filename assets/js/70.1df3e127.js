(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{510:function(s,t,a){s.exports=a.p+"assets/img/16.fa1473d5.png"},729:function(s,t,a){"use strict";a.r(t);var r=a(37),e=Object(r.a)({},(function(){var s=this,t=s.$createElement,r=s._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[r("p",[s._v("同源策略会隔离不同源的 DOM、页面数据和网络通信.")]),s._v(" "),r("p",[s._v("同源策略出于便利性的让步：页面中可以嵌入第三方资源")]),s._v(" "),r("h2",{attrs:{id:"csp"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#csp"}},[s._v("#")]),s._v(" CSP")]),s._v(" "),r("p",[s._v("CSP"),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP",target:"_blank",rel:"noopener noreferrer"}},[s._v("内容安全策略"),r("OutboundLink")],1),s._v(", 核心思想：让服务器决定浏览器能够加载哪些资源，让服务器决定浏览器是否能够执行内联 JavaScript 代码")]),s._v(" "),r("div",{staticClass:"language-js line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-js"}},[r("code",[s._v("Content"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Security"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Policy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("src ‘self’ "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 只允许加载本站资源")]),s._v("\nContent"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Security"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Policy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" img"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("src https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*  // 只允许加载 HTTPS 协议图片\nContent-Security-Policy: child-src 'none'   // 允许加载任何来源框架\n")])])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br")])]),r("h2",{attrs:{id:"xss攻击"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#xss攻击"}},[s._v("#")]),s._v(" XSS攻击")]),s._v(" "),r("p",[s._v("XSS "),r("code",[s._v("Cross Site Scripting")]),s._v("，为了与“CSS”区分开来，故简称 XSS，翻译过来就是“"),r("code",[s._v("跨站脚本")]),s._v("”")]),s._v(" "),r("h2",{attrs:{id:"是什么"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#是什么"}},[s._v("#")]),s._v(" 是什么")]),s._v(" "),r("p",[s._v("XSS攻击是 黑客往 HTML文件或者 DOM中注入 恶意脚本，从而用户浏览页面时利用恶意脚本对用户实施攻击的一种手段")]),s._v(" "),r("p",[s._v("恶意脚本可以")]),s._v(" "),r("ol",[r("li",[s._v("获取Cookie")]),s._v(" "),r("li",[s._v("监听用户行为。监听键盘事件，比如可以获取用户输入的信用卡等信息")]),s._v(" "),r("li",[s._v("修改 DOM")]),s._v(" "),r("li",[s._v("页面内生成浮窗广告")])]),s._v(" "),r("h2",{attrs:{id:"解决"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#解决"}},[s._v("#")]),s._v(" 解决")]),s._v(" "),r("ol",[r("li",[s._v("服务端对输入的脚本进行转码")]),s._v(" "),r("li",[s._v("Cookie加入 "),r("code",[s._v("HttpOlny")]),s._v("，无法通过JS来获取 本地cookie")]),s._v(" "),r("li",[s._v("利用CSP。禁上加载其他域的资源 JS 脚本")])]),s._v(" "),r("h2",{attrs:{id:"csrf"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#csrf"}},[s._v("#")]),s._v(" CSRF")]),s._v(" "),r("p",[s._v("CSRF "),r("code",[s._v("Cross-site request forgery")]),s._v(" 跨站请求伪造")]),s._v(" "),r("h2",{attrs:{id:"是什么-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#是什么-2"}},[s._v("#")]),s._v(" 是什么")]),s._v(" "),r("p",[s._v("CSRF 攻击就是黑客利用了用户的登录状态，并通过第三方的站点(黑客的网站)来做一些坏事")]),s._v(" "),r("p",[s._v("CSRF攻击可以")]),s._v(" "),r("ol",[r("li",[s._v("自动发起GET请求")]),s._v(" "),r("li",[s._v("自动发起POST请求")]),s._v(" "),r("li",[s._v("诱导用户点击")])]),s._v(" "),r("div",{staticClass:"language-js line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-js"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("img src"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://time.geekbang.org/sendcoin?user=hacker&number=100"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2 黑客在他的页面中构建了一个隐藏的表单, 用户打开该站点之后，这个表单会被自动执行提交")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("form id"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hacker-form'")]),s._v(" action"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://time.geekbang.org/sendcoin"')]),s._v(" method"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("POST")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("input type"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hidden"')]),s._v(" name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user"')]),s._v(" value"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hacker"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("input type"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hidden"')]),s._v(" name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"number"')]),s._v(" value"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("form"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("script"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" document"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("getElementById")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hacker-form'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("submit")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("script"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("a href"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://time.geekbang.org/sendcoin?user=hacker&number=100"')]),s._v(" taget"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_blank"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("点击下载美女照片"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("a"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br")])]),r("h2",{attrs:{id:"解决-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#解决-2"}},[s._v("#")]),s._v(" 解决")]),s._v(" "),r("ol",[r("li",[s._v("Cookie设置 "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Set-Cookie/SameSite",target:"_blank",rel:"noopener noreferrer"}},[s._v("SameSite"),r("OutboundLink")],1),s._v(" "),r("ul",[r("li",[s._v("Strict：禁止跨域发送Cookie")]),s._v(" "),r("li",[s._v("Lax: 第三方网站发起的GET请求允许发送Cookie, 其它不允许")]),s._v(" "),r("li",[s._v("None: 允许跨域发送Cookie")])])]),s._v(" "),r("li",[s._v("服务端验证请求的来源\n"),r("ul",[r("li",[s._v("Referer: 记录了请求的具体来源")]),s._v(" "),r("li",[s._v("Origin: 记录请求的域名\n"),r("img",{attrs:{src:a(510),alt:"origin"}})])])]),s._v(" "),r("li",[s._v("请求时附带验证信息，比如 token")])]),s._v(" "),r("p",[s._v("如果没设置SameSite，登录后Info站点后，在极客时间获取Info站点的资源，会带上极客时间的cookie\n（浏览器处理cookie的机制，做某个域的请求，自动会把这个域的cookie带上） csrf 一般是通过 img form 等构造请求发送的，这些请求不受跨域限制")]),s._v(" "),r("p",[s._v("cookie SameSite:\nhttps://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie/SameSite")])])}),[],!1,null,null,null);t.default=e.exports}}]);