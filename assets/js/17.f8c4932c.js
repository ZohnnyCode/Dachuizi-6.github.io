(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{532:function(s,t){s.exports="data:image/png;base64,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"},533:function(s,t,a){s.exports=a.p+"assets/img/28.c3afe33a.png"},534:function(s,t,a){s.exports=a.p+"assets/img/29.e6a6a3d8.png"},535:function(s,t,a){s.exports=a.p+"assets/img/30.b1e0510e.png"},536:function(s,t,a){s.exports=a.p+"assets/img/31.80c287a6.png"},735:function(s,t,a){"use strict";a.r(t);var n=a(37),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[s._v("webpack、webpack-cli、webpack-dev-server、webpack-dev-middleware版本如下：")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"webpack"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"5.11.1"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"webpack-cli"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"4.3.1"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"webpack-dev-server"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3.11.1"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"webpack-dev-middleware"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3.7.2"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h2",{attrs:{id:"websocket"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#websocket"}},[s._v("#")]),s._v(" websocket")]),s._v(" "),n("p",[s._v("有了HTTP协议，为什么还需要"),n("code",[s._v("WebSocket")]),s._v("?")]),s._v(" "),n("p",[s._v("答：HTTP 协议有一个缺陷：通信只能由客户端发起")]),s._v(" "),n("p",[s._v("WebSoket特点：服务器可以主动向客户端推送信息，客户端也可以主动向服务器发送信息")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" ws "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebSocket")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"wss://echo.websocket.org"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 实例对象的onopen属性，用于指定连接成功后的回调函数")]),s._v("\nws"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("onopen")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("evt")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Connection open ..."')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n  ws"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("send")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello WebSockets!"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 实例对象的onmessage属性，用于指定收到服务器数据后的回调函数")]),s._v("\nws"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("onmessage")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("evt")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Received Message: "')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" evt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  ws"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 实例对象的onclose属性，用于指定连接关闭后的回调函数")]),s._v("\nws"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("onclose")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("evt")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Connection closed."')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 输出：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('// "Connection open ..."')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('// "Received Message: Hello WebSockets!"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('// "Connection closed."')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("p",[n("img",{attrs:{src:a(532),alt:"socket"}})]),s._v(" "),n("h2",{attrs:{id:"热更新实现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#热更新实现"}},[s._v("#")]),s._v(" 热更新实现")]),s._v(" "),n("p",[s._v("HMR作为一个Webpack内置的功能，可以通过HotModuleReplacementPlugin或--hot开启")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("devServer")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("hot")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("项目启动后，进行构建打包，控制台会输出构建过程，我们可以观察到生成了一个 Hash值："),n("code",[s._v("a93fd735d02d98633356")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(533),alt:"hash"}})]),s._v(" "),n("p",[s._v("在我们每次修改代码保存后，控制台都会出现 Compiling…字样，触发新的编译中...可以在控制台中观察到：")]),s._v(" "),n("ul",[n("li",[s._v("新的Hash值：a61bdd6e82294ed06fa3")]),s._v(" "),n("li",[s._v("新的json文件： a93fd735d02d98633356.hot-update.json")]),s._v(" "),n("li",[s._v("新的js文件：index.a93fd735d02d98633356.hot-update.js")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(534),alt:"hash"}})]),s._v(" "),n("p",[s._v("结论：上次输出的"),n("code",[s._v("Hash")]),s._v("会作为本次编译新生成的文件标识，本次输出的"),n("code",[s._v("Hash")]),s._v("会作为下次热更新的标识")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("openPhotoAlbum")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("appSDK"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("openPhotoAlbum")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("res")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'res'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 更改后")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("openPhotoAlbum")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("appSDK"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("openPhotoAlbum")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("res")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'res2'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("更改Vue文件openPhotoAlbum方法的打印语句，保存文件后，从webpack服务的打印可知，此时HMR热更新产生了两个新文件"),n("code",[s._v("main.1925dbfa6ec6ac69aef2.hot-update.js")]),s._v("、"),n("code",[s._v("main.1925dbfa6ec6ac69aef2.hot-update.json")])]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("asset main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1925dbfa6ec6ac69aef2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hot"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("update"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12.5")]),s._v(" KiB "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("immutable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("hmr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nasset index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("771")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bytes")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nasset main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1925dbfa6ec6ac69aef2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hot"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("update"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bytes")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emitted"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("immutable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("hmr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("接下来看看浏览器怎么处理热更新的")]),s._v(" "),n("ol",[n("li",[s._v("浏览器的"),n("code",[s._v("WebSocket")]),s._v("服务，接收到本次热更新产生的Hash "),n("code",[s._v("3ba7245632a597574ef3")]),s._v(" "),n("img",{attrs:{src:a(535),alt:"hash"}})]),s._v(" "),n("li",[s._v("浏览器判断本次接收的Hash，如果与上次相同，则代表本次编译没修改文件；如果与上次Hash不同，则请求.json和.js文件\n"),n("img",{attrs:{src:a(536),alt:"json"}})])]),s._v(" "),n("ul",[n("li",[s._v("c 表示当前要热更新的文件对应的是main模块")]),s._v(" "),n("li",[s._v("js文件：是本次修改的代码。格式化并删除部分代码后显示如下，js是要更新的模块, 也使用了"),n("code",[s._v("JSONP")]),s._v("原理")])]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// main.1925dbfa6ec6ac69aef2.hot-update.js")]),s._v("\nself"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"webpackHotUpdate_i61_h5_sdk"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"main"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"./node_modules/babel-loader/lib/index.js!./node_modules/vue-loader/lib/index.js??vue-loader-options!./example/src/API.vue?vue&type=script&lang=js&"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("module"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    exports"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    __webpack_require__")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"use strict"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" _Object$defineProperty "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("__webpack_require__")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*! @babel/runtime-corejs3/core-js-stable/object/define-property */")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./node_modules/@babel/runtime-corejs3/core-js-stable/object/define-property.js"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("_Object$defineProperty")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("exports"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"__esModule"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("value")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    exports"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("default "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" _default "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("data")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("data")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("computed")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("methods")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("openPhotoAlbum")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("openPhotoAlbum")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("appSDK"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("openPhotoAlbum")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("res")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'res2'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    exports"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("default "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" _default"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br")])]),n("h2",{attrs:{id:"源码解析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#源码解析"}},[s._v("#")]),s._v(" 源码解析")]),s._v(" "),n("ul",[n("li",[s._v("浏览器是如何知道本地代码重新编译了，并迅速请求了新生成的文件？\n答：derServer会通过compiler的done钩子来监听webpack的编译结束，只要编译结束就触发钩子，通过websocket给浏览器发送通知。浏览器拿到本次编译产生的Hash，如果与上次相同，则代表本次编译没修改文件；如果与上次Hash不同，则请求.json和.js文件")]),s._v(" "),n("li",[s._v("是谁告知了浏览器？\n答：编译结束后，本地的WebSocket服务给浏览器发通知，ok和hash事件，浏览器就可以拿到本次编译产生的Hash")])]),s._v(" "),n("p",[s._v("带着疑问来看源码吧")]),s._v(" "),n("h2",{attrs:{id:"一、webpack-dev-server启动本地服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一、webpack-dev-server启动本地服务"}},[s._v("#")]),s._v(" 一、webpack-dev-server启动本地服务")]),s._v(" "),n("p",[s._v("webpack-dev-server的package.json中的bin命令，可以找到命令的入口文件bin/webpack-dev-server.js")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// node_modules/webpack-dev-server/bin/webpack-dev-server.js")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 生成webpack编译主引擎 compiler")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" compiler "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("webpack")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 启动本地服务")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" server "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("compiler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nserver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("listen")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("port"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("host"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("err")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("看看new Server做了啥")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// node_modules/webpack-dev-server/lib/Server.js")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("constructor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("setupApp")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("createServer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("setupApp")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 依赖了express")]),s._v("\n    \t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("app "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("express")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("createServer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("listeningApp "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("createServer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("app"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("listen")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("port"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" hostname"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fn")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("listeningApp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("listen")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("port"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" hostname"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("err")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 启动express服务后，启动websocket服务")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("createSocketServer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("                                   \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("ol",[n("li",[s._v("启动webpack, 生成compiler实例。compiler上有很多方法，比如可以启动 webpack 所有编译工作，以及监听本地文件的变化。")]),s._v(" "),n("li",[s._v("使用express框架启动本地server，让浏览器可以请求本地的静态资源。")]),s._v(" "),n("li",[s._v("本地server启动之后，再去启动websocket服务。通过websocket，可以建立本地服务和浏览器的双向通信。")])]),s._v(" "),n("h2",{attrs:{id:"二、修改webpack-config-js的entry配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二、修改webpack-config-js的entry配置"}},[s._v("#")]),s._v(" 二、修改webpack.config.js的entry配置")]),s._v(" "),n("p",[s._v("启动本地服务前，调用了"),n("code",[s._v("updateCompiler -> updateCompiler -> addEntries")]),s._v("，addEntries中有2 段关键性代码。一个是获取websocket客户端代码路径，另一个是根据配置获取webpack热更新代码路径。")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// node_modules/webpack-dev-server/lib/Server.js")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("updateCompiler")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("compiler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// node_modules/webpack-dev-server/utils/updateCompiler.js")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("addEntries")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("webpackConfig"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// node_modules/webpack-dev-server/lib/utils/addEntries.js")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" clientEntry "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),s._v("require"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'../../client/'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("?")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),s._v("domain"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),s._v("sockHost"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),s._v("sockPath"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),s._v("sockPort"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/** @type {(string[] | string)} */")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" hotEntry"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hotOnly"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  hotEntry "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" require"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'webpack/hot/only-dev-server'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  hotEntry "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" require"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'webpack/hot/dev-server'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("p",[s._v("修改后的webpack入口配置如下：")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 修改后的entry入口")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("entry")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" \n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 上面获取的clientEntry")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xxx/node_modules/webpack-dev-server/client/index.js?http://localhost:8080'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 上面获取的hotEntry")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xxx/node_modules/webpack/hot/dev-server.js'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 开发配置的入口")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./src/index.js'")]),s._v("\n    \t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("      \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[s._v("为什么要新增了 2 个文件？在入口默默增加了 2 个文件，那就意味会一同打包到bundle文件中去。")]),s._v(" "),n("h3",{attrs:{id:"webpack-dev-server-client-index-js"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#webpack-dev-server-client-index-js"}},[s._v("#")]),s._v(" webpack-dev-server/client/index.js")]),s._v(" "),n("p",[s._v("第 1 步 webpack-dev-server初始化 的过程中，启动的是本地服务端的websocket。那客户端也就是我们的浏览器, 因此需要把websocket客户端通信代码塞到bundle文件中")]),s._v(" "),n("h3",{attrs:{id:"webpack-hot-dev-server-js"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#webpack-hot-dev-server-js"}},[s._v("#")]),s._v(" webpack/hot/dev-server.js")]),s._v(" "),n("p",[s._v("要是用于检查更新逻辑的 ？？？ 见下面第五点")]),s._v(" "),n("h2",{attrs:{id:"三、监听webpack编译结束"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三、监听webpack编译结束"}},[s._v("#")]),s._v(" 三、监听webpack编译结束")]),s._v(" "),n("p",[s._v("修改好入口配置后，又调用了setupHooks方法。这个方法是用来注册监听事件的，监听每次webpack编译完成。")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("setupHooks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("addHooks")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("compiler")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" done "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" compiler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hooks"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 监听webpack的done钩子，tapable提供的监听方法")]),s._v("\n    done"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tap")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'webpack-dev-server'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("stats")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("_sendStats")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sockets"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getStats")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stats"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("_stats "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" stats"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("当监听到一次webpack编译结束，就会调用_sendStats方法通过websocket给浏览器发送通知，ok和hash事件，这样浏览器就可以拿到最新的hash值了，做检查更新逻辑。")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 通过websoket给客户端发消息")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("_sendStats")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sockWrite")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockets"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hash'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" stats"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hash"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sockWrite")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockets"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ok'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h2",{attrs:{id:"四、webpack监听文件变化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四、webpack监听文件变化"}},[s._v("#")]),s._v(" 四、webpack监听文件变化")]),s._v(" "),n("p",[s._v("每次修改代码，就会触发编译。说明我们还需要监听本地代码的变化，主要是通过setupDevMiddleware方法实现的。")]),s._v(" "),n("p",[s._v("webpack-dev-middleware和webpack-dev-server的区别")]),s._v(" "),n("ul",[n("li",[s._v("webpack-dev-server: 只负责启动服务和前置准备工作")]),s._v(" "),n("li",[s._v("webpack-dev-middleware: 所有文件相关的操作都抽离到webpack-dev-middleware库，主要是本地文件的编译、输出和监听\n接下来看看"),n("code",[s._v("webpack-dev-middleware")]),s._v("做了什么事:")])]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// node_modules/webpack-dev-middleware/index.js")]),s._v("\ncompiler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("watchOptions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("err")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*错误处理*/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 通过“memory-fs”库将打包后的文件写入内存")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("setFs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" compiler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("ul",[n("li",[s._v("调用compiler.watch方法。compiler主要做了2件事\n"),n("ol",[n("li",[s._v("先对本地文件代码进行编译打包，也就是webpack的一系列编译流程")]),s._v(" "),n("li",[s._v("编译结束后，开启对本地文件的监听，当文件发生变化，重新编译，编译完成之后继续监听。")])])]),s._v(" "),n("li",[s._v("执行setFs方法。利用"),n("code",[s._v("memory-fs")]),s._v("库将编译后的文件打包到内存。这就是为什么在开发的过程中，你会发现dist目录没有打包后的代码，因为都在内存中。原因就在于访问内存中的代码比访问文件系统中的文件更快")])]),s._v(" "),n("p",[s._v("为什么代码的改动保存会自动编译，重新打包？")]),s._v(" "),n("p",[s._v("答：compiler.watch监听本地文件的变化，通过文件的生成时间是否有变化")]),s._v(" "),n("h2",{attrs:{id:"五、浏览器接收到热更新的通知"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#五、浏览器接收到热更新的通知"}},[s._v("#")]),s._v(" 五、浏览器接收到热更新的通知")]),s._v(" "),n("p",[s._v("当监听到一次webpack编译结束，_sendStats方法就通过websoket给浏览器发送通知，检查下是否需要热更新。下面重点讲的就是_sendStats方法中的ok和hash事件都做了什么？")]),s._v(" "),n("p",[s._v("那浏览器是如何接收到websocket的消息呢？回忆下第 2 步骤增加的入口文件，也就是websocket客户端代码。")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xxx/node_modules/webpack-dev-server/client/index.js?http://localhost:8080'")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("这个文件的代码会被打包到bundle.js中，运行在浏览器中。来看下这个文件的核心代码吧。")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// webpack-dev-server/client/index.js")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" socket "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./socket'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" onSocketMessage "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("hash")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("hash")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("_hash")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 更新currentHash值")]),s._v("\n        status"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("currentHash "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" _hash"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("ok")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ok")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sendMessage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Ok'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 进行更新检查等操作")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("reloadApp")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" status"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 连接服务地址socketUrl，?http://localhost:8080，本地服务地址")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("socket")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("socketUrl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" onSocketMessage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("reloadApp")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'[WDS] App hot update...'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        \n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// hotEmitter其实就是EventEmitter的实例")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" hotEmitter "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'webpack/hot/emitter'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        hotEmitter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("emit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'webpackHotUpdate'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" currentHash"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("p",[s._v("socket方法建立了websocket和服务端的连接，并注册了 2 个监听事件。")]),s._v(" "),n("ol",[n("li",[s._v("hash事件，更新最新一次打包后的hash值。")]),s._v(" "),n("li",[s._v("ok事件，进行热更新检查。")])]),s._v(" "),n("p",[s._v("当socket收到ok, 即触发ok事件，会调用reloadApp方法，reloadApp又利用node.js的EventEmitter，发出"),n("code",[s._v("webpackHotUpdate")]),s._v("事件")]),s._v(" "),n("p",[s._v("为什么不直接进行检查更新呢？")]),s._v(" "),n("p",[s._v("答：个人理解就是为了更好的维护代码，以及职责划分的更明确。websocket仅仅用于客户端（浏览器）和服务端进行通信。而真正做事情的活还是交回给了webpack。")]),s._v(" "),n("p",[s._v("那webpack怎么做的呢？再来回忆下第 2 步。入口文件还有一个文件没有讲到，就是：")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xxx/node_modules/webpack/hot/dev-server.js'")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("这个文件的代码同样会被打包到bundle.js中，运行在浏览器中。这个文件做了什么就显而易见了吧！先瞄一眼代码：")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// node_modules/webpack/hot/dev-server.js")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("check")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("check")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    module"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("check")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("updatedModules")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 容错，直接刷新页面")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("updatedModules"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("location"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("reload")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            \n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 热更新结束，打印信息")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("upToDate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"info"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[HMR] App is up to date."')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("catch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("err")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("location"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("reload")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" hotEmitter "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./emitter"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nhotEmitter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"webpackHotUpdate"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("currentHash")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    lastHash "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" currentHash"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("check")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("p",[s._v("这里webpack监听到了webpackHotUpdate事件，并获取最新了最新的hash值，然后终于进行检查更新了。检查更新呢调用的是"),n("code",[s._v("module.hot.check")]),s._v("方法。\n简单说下module.hot.check，这里会获取本次编译的Hash，利用上一次保存的Hash，请求.json和.js文件。")]),s._v(" "),n("p",[s._v("其实后续还有hotApply热更新模块替换，我就不再往下深入研究了，有兴趣可见："),n("a",{attrs:{href:"https://juejin.cn/post/6844904008432222215#heading-0",target:"_blank",rel:"noopener noreferrer"}},[s._v("轻松理解webpack热更新原理"),n("OutboundLink")],1)]),s._v(" "),n("h2",{attrs:{id:"面试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#面试"}},[s._v("#")]),s._v(" 面试")]),s._v(" "),n("p",[s._v("问1：说下热更新原理")]),s._v(" "),n("p",[s._v("答：")]),s._v(" "),n("ol",[n("li",[s._v("webpack-dev-server启动了两个服务，一个用于提供静态资源访问，一个是WebSocket，用于本地和浏览器双向通信")]),s._v(" "),n("li",[s._v("webpack服务根据修改的内容，会生成两个补丁文件：.json和.js文件")]),s._v(" "),n("li",[s._v("webpack-dev-server通过compiler的done钩子，监听编译结束，编译结束时，WebSocket服务端向客户端浏览器的WebSocket发送ok和hash")]),s._v(" "),n("li",[s._v("浏览器收到通知后，会发起http请求去服务器获取.json和.js文件。利用JSONP解析.js文件并局部刷新页面")])]),s._v(" "),n("p",[s._v("问2：WebSocket是长连接还是短连接？有了HTTP协议，为什么还需要WebSocket？")]),s._v(" "),n("p",[s._v("答：\n长连接。因为WebSocket可以双向通信")]),s._v(" "),n("p",[s._v("问3：浏览器是如何知道本地代码重新编译了，并迅速请求了新生成的文件？")]),s._v(" "),n("p",[s._v("答：webpack-dev-server通过compiler的done钩子来监听webpack编译的结束，只要webpack编译结束就触发钩子，通过WebSocket服务端给客户端浏览器发送通知(含有本次编译产生的hash)，浏览器收到通知后，再发起HTTP请求新生成的文件")]),s._v(" "),n("p",[s._v("问4：为什么浏览器能够收到WebSocket服务端的通知？")]),s._v(" "),n("p",[s._v("答：websocket客户端运行在浏览器中，所以浏览器能收到WebSocket服务端的通知。webpack-dev-server会调用"),n("code",[s._v("addEntries")]),s._v("给webpack的entry入口添加"),n("code",[s._v("webpack-dev-server/client")]),s._v("客户端代码，而客户端的代码包含了WebSocket客户端通信的代码，最终WebSocket客户端通信的代码会添加的build.js中，运行来浏览器中。因此websocket客户端运行在浏览器中，所以浏览器能收到WebSocket服务端的通知。")]),s._v(" "),n("p",[s._v("问5：为什么代码的改动保存会 自动编译？")]),s._v(" "),n("p",[s._v("答：compiler.watch监听本地文件的变化，通过判断文件生成时间是否变化")]),s._v(" "),n("p",[s._v("Webpack 如何实现热更新的呢？首先是建立起浏览器端和服务器端之间的通信，浏览器会接收服务器端推送的消息，如果需要热更新，浏览器发起http请求去服务器端获取打包好的资源解析并局部刷新页面")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://juejin.cn/post/6844904008432222215#heading-0",target:"_blank",rel:"noopener noreferrer"}},[s._v("轻松理解webpack热更新原理"),n("OutboundLink")],1),s._v(" "),n("a",{attrs:{href:"https://juejin.cn/post/6939678015823544350#comment",target:"_blank",rel:"noopener noreferrer"}},[s._v("【Webpack 进阶】聊聊 Webpack 热更新以及原理"),n("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=e.exports}}]);