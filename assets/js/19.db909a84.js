(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{394:function(t,s,a){},644:function(t,s,a){t.exports=a.p+"assets/img/26.50a1a591.png"},645:function(t,s,a){t.exports=a.p+"assets/img/27.b7df7048.png"},646:function(t,s,a){t.exports=a.p+"assets/img/28.4726b6d3.png"},647:function(t,s,a){"use strict";a(394)},778:function(t,s,a){"use strict";a.r(s);a(647);var n=a(37),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"场景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#场景"}},[t._v("#")]),t._v(" 场景")]),t._v(" "),n("p",[t._v("2020年前，公司内支付收费来自线下，线下收费，保存家长支付截图，再由老师到B端后台填写学员信息，上传支付截图。效率低下。随着公司从几百到几千的发展，支付成为公司发展瓶颈，一个内部使用，基建性质的支付平台应运而生。")]),t._v(" "),n("ol",[n("li",[t._v("正式课报名需要支付。最初支付的开发设计是在正式课报名H5中，目的是让家长在报课时交费。2020年初左右，我参与支付H5的开发，主要接入"),n("code",[t._v("微信支付")]),t._v("，"),n("code",[t._v("支付宝支付")]),t._v("，"),n("code",[t._v("通联快捷支付")]),t._v("(即绑定银行卡 --\x3e 输验证码 --\x3e 支付)")]),t._v(" "),n("li",[t._v("抽离支付业务。随着H5业务快速发展，部分H5也有接入支付业务的需求。因此，把支付业务抽离出来，独立维护支付中心H5。")])]),t._v(" "),n("h2",{attrs:{id:"业务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#业务"}},[t._v("#")]),t._v(" 业务")]),t._v(" "),n("ol",[n("li",[t._v("微信支付。微信下支付流程简单。实现上和"),n("RouterLink",{attrs:{to:"/project/H5/h5-sdk.html#二、wxsdk"}},[t._v("wxSdk-微信分享")]),t._v("一致：调接口获取微信签名信息 --\x3e wx.config --\x3e wx.ready --\x3e wx.chooseWXPay")],1)]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("wx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("config")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("debug")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("appId")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("appId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 必填，公众号的唯一标识")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("timestamp")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("timestamp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 必填，生成签名的时间戳")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("nonceStr")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nonceStr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 必填，生成签名的随机串")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("signature")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("signature"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 必填，签名，见附录1")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("jsApiList")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"chooseWXPay"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br")])]),n("p",[n("img",{attrs:{src:a(644),alt:"wxPay"}})]),t._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[t._v("支付宝支付。支付宝支付实现很简单，在收银台页点确认支付，调接口，后端返回一个链接，手机浏览器打开链接，就会自动唤起本地安装的支付宝进行支付。")])]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("https")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("mclient"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("alipay"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("cashier"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("mobilepay"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("htm"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("alipay_exterface_invoke_assign_target"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("invoke_dfd00918a66d86f566b99f1cf7cecbf5"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("alipay_exterface_invoke_assign_sign"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("_iuvu_a_r_t_z_dcug_q_f_o_u6a_b_e_q_md_ee_ne_v_n_d_bm_n_x_f_y_ru_q_v5_t9p_th_b0_kkfp_cw"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("3D"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("3D\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("p",[n("img",{attrs:{src:a(645),alt:"aliPay"}})]),t._v(" "),n("p",[t._v("由于在"),n("code",[t._v("微信环境下无法唤起支付宝")]),t._v("，因此，需要做一个中转页面。")]),t._v(" "),n("ol",{attrs:{start:"3"}},[n("li",[t._v("通联快捷支付。绑定银行卡 --\x3e 输验证码 --\x3e 支付。实际上较少人用这种支付方式。")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(646),alt:"bank"}})]),t._v(" "),n("h2",{attrs:{id:"难点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#难点"}},[t._v("#")]),t._v(" 难点")]),t._v(" "),n("h3",{attrs:{id:"微信支付本地调试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#微信支付本地调试"}},[t._v("#")]),t._v(" 微信支付本地调试")]),t._v(" "),n("p",[t._v("如何在本地测试微信支付？")]),t._v(" "),n("ol",[n("li",[t._v("改本地host")])]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// C:\\Windows\\System32\\drivers\\etc")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.16")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".28")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".108")]),t._v(" pay"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("61info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cn\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br")])]),n("ol",{attrs:{start:"2"}},[n("li",[t._v("下载安装"),n("a",{attrs:{href:"https://nginx.org/en/docs/windows.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("ngnix"),n("OutboundLink")],1),t._v("，改ngnix配置。把"),n("code",[t._v("http://pay-test.61info.cn")]),t._v("代理到本地"),n("code",[t._v("http://172.16.28.108:8889/")])])]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  listen "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server_name pay"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("61info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  \n  location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    proxy_pass  http"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token regex"}},[n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("172.16.28.108:8889")]),n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 启动ngnix服务")]),t._v("\ncd nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.20")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),t._v("\nstart "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 启动")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// tasklist /fi "imagename eq nginx.exe"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 映像名称                       PID 会话名              会话#       内存使用")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ========================= ======== ================ =========== ============")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// nginx.exe                    15120 Console                    1      7,996 K")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// nginx.exe                    24040 Console                    1      8,244 K")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s stop  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 停止服务")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br")])]),n("ol",{attrs:{start:"3"}},[n("li",[t._v("改支付中心h5项目的proxy。")])]),t._v(" "),n("p",[t._v("由于h5本身做了代理，把"),n("code",[t._v("/api/")]),t._v("的请求，转发到"),n("code",[t._v("pay-test.61info.cn")]),t._v("服务。而由于第2步做了nginx转发，所以最终的路径是：/api/请求 --\x3e pay-test.61info.cn --\x3e 172.16.28.108:8889. 而我本地172.16.28.108:8889不是后端服务，因此/api/请求无法成功。")]),t._v(" "),n("p",[t._v("解决：ping pay-test.61info.cn, 把支付中心代理的后端服务域名，用ip表示")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("C")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\\Users\\zhangchengliang"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("ping pay"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("61info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cn\n\n正在 Ping pay"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("61info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cn "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.16")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".51")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".12")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" 具有 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("32")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("字节的数据")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("proxy")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 代理")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"/api/"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// target: 'http://pay-test.61info.cn',")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("target")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://172.16.51.12'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("changeOrigin")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("pathRewrite")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"^/api"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br")])]),n("ol",{attrs:{start:"4"}},[n("li",[t._v("通过finddle，手机代理到本地电脑。在微信环境下打开pay-test.61info.cn/xxx，本地测试微信支付 (未验证)")])]),t._v(" "),n("h3",{attrs:{id:"支付宝中转页"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#支付宝中转页"}},[t._v("#")]),t._v(" 支付宝中转页")]),t._v(" "),n("p",[t._v("微信环境下如何调起支付宝？")]),t._v(" "),n("p",[t._v("浏览器下，可通过浏览跳转直接唤起支付宝；微信环境下，无法唤起支付宝，需加让用户用浏览器打开中转页链接，中转页再唤起支付宝。")]),t._v(" "),n("h3",{attrs:{id:"业务h5接入"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#业务h5接入"}},[t._v("#")]),t._v(" 业务H5接入")]),t._v(" "),n("p",[t._v("业务H5如何快速接入支付中心？")]),t._v(" "),n("ol",[n("li",[t._v("H5环境。调接口获取支付中心的链接，注意要传支付成功后回跳的"),n("code",[t._v("returnUrl")]),t._v("参数，一般是当前点击去支付的页面。location.href = 'xxx'跳到支付中心即可。")])]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("div @click"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"toPay"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"toPay"')]),t._v(" v"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"recordData.applyState === 0"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("去支付"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("div"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toPay")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPayUrl")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("applyId")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("recordData"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("applyId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("returnUrl")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("origin "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pathname "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/#admissionTicket'")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isWeiXin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("href "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'WECHAT-H5'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("href "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'OUTTER-H5'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br")])]),n("ol",{attrs:{start:"2"}},[n("li",[t._v("APP环境。问了客户端的同事，支付中心H5要想在hll app唤起支付，目前需要满足两个条件：")])]),t._v(" "),n("ul",[n("li",[t._v("安卓机器")]),t._v(" "),n("li",[t._v("hll app 版本大于50300")])]),t._v(" "),n("p",[t._v("目前的处理方法是：不同时满足上面两个条件的，用浏览器打开H5")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isHllApp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" browser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("versions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ios"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" \n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isHllApp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("parse")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$route"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hllUserInfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("parse")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$route"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hllUserInfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("versionCode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("50300")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  AppH5JSSDK"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("openUrl")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("href"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  AppH5JSSDK"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("closeWeb")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br")])]),n("h3",{attrs:{id:"app环境支持"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#app环境支持"}},[t._v("#")]),t._v(" app环境支持")]),t._v(" "),n("p",[t._v("app内的支付流程和H5一样，业务H5 --\x3e 支付中心 --\x3e 业务H5回调页。")]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("Tips")]),t._v(" "),n("p",[t._v("APP也可以接入原生的"),n("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/app/app.php?chapter=8_1",target:"_blank",rel:"noopener noreferrer"}},[t._v("APP支付"),n("OutboundLink")],1),t._v("方式，了解到：苹果多种第三方支付有限制、抽成也高。因此APP内是借助支付中心H5走"),n("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=7_1",target:"_blank",rel:"noopener noreferrer"}},[t._v("JSAPI支付"),n("OutboundLink")],1)])]),t._v(" "),n("h2",{attrs:{id:"总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),n("p",[t._v("线下支付，后台上传支付截图的方式给导致教师效率不高，希望支付中心能支持多种支付方式，并对业务H5快速支撑。我负责支付H5的微信支付，支付宝支付，银行卡支付的页面H5开发以及支付对接。通过引导用户浏览器打开中转页的方式解决微信下无法唤起支付宝的问题，通过业务H5 -> 支付中心 -> 支付成功 -> 业务H5 的方式，实现业务H5快速接入支付。")]),t._v(" "),n("p",[t._v("参考：\n"),n("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("微信支付"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://blog.csdn.net/zheng2780071070/article/details/114087468",target:"_blank",rel:"noopener noreferrer"}},[t._v("申请开通微信支付教程"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/H5.php?chapter=15_4",target:"_blank",rel:"noopener noreferrer"}},[t._v("常见错误"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://opendocs.alipay.com/open/203/105285",target:"_blank",rel:"noopener noreferrer"}},[t._v("支付宝支付"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://wiki.61info.cn/pages/viewpage.action?pageId=9505153",target:"_blank",rel:"noopener noreferrer"}},[t._v("家长支付常见问题"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://wiki.61info.cn/pages/viewpage.action?pageId=44270784",target:"_blank",rel:"noopener noreferrer"}},[t._v("支付常见问题指引"),n("OutboundLink")],1)])])}),[],!1,null,"5424bc23",null);s.default=r.exports}}]);