(window.webpackJsonp=window.webpackJsonp||[]).push([[110],{759:function(t,s,a){"use strict";a.r(s);var n=a(37),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"vue3做了哪些优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vue3做了哪些优化"}},[t._v("#")]),t._v(" vue3做了哪些优化")]),t._v(" "),a("ul",[a("li",[t._v("源码\n"),a("ol",[a("li",[t._v("代码管理：monorepo。vue2托管在src，依据功能拆分出compiler、core目录等；vue3使用monorepo，根据功能将不同的模块拆分到packages目录下面不同的子目录中，模块拆分更细化")]),t._v(" "),a("li",[t._v("Vue3是基于typeScript编写的；vue2是用js的（Flow）")])])]),t._v(" "),a("li",[t._v("性能\n"),a("ol",[a("li",[t._v("体积优化：")])]),t._v(" "),a("ul",[a("li",[t._v("移除一些API（eg：filter)；")]),t._v(" "),a("li",[t._v("Tree shaking 没用到的模块都被摇掉，打包休积更小")])])])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// vue2")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Vue "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vue'")]),t._v("\nVue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("nextTick")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// vue3")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" nextTick"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" observable "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vue'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("nextTick")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("编译优化：\nvue3编译过程和vue2基本一致。解析 --\x3e 优化AST --\x3e 生成代码。在创建VNode的时候就确定结点的"),a("code",[t._v("位运算标志：patchFlag")]),t._v("，在Diff更新的过程中，通过"),a("code",[t._v("patchFlag")]),t._v("来做相应的更新。性能上较Vue2.x有了提升。")]),t._v(" "),a("li",[t._v("数据劫持优化：\nvue2使用defineProperty，有两个缺点：")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("* 不能检测对象属性的添加和删除。是通过<code>$set</code>和<code>$delete</code>\n* 当对象嵌套层级较深时，使用递归遍历把每一层数据变成响应式的。\n")])])]),a("p",[t._v("vue3使用Proxy做劫持对象。实际上Proxy API 并不能监听到内部深层次的对象变化。使用对象的深层属性时，在getter中去递归响应式。访问对象深层属性时，对象深层属性才会变成响应式。")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("Composition API")]),t._v(" "),a("ol",[a("li",[t._v("优化代码的组织：一个功能的相关逻辑代码放在一个函数里")]),t._v(" "),a("li",[t._v("优化代码的复用：vue2使用mixins会有两个问题")])]),t._v(" "),a("ul",[a("li",[t._v("命名冲突")]),t._v(" "),a("li",[t._v("数据来源不清晰")])]),t._v(" "),a("p",[t._v("vue3 可以编写可复用的hook函数(useXXX)，实现代码复用")])])]),t._v(" "),a("h2",{attrs:{id:"编译优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编译优化"}},[t._v("#")]),t._v(" 编译优化")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("p "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("style"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{ color: color }"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("p"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// packages/runtime-core/src/renderer.ts")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// text")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// This flag is matched when the element has only dynamic text children.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("patchFlag "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" PatchFlags"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("TEXT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("n1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("children "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" n2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("children"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hostSetElementText")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("el"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" n2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("children "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])]),a("p",[t._v("如果此时的 name 发生了修改，p 节点进入了 diff 阶段，此时会将判断结点的 "),a("code",[t._v("patchFlag & PatchFlags.TEXT")]),t._v(" ，当元素只有动态文本子元素时，将匹配此标志。然后才做TEXT的更新")]),t._v(" "),a("p",[t._v("参考：\n"),a("a",{attrs:{href:"https://v3.cn.vuejs.org/guide/migration/v-model.html#%E8%BF%81%E7%A7%BB%E7%AD%96%E7%95%A5",target:"_blank",rel:"noopener noreferrer"}},[t._v("v3官网"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://juejin.cn/post/6977004323742220319#heading-42",target:"_blank",rel:"noopener noreferrer"}},[t._v("【初学笔记】整理的一些Vue3知识点"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/cangshudada/vue3.0-reactivity-analyze",target:"_blank",rel:"noopener noreferrer"}},[t._v("vue3数据绑定源码简析"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://juejin.cn/post/6844904165324357646#heading-1",target:"_blank",rel:"noopener noreferrer"}},[t._v("Vue3源码分析——数据侦测"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://juejin.cn/post/6893839274304700429#heading-0",target:"_blank",rel:"noopener noreferrer"}},[t._v("Vue3模板编译优化"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://juejin.cn/post/6940454764421316644",target:"_blank",rel:"noopener noreferrer"}},[t._v("Vue3.0 新特性以及使用经验总结"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://juejin.cn/post/6930897845369356295#heading-30",target:"_blank",rel:"noopener noreferrer"}},[t._v("化身面试官出30+Vue面试题，超级干货（附答案）｜牛气冲天新年征文"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);