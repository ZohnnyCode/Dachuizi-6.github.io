<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>基本使用 | Zohnny前端小册</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Zohnny前端小册">
    
    <link rel="preload" href="/assets/css/0.styles.9a0b0289.css" as="style"><link rel="preload" href="/assets/js/app.e8c3aa62.js" as="script"><link rel="preload" href="/assets/js/2.1d5e0d04.js" as="script"><link rel="preload" href="/assets/js/29.391ab5ba.js" as="script"><link rel="prefetch" href="/assets/js/10.0bc17075.js"><link rel="prefetch" href="/assets/js/100.194dcfa0.js"><link rel="prefetch" href="/assets/js/101.f8977d49.js"><link rel="prefetch" href="/assets/js/102.68d460f2.js"><link rel="prefetch" href="/assets/js/103.3ac580e7.js"><link rel="prefetch" href="/assets/js/104.9d4751c7.js"><link rel="prefetch" href="/assets/js/105.a5f0c700.js"><link rel="prefetch" href="/assets/js/106.e56dcf3c.js"><link rel="prefetch" href="/assets/js/107.1f1c30b4.js"><link rel="prefetch" href="/assets/js/108.68ca0fc6.js"><link rel="prefetch" href="/assets/js/109.50ce68c2.js"><link rel="prefetch" href="/assets/js/11.979bcc85.js"><link rel="prefetch" href="/assets/js/110.f56975a0.js"><link rel="prefetch" href="/assets/js/111.52d900c7.js"><link rel="prefetch" href="/assets/js/112.00424531.js"><link rel="prefetch" href="/assets/js/113.ea237985.js"><link rel="prefetch" href="/assets/js/114.57f07f83.js"><link rel="prefetch" href="/assets/js/115.ec061508.js"><link rel="prefetch" href="/assets/js/116.944ac05b.js"><link rel="prefetch" href="/assets/js/117.51a3bd3d.js"><link rel="prefetch" href="/assets/js/118.b1708a32.js"><link rel="prefetch" href="/assets/js/119.547f729e.js"><link rel="prefetch" href="/assets/js/12.f7837a85.js"><link rel="prefetch" href="/assets/js/120.77b77710.js"><link rel="prefetch" href="/assets/js/121.a6f28bc6.js"><link rel="prefetch" href="/assets/js/13.8e015820.js"><link rel="prefetch" href="/assets/js/14.34a558be.js"><link rel="prefetch" href="/assets/js/15.60fac476.js"><link rel="prefetch" href="/assets/js/16.be05c3ca.js"><link rel="prefetch" href="/assets/js/17.f8c4932c.js"><link rel="prefetch" href="/assets/js/18.5e0519af.js"><link rel="prefetch" href="/assets/js/19.db909a84.js"><link rel="prefetch" href="/assets/js/20.8cc2df06.js"><link rel="prefetch" href="/assets/js/21.f4b0b435.js"><link rel="prefetch" href="/assets/js/22.d559c9b3.js"><link rel="prefetch" href="/assets/js/23.74ba9f22.js"><link rel="prefetch" href="/assets/js/24.2a4117e9.js"><link rel="prefetch" href="/assets/js/25.73c08c20.js"><link rel="prefetch" href="/assets/js/26.c19cc994.js"><link rel="prefetch" href="/assets/js/27.81cd809b.js"><link rel="prefetch" href="/assets/js/28.6791b309.js"><link rel="prefetch" href="/assets/js/3.1efbb513.js"><link rel="prefetch" href="/assets/js/30.0b1d7a71.js"><link rel="prefetch" href="/assets/js/31.1f2bb083.js"><link rel="prefetch" href="/assets/js/32.cae2775b.js"><link rel="prefetch" href="/assets/js/33.1e9405be.js"><link rel="prefetch" href="/assets/js/34.9210faf9.js"><link rel="prefetch" href="/assets/js/35.2ac222fd.js"><link rel="prefetch" href="/assets/js/36.c1aa7d10.js"><link rel="prefetch" href="/assets/js/37.47ed6a00.js"><link rel="prefetch" href="/assets/js/38.0743fb65.js"><link rel="prefetch" href="/assets/js/39.f1abc33e.js"><link rel="prefetch" href="/assets/js/4.c29c9b60.js"><link rel="prefetch" href="/assets/js/40.4c2c9b8b.js"><link rel="prefetch" href="/assets/js/41.f38fd71e.js"><link rel="prefetch" href="/assets/js/42.59cc5e7a.js"><link rel="prefetch" href="/assets/js/43.54713365.js"><link rel="prefetch" href="/assets/js/44.cc7cdb87.js"><link rel="prefetch" href="/assets/js/45.cdc6ea0c.js"><link rel="prefetch" href="/assets/js/46.2ab8048b.js"><link rel="prefetch" href="/assets/js/47.f6a00ea3.js"><link rel="prefetch" href="/assets/js/48.8349de8f.js"><link rel="prefetch" href="/assets/js/49.98c2ddda.js"><link rel="prefetch" href="/assets/js/5.40944f1c.js"><link rel="prefetch" href="/assets/js/50.425c325b.js"><link rel="prefetch" href="/assets/js/51.b4870e91.js"><link rel="prefetch" href="/assets/js/52.aef0d698.js"><link rel="prefetch" href="/assets/js/53.e07d00ac.js"><link rel="prefetch" href="/assets/js/54.b7687687.js"><link rel="prefetch" href="/assets/js/55.65cf97ed.js"><link rel="prefetch" href="/assets/js/56.3444efc3.js"><link rel="prefetch" href="/assets/js/57.5377eb7e.js"><link rel="prefetch" href="/assets/js/58.e5099448.js"><link rel="prefetch" href="/assets/js/59.d09bc881.js"><link rel="prefetch" href="/assets/js/6.732df0ed.js"><link rel="prefetch" href="/assets/js/60.eba8f995.js"><link rel="prefetch" href="/assets/js/61.bd8ab09f.js"><link rel="prefetch" href="/assets/js/62.0bd4e7fc.js"><link rel="prefetch" href="/assets/js/63.640df805.js"><link rel="prefetch" href="/assets/js/64.35c8b8f7.js"><link rel="prefetch" href="/assets/js/65.affde9cb.js"><link rel="prefetch" href="/assets/js/66.9f8cabb6.js"><link rel="prefetch" href="/assets/js/67.00890bbe.js"><link rel="prefetch" href="/assets/js/68.0936ba21.js"><link rel="prefetch" href="/assets/js/69.a33cdaf9.js"><link rel="prefetch" href="/assets/js/7.31bb07dc.js"><link rel="prefetch" href="/assets/js/70.1df3e127.js"><link rel="prefetch" href="/assets/js/71.f4124ef5.js"><link rel="prefetch" href="/assets/js/72.01e6c977.js"><link rel="prefetch" href="/assets/js/73.b07f15a4.js"><link rel="prefetch" href="/assets/js/74.f72cdef2.js"><link rel="prefetch" href="/assets/js/75.ee885b7d.js"><link rel="prefetch" href="/assets/js/76.84c918df.js"><link rel="prefetch" href="/assets/js/77.a28fd7f5.js"><link rel="prefetch" href="/assets/js/78.482bfb70.js"><link rel="prefetch" href="/assets/js/79.091c9dbf.js"><link rel="prefetch" href="/assets/js/8.c0da64f7.js"><link rel="prefetch" href="/assets/js/80.df33fddc.js"><link rel="prefetch" href="/assets/js/81.6e6db080.js"><link rel="prefetch" href="/assets/js/82.e9138597.js"><link rel="prefetch" href="/assets/js/83.31c363ff.js"><link rel="prefetch" href="/assets/js/84.1e1be0f3.js"><link rel="prefetch" href="/assets/js/85.c861f43f.js"><link rel="prefetch" href="/assets/js/86.5a205712.js"><link rel="prefetch" href="/assets/js/87.d9dc3fb3.js"><link rel="prefetch" href="/assets/js/88.4297aa82.js"><link rel="prefetch" href="/assets/js/89.0a4430b5.js"><link rel="prefetch" href="/assets/js/9.0c30cda9.js"><link rel="prefetch" href="/assets/js/90.c95ae974.js"><link rel="prefetch" href="/assets/js/91.ff322a2a.js"><link rel="prefetch" href="/assets/js/92.6272aacc.js"><link rel="prefetch" href="/assets/js/93.f34792ac.js"><link rel="prefetch" href="/assets/js/94.5cd9fa78.js"><link rel="prefetch" href="/assets/js/95.4c0963b8.js"><link rel="prefetch" href="/assets/js/96.4b8520b9.js"><link rel="prefetch" href="/assets/js/97.cdf1abbd.js"><link rel="prefetch" href="/assets/js/98.4d55767c.js"><link rel="prefetch" href="/assets/js/99.0a1d65d6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9a0b0289.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Zohnny前端小册</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/basic/basic/" class="nav-link">
  基础
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  css
</a></div><div class="nav-item"><a href="/browser/theory/" class="nav-link">
  浏览器相关
</a></div><div class="nav-item"><a href="/nodejs/" class="nav-link">
  nodejs
</a></div><div class="nav-item"><a href="/babel/" class="nav-link">
  babel
</a></div><div class="nav-item"><a href="/buildTools/webpack/" class="nav-link">
  打包工具
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue/reactive/" class="nav-link">
  响应式
</a></li><li class="dropdown-item"><!----> <a href="/vue/compiler/" class="nav-link router-link-active">
  模版编译
</a></li><li class="dropdown-item"><!----> <a href="/vue/vnode/" class="nav-link">
  虚拟DOM
</a></li><li class="dropdown-item"><!----> <a href="/vue/whole-process/" class="nav-link">
  整体流程
</a></li><li class="dropdown-item"><!----> <a href="/vue/vuex/" class="nav-link">
  Vuex&amp;Vue-router
</a></li></ul></div></div><div class="nav-item"><a href="/mobile/" class="nav-link">
  移动端
</a></div><div class="nav-item"><a href="/code-reviews/" class="nav-link">
  LC
</a></div><div class="nav-item"><a href="/project/B/batch_download.html" class="nav-link">
  项目
</a></div><div class="nav-item"><a href="/news/vue3.html" class="nav-link">
  前沿
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://0zcl.github.io/utils-library/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  公共函数库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://0zcl.github.io/h5-sdk/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  h5-sdk
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/0zcl/h5_template" target="_blank" rel="noopener noreferrer" class="nav-link external">
  移动端多页面模版
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/0zcl/zcl-mobile-ui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  移动端组件库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://gitlab.61info.com:8190/zcl/tpc-cli" target="_blank" rel="noopener noreferrer" class="nav-link external">
  zcl脚手架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/Dachuizi-6" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/basic/basic/" class="nav-link">
  基础
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  css
</a></div><div class="nav-item"><a href="/browser/theory/" class="nav-link">
  浏览器相关
</a></div><div class="nav-item"><a href="/nodejs/" class="nav-link">
  nodejs
</a></div><div class="nav-item"><a href="/babel/" class="nav-link">
  babel
</a></div><div class="nav-item"><a href="/buildTools/webpack/" class="nav-link">
  打包工具
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue/reactive/" class="nav-link">
  响应式
</a></li><li class="dropdown-item"><!----> <a href="/vue/compiler/" class="nav-link router-link-active">
  模版编译
</a></li><li class="dropdown-item"><!----> <a href="/vue/vnode/" class="nav-link">
  虚拟DOM
</a></li><li class="dropdown-item"><!----> <a href="/vue/whole-process/" class="nav-link">
  整体流程
</a></li><li class="dropdown-item"><!----> <a href="/vue/vuex/" class="nav-link">
  Vuex&amp;Vue-router
</a></li></ul></div></div><div class="nav-item"><a href="/mobile/" class="nav-link">
  移动端
</a></div><div class="nav-item"><a href="/code-reviews/" class="nav-link">
  LC
</a></div><div class="nav-item"><a href="/project/B/batch_download.html" class="nav-link">
  项目
</a></div><div class="nav-item"><a href="/news/vue3.html" class="nav-link">
  前沿
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://0zcl.github.io/utils-library/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  公共函数库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://0zcl.github.io/h5-sdk/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  h5-sdk
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/0zcl/h5_template" target="_blank" rel="noopener noreferrer" class="nav-link external">
  移动端多页面模版
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/0zcl/zcl-mobile-ui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  移动端组件库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://gitlab.61info.com:8190/zcl/tpc-cli" target="_blank" rel="noopener noreferrer" class="nav-link external">
  zcl脚手架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/Dachuizi-6" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>模版编译</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/vue/compiler/" class="sidebar-heading clickable router-link-active open"><span>模版编译</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue/compiler/" aria-current="page" class="sidebar-link">模板编译</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue/compiler/#模板编译" class="sidebar-link">模板编译</a></li><li class="sidebar-sub-header"><a href="/vue/compiler/#vue模板渲染的原理是什么" class="sidebar-link">Vue模板渲染的原理是什么？</a></li><li class="sidebar-sub-header"><a href="/vue/compiler/#标记静态节点" class="sidebar-link">标记静态节点</a></li><li class="sidebar-sub-header"><a href="/vue/compiler/#静态节点类型" class="sidebar-link">静态节点类型</a></li><li class="sidebar-sub-header"><a href="/vue/compiler/#标记静态根节点" class="sidebar-link">标记静态根节点</a></li></ul></li><li><a href="/vue/compiler/slot.html" class="sidebar-link">插槽</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue/compiler/slot.html#slot是什么" class="sidebar-link">slot是什么？</a></li><li class="sidebar-sub-header"><a href="/vue/compiler/slot.html#有什么作用" class="sidebar-link">有什么作用？</a></li><li class="sidebar-sub-header"><a href="/vue/compiler/slot.html#默认插槽" class="sidebar-link">默认插槽</a></li><li class="sidebar-sub-header"><a href="/vue/compiler/slot.html#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/vue/compiler/slot.html#作用域插槽" class="sidebar-link">作用域插槽</a></li><li class="sidebar-sub-header"><a href="/vue/compiler/slot.html#总结-2" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/vue/compiler/slot.html#面试" class="sidebar-link">面试</a></li></ul></li><li><a href="/vue/compiler/keep-alive.html" aria-current="page" class="active sidebar-link">keep-alive</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue/compiler/keep-alive.html#基本使用" class="sidebar-link">基本使用</a></li><li class="sidebar-sub-header"><a href="/vue/compiler/keep-alive.html#结合vue-router" class="sidebar-link">结合vue-router</a></li><li class="sidebar-sub-header"><a href="/vue/compiler/keep-alive.html#lru策略" class="sidebar-link">LRU策略</a></li><li class="sidebar-sub-header"><a href="/vue/compiler/keep-alive.html#源码解析" class="sidebar-link">源码解析</a></li><li class="sidebar-sub-header"><a href="/vue/compiler/keep-alive.html#keep-alive组件渲染" class="sidebar-link">keep-alive组件渲染</a></li><li class="sidebar-sub-header"><a href="/vue/compiler/keep-alive.html#keep-alive组件渲染过程" class="sidebar-link">keep-alive组件渲染过程</a></li><li class="sidebar-sub-header"><a href="/vue/compiler/keep-alive.html#面试" class="sidebar-link">面试</a></li></ul></li></ul></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default" data-v-76901c3f data-v-76901c3f><h2 id="基本使用" data-v-76901c3f><a href="#基本使用" class="header-anchor" data-v-76901c3f>#</a> 基本使用</h2> <p data-v-76901c3f>keep-alive 是 Vue 内置的一个组件，可以使被包含的组件保留状态，或避免重新渲染。</p> <p data-v-76901c3f>keep-alive 新加入了两个属性: include(包含的组件缓存生效) 与 exclude(排除的组件不缓存)</p> <p data-v-76901c3f>include 和 exclude 属性允许组件有条件地缓存。二者都可以用逗号分隔字符串、正则表达式或一个数组来表示</p> <div class="language-html line-numbers-mode" data-v-76901c3f><pre class="language-html" data-v-76901c3f><code data-v-76901c3f><span class="token comment" data-v-76901c3f>&lt;!-- 逗号分隔字符串，只有组件a与b被缓存 --&gt;</span>
<span class="token tag" data-v-76901c3f><span class="token tag" data-v-76901c3f><span class="token punctuation" data-v-76901c3f>&lt;</span>keep-alive</span> <span class="token attr-name" data-v-76901c3f>include</span><span class="token attr-value" data-v-76901c3f><span class="token punctuation attr-equals" data-v-76901c3f>=</span><span class="token punctuation" data-v-76901c3f>&quot;</span>a,b<span class="token punctuation" data-v-76901c3f>&quot;</span></span><span class="token punctuation" data-v-76901c3f>&gt;</span></span>
  <span class="token tag" data-v-76901c3f><span class="token tag" data-v-76901c3f><span class="token punctuation" data-v-76901c3f>&lt;</span>component</span> <span class="token attr-name" data-v-76901c3f>:is</span><span class="token attr-value" data-v-76901c3f><span class="token punctuation attr-equals" data-v-76901c3f>=</span><span class="token punctuation" data-v-76901c3f>&quot;</span>view<span class="token punctuation" data-v-76901c3f>&quot;</span></span><span class="token punctuation" data-v-76901c3f>&gt;</span></span><span class="token tag" data-v-76901c3f><span class="token tag" data-v-76901c3f><span class="token punctuation" data-v-76901c3f>&lt;/</span>component</span><span class="token punctuation" data-v-76901c3f>&gt;</span></span>
<span class="token tag" data-v-76901c3f><span class="token tag" data-v-76901c3f><span class="token punctuation" data-v-76901c3f>&lt;/</span>keep-alive</span><span class="token punctuation" data-v-76901c3f>&gt;</span></span>
<span class="token comment" data-v-76901c3f>&lt;!-- 正则表达式 --&gt;</span>
<span class="token tag" data-v-76901c3f><span class="token tag" data-v-76901c3f><span class="token punctuation" data-v-76901c3f>&lt;</span>keep-alive</span> <span class="token attr-name" data-v-76901c3f>:include</span><span class="token attr-value" data-v-76901c3f><span class="token punctuation attr-equals" data-v-76901c3f>=</span><span class="token punctuation" data-v-76901c3f>&quot;</span>/a|b/<span class="token punctuation" data-v-76901c3f>&quot;</span></span><span class="token punctuation" data-v-76901c3f>&gt;</span></span>
  <span class="token tag" data-v-76901c3f><span class="token tag" data-v-76901c3f><span class="token punctuation" data-v-76901c3f>&lt;</span>component</span> <span class="token attr-name" data-v-76901c3f>:is</span><span class="token attr-value" data-v-76901c3f><span class="token punctuation attr-equals" data-v-76901c3f>=</span><span class="token punctuation" data-v-76901c3f>&quot;</span>view<span class="token punctuation" data-v-76901c3f>&quot;</span></span><span class="token punctuation" data-v-76901c3f>&gt;</span></span><span class="token tag" data-v-76901c3f><span class="token tag" data-v-76901c3f><span class="token punctuation" data-v-76901c3f>&lt;/</span>component</span><span class="token punctuation" data-v-76901c3f>&gt;</span></span>
<span class="token tag" data-v-76901c3f><span class="token tag" data-v-76901c3f><span class="token punctuation" data-v-76901c3f>&lt;/</span>keep-alive</span><span class="token punctuation" data-v-76901c3f>&gt;</span></span>
<span class="token comment" data-v-76901c3f>&lt;!-- Array --&gt;</span>
<span class="token tag" data-v-76901c3f><span class="token tag" data-v-76901c3f><span class="token punctuation" data-v-76901c3f>&lt;</span>keep-alive</span> <span class="token attr-name" data-v-76901c3f>:include</span><span class="token attr-value" data-v-76901c3f><span class="token punctuation attr-equals" data-v-76901c3f>=</span><span class="token punctuation" data-v-76901c3f>&quot;</span>[<span class="token punctuation" data-v-76901c3f>'</span>a<span class="token punctuation" data-v-76901c3f>'</span>, <span class="token punctuation" data-v-76901c3f>'</span>b<span class="token punctuation" data-v-76901c3f>'</span>]<span class="token punctuation" data-v-76901c3f>&quot;</span></span><span class="token punctuation" data-v-76901c3f>&gt;</span></span>
  <span class="token tag" data-v-76901c3f><span class="token tag" data-v-76901c3f><span class="token punctuation" data-v-76901c3f>&lt;</span>component</span> <span class="token attr-name" data-v-76901c3f>:is</span><span class="token attr-value" data-v-76901c3f><span class="token punctuation attr-equals" data-v-76901c3f>=</span><span class="token punctuation" data-v-76901c3f>&quot;</span>view<span class="token punctuation" data-v-76901c3f>&quot;</span></span><span class="token punctuation" data-v-76901c3f>&gt;</span></span><span class="token tag" data-v-76901c3f><span class="token tag" data-v-76901c3f><span class="token punctuation" data-v-76901c3f>&lt;/</span>component</span><span class="token punctuation" data-v-76901c3f>&gt;</span></span>
<span class="token tag" data-v-76901c3f><span class="token tag" data-v-76901c3f><span class="token punctuation" data-v-76901c3f>&lt;/</span>keep-alive</span><span class="token punctuation" data-v-76901c3f>&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper" data-v-76901c3f><span class="line-number" data-v-76901c3f>1</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>2</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>3</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>4</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>5</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>6</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>7</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>8</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>9</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>10</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>11</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>12</span><br data-v-76901c3f></div></div><h3 id="生命周期钩子" data-v-76901c3f><a href="#生命周期钩子" class="header-anchor" data-v-76901c3f>#</a> 生命周期钩子</h3> <p data-v-76901c3f>被包含在 <code data-v-76901c3f>&lt;keep-alive&gt;</code> 中创建的组件，会多出两个生命周期的钩子: activated 与 deactivated</p> <ul data-v-76901c3f><li data-v-76901c3f>activated: 在组件被激活时调用，在组件第一次渲染时也会被调用，之后每次keep-alive激活时被调用。</li> <li data-v-76901c3f>deactivated: 在组件被停用时调用。</li> <li data-v-76901c3f>首次进入组件时：beforeRouteEnter &gt; beforeCreate &gt; created&gt; mounted &gt; activated &gt; ... ... &gt; beforeRouteLeave &gt; deactivated</li> <li data-v-76901c3f>再次进入组件时：beforeRouteEnter &gt;activated &gt; ... ... &gt; beforeRouteLeave &gt; deactivated</li></ul> <p data-v-76901c3f>注意：</p> <div class="custom-block tip" data-v-76901c3f><p class="custom-block-title" data-v-76901c3f>Tips</p> <p data-v-76901c3f>当组件在 <code data-v-76901c3f>&lt;keep-alive&gt;</code> 内被切换，<code data-v-76901c3f>activated</code> 和 <code data-v-76901c3f>deactivated</code> 这两个生命周期才会被调用</p> <p data-v-76901c3f>在服务端渲染时此钩子也不会被调用的</p></div> <h2 id="结合vue-router" data-v-76901c3f><a href="#结合vue-router" class="header-anchor" data-v-76901c3f>#</a> 结合vue-router</h2> <p data-v-76901c3f>router-view 也是一个组件，如果直接被包在 keep-alive 里面，所有路径匹配到的视图组件都会被缓存。</p> <div class="language-html line-numbers-mode" data-v-76901c3f><pre class="language-html" data-v-76901c3f><code data-v-76901c3f><span class="token tag" data-v-76901c3f><span class="token tag" data-v-76901c3f><span class="token punctuation" data-v-76901c3f>&lt;</span>keep-alive</span><span class="token punctuation" data-v-76901c3f>&gt;</span></span>
  <span class="token tag" data-v-76901c3f><span class="token tag" data-v-76901c3f><span class="token punctuation" data-v-76901c3f>&lt;</span>router-view</span><span class="token punctuation" data-v-76901c3f>&gt;</span></span>
    <span class="token comment" data-v-76901c3f>&lt;!-- 所有路径匹配到的视图组件都会被缓存！ --&gt;</span>
  <span class="token tag" data-v-76901c3f><span class="token tag" data-v-76901c3f><span class="token punctuation" data-v-76901c3f>&lt;/</span>router-view</span><span class="token punctuation" data-v-76901c3f>&gt;</span></span>
<span class="token tag" data-v-76901c3f><span class="token tag" data-v-76901c3f><span class="token punctuation" data-v-76901c3f>&lt;/</span>keep-alive</span><span class="token punctuation" data-v-76901c3f>&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper" data-v-76901c3f><span class="line-number" data-v-76901c3f>1</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>2</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>3</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>4</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>5</span><br data-v-76901c3f></div></div><h2 id="lru策略" data-v-76901c3f><a href="#lru策略" class="header-anchor" data-v-76901c3f>#</a> LRU策略</h2> <p data-v-76901c3f>在使用 keep-alive 时，可以添加 prop 属性 include、exclude、max 允许组件有条件的缓存。既然有限制条件，旧的组件需要删除缓存，新的组件就需要加入到最新缓存，那么要如何制定对应的策略？</p> <p data-v-76901c3f>LRU（Least recently used，最近最少使用）策略根据数据的历史访问记录来进行淘汰数据。LRU 策略的设计原则是，如果一个数据在最近一段时间没有被访问到，那么在将来它被访问的可能性也很小。也就是说，<code data-v-76901c3f>当限定的空间已存满数据时，应当把最久没有被访问到的数据淘汰</code></p> <p data-v-76901c3f><img src="/assets/img/5.998b52e7.png" alt="LRU" data-v-76901c3f></p> <p data-v-76901c3f><code data-v-76901c3f>keep-alive</code> 缓存机制便是根据LRU策略来设置缓存组件新鲜度，将很久未访问的组件从缓存中删除</p> <h2 id="源码解析" data-v-76901c3f><a href="#源码解析" class="header-anchor" data-v-76901c3f>#</a> 源码解析</h2> <div class="language-js line-numbers-mode" data-v-76901c3f><pre class="language-js" data-v-76901c3f><code data-v-76901c3f><span class="token keyword" data-v-76901c3f>export</span> <span class="token keyword" data-v-76901c3f>default</span> <span class="token punctuation" data-v-76901c3f>{</span>
  <span class="token literal-property property" data-v-76901c3f>name</span><span class="token operator" data-v-76901c3f>:</span> <span class="token string" data-v-76901c3f>'keep-alive'</span><span class="token punctuation" data-v-76901c3f>,</span>
  <span class="token literal-property property" data-v-76901c3f>abstract</span><span class="token operator" data-v-76901c3f>:</span> <span class="token boolean" data-v-76901c3f>true</span><span class="token punctuation" data-v-76901c3f>,</span>

  <span class="token literal-property property" data-v-76901c3f>props</span><span class="token operator" data-v-76901c3f>:</span> <span class="token punctuation" data-v-76901c3f>{</span>
    <span class="token literal-property property" data-v-76901c3f>include</span><span class="token operator" data-v-76901c3f>:</span> patternTypes<span class="token punctuation" data-v-76901c3f>,</span>
    <span class="token literal-property property" data-v-76901c3f>exclude</span><span class="token operator" data-v-76901c3f>:</span> patternTypes<span class="token punctuation" data-v-76901c3f>,</span>
    <span class="token literal-property property" data-v-76901c3f>max</span><span class="token operator" data-v-76901c3f>:</span> <span class="token punctuation" data-v-76901c3f>[</span>String<span class="token punctuation" data-v-76901c3f>,</span> Number<span class="token punctuation" data-v-76901c3f>]</span>
  <span class="token punctuation" data-v-76901c3f>}</span><span class="token punctuation" data-v-76901c3f>,</span>

  <span class="token function" data-v-76901c3f>created</span> <span class="token punctuation" data-v-76901c3f>(</span><span class="token punctuation" data-v-76901c3f>)</span> <span class="token punctuation" data-v-76901c3f>{</span>
    <span class="token keyword" data-v-76901c3f>this</span><span class="token punctuation" data-v-76901c3f>.</span>cache <span class="token operator" data-v-76901c3f>=</span> Object<span class="token punctuation" data-v-76901c3f>.</span><span class="token function" data-v-76901c3f>create</span><span class="token punctuation" data-v-76901c3f>(</span><span class="token keyword" data-v-76901c3f>null</span><span class="token punctuation" data-v-76901c3f>)</span>
    <span class="token keyword" data-v-76901c3f>this</span><span class="token punctuation" data-v-76901c3f>.</span>keys <span class="token operator" data-v-76901c3f>=</span> <span class="token punctuation" data-v-76901c3f>[</span><span class="token punctuation" data-v-76901c3f>]</span>
  <span class="token punctuation" data-v-76901c3f>}</span><span class="token punctuation" data-v-76901c3f>,</span>

  <span class="token function" data-v-76901c3f>destroyed</span> <span class="token punctuation" data-v-76901c3f>(</span><span class="token punctuation" data-v-76901c3f>)</span> <span class="token punctuation" data-v-76901c3f>{</span>
    <span class="token keyword" data-v-76901c3f>for</span> <span class="token punctuation" data-v-76901c3f>(</span><span class="token keyword" data-v-76901c3f>const</span> key <span class="token keyword" data-v-76901c3f>in</span> <span class="token keyword" data-v-76901c3f>this</span><span class="token punctuation" data-v-76901c3f>.</span>cache<span class="token punctuation" data-v-76901c3f>)</span> <span class="token punctuation" data-v-76901c3f>{</span>
      <span class="token function" data-v-76901c3f>pruneCacheEntry</span><span class="token punctuation" data-v-76901c3f>(</span><span class="token keyword" data-v-76901c3f>this</span><span class="token punctuation" data-v-76901c3f>.</span>cache<span class="token punctuation" data-v-76901c3f>,</span> key<span class="token punctuation" data-v-76901c3f>,</span> <span class="token keyword" data-v-76901c3f>this</span><span class="token punctuation" data-v-76901c3f>.</span>keys<span class="token punctuation" data-v-76901c3f>)</span>
    <span class="token punctuation" data-v-76901c3f>}</span>
  <span class="token punctuation" data-v-76901c3f>}</span><span class="token punctuation" data-v-76901c3f>,</span>

  <span class="token function" data-v-76901c3f>mounted</span> <span class="token punctuation" data-v-76901c3f>(</span><span class="token punctuation" data-v-76901c3f>)</span> <span class="token punctuation" data-v-76901c3f>{</span>
    <span class="token keyword" data-v-76901c3f>this</span><span class="token punctuation" data-v-76901c3f>.</span><span class="token function" data-v-76901c3f>$watch</span><span class="token punctuation" data-v-76901c3f>(</span><span class="token string" data-v-76901c3f>'include'</span><span class="token punctuation" data-v-76901c3f>,</span> <span class="token parameter" data-v-76901c3f>val</span> <span class="token operator" data-v-76901c3f>=&gt;</span> <span class="token punctuation" data-v-76901c3f>{</span>
      <span class="token function" data-v-76901c3f>pruneCache</span><span class="token punctuation" data-v-76901c3f>(</span><span class="token keyword" data-v-76901c3f>this</span><span class="token punctuation" data-v-76901c3f>,</span> <span class="token parameter" data-v-76901c3f>name</span> <span class="token operator" data-v-76901c3f>=&gt;</span> <span class="token function" data-v-76901c3f>matches</span><span class="token punctuation" data-v-76901c3f>(</span>val<span class="token punctuation" data-v-76901c3f>,</span> name<span class="token punctuation" data-v-76901c3f>)</span><span class="token punctuation" data-v-76901c3f>)</span>
    <span class="token punctuation" data-v-76901c3f>}</span><span class="token punctuation" data-v-76901c3f>)</span>
    <span class="token keyword" data-v-76901c3f>this</span><span class="token punctuation" data-v-76901c3f>.</span><span class="token function" data-v-76901c3f>$watch</span><span class="token punctuation" data-v-76901c3f>(</span><span class="token string" data-v-76901c3f>'exclude'</span><span class="token punctuation" data-v-76901c3f>,</span> <span class="token parameter" data-v-76901c3f>val</span> <span class="token operator" data-v-76901c3f>=&gt;</span> <span class="token punctuation" data-v-76901c3f>{</span>
      <span class="token function" data-v-76901c3f>pruneCache</span><span class="token punctuation" data-v-76901c3f>(</span><span class="token keyword" data-v-76901c3f>this</span><span class="token punctuation" data-v-76901c3f>,</span> <span class="token parameter" data-v-76901c3f>name</span> <span class="token operator" data-v-76901c3f>=&gt;</span> <span class="token operator" data-v-76901c3f>!</span><span class="token function" data-v-76901c3f>matches</span><span class="token punctuation" data-v-76901c3f>(</span>val<span class="token punctuation" data-v-76901c3f>,</span> name<span class="token punctuation" data-v-76901c3f>)</span><span class="token punctuation" data-v-76901c3f>)</span>
    <span class="token punctuation" data-v-76901c3f>}</span><span class="token punctuation" data-v-76901c3f>)</span>
  <span class="token punctuation" data-v-76901c3f>}</span><span class="token punctuation" data-v-76901c3f>,</span>

  <span class="token function" data-v-76901c3f>render</span> <span class="token punctuation" data-v-76901c3f>(</span><span class="token punctuation" data-v-76901c3f>)</span> <span class="token punctuation" data-v-76901c3f>{</span>
    <span class="token keyword" data-v-76901c3f>const</span> slot <span class="token operator" data-v-76901c3f>=</span> <span class="token keyword" data-v-76901c3f>this</span><span class="token punctuation" data-v-76901c3f>.</span>$slots<span class="token punctuation" data-v-76901c3f>.</span>default
    <span class="token comment" data-v-76901c3f>// 找到第一个子组件对象</span>
    <span class="token keyword" data-v-76901c3f>const</span> <span class="token literal-property property" data-v-76901c3f>vnode</span><span class="token operator" data-v-76901c3f>:</span> VNode <span class="token operator" data-v-76901c3f>=</span> <span class="token function" data-v-76901c3f>getFirstComponentChild</span><span class="token punctuation" data-v-76901c3f>(</span>slot<span class="token punctuation" data-v-76901c3f>)</span>
    <span class="token keyword" data-v-76901c3f>const</span> <span class="token literal-property property" data-v-76901c3f>componentOptions</span><span class="token operator" data-v-76901c3f>:</span> <span class="token operator" data-v-76901c3f>?</span>VNodeComponentOptions <span class="token operator" data-v-76901c3f>=</span> vnode <span class="token operator" data-v-76901c3f>&amp;&amp;</span> vnode<span class="token punctuation" data-v-76901c3f>.</span>componentOptions
    <span class="token keyword" data-v-76901c3f>if</span> <span class="token punctuation" data-v-76901c3f>(</span>componentOptions<span class="token punctuation" data-v-76901c3f>)</span> <span class="token punctuation" data-v-76901c3f>{</span>
      <span class="token comment" data-v-76901c3f>// 组件名</span>
      <span class="token keyword" data-v-76901c3f>const</span> <span class="token literal-property property" data-v-76901c3f>name</span><span class="token operator" data-v-76901c3f>:</span> <span class="token operator" data-v-76901c3f>?</span>string <span class="token operator" data-v-76901c3f>=</span> <span class="token function" data-v-76901c3f>getComponentName</span><span class="token punctuation" data-v-76901c3f>(</span>componentOptions<span class="token punctuation" data-v-76901c3f>)</span>
      <span class="token keyword" data-v-76901c3f>const</span> <span class="token punctuation" data-v-76901c3f>{</span> include<span class="token punctuation" data-v-76901c3f>,</span> exclude <span class="token punctuation" data-v-76901c3f>}</span> <span class="token operator" data-v-76901c3f>=</span> <span class="token keyword" data-v-76901c3f>this</span>
      <span class="token keyword" data-v-76901c3f>if</span> <span class="token punctuation" data-v-76901c3f>(</span>
        <span class="token comment" data-v-76901c3f>// not included</span>
        <span class="token punctuation" data-v-76901c3f>(</span>include <span class="token operator" data-v-76901c3f>&amp;&amp;</span> <span class="token punctuation" data-v-76901c3f>(</span><span class="token operator" data-v-76901c3f>!</span>name <span class="token operator" data-v-76901c3f>||</span> <span class="token operator" data-v-76901c3f>!</span><span class="token function" data-v-76901c3f>matches</span><span class="token punctuation" data-v-76901c3f>(</span>include<span class="token punctuation" data-v-76901c3f>,</span> name<span class="token punctuation" data-v-76901c3f>)</span><span class="token punctuation" data-v-76901c3f>)</span><span class="token punctuation" data-v-76901c3f>)</span> <span class="token operator" data-v-76901c3f>||</span>
        <span class="token comment" data-v-76901c3f>// excluded</span>
        <span class="token punctuation" data-v-76901c3f>(</span>exclude <span class="token operator" data-v-76901c3f>&amp;&amp;</span> name <span class="token operator" data-v-76901c3f>&amp;&amp;</span> <span class="token function" data-v-76901c3f>matches</span><span class="token punctuation" data-v-76901c3f>(</span>exclude<span class="token punctuation" data-v-76901c3f>,</span> name<span class="token punctuation" data-v-76901c3f>)</span><span class="token punctuation" data-v-76901c3f>)</span>
      <span class="token punctuation" data-v-76901c3f>)</span> <span class="token punctuation" data-v-76901c3f>{</span>
        <span class="token keyword" data-v-76901c3f>return</span> vnode
      <span class="token punctuation" data-v-76901c3f>}</span>
      <span class="token keyword" data-v-76901c3f>const</span> <span class="token punctuation" data-v-76901c3f>{</span> cache<span class="token punctuation" data-v-76901c3f>,</span> keys <span class="token punctuation" data-v-76901c3f>}</span> <span class="token operator" data-v-76901c3f>=</span> <span class="token keyword" data-v-76901c3f>this</span>
      <span class="token comment" data-v-76901c3f>// 定义组件的缓存key. 如果vnode没有key，则根据组件ID和tag生成缓存Key</span>
      <span class="token keyword" data-v-76901c3f>const</span> <span class="token literal-property property" data-v-76901c3f>key</span><span class="token operator" data-v-76901c3f>:</span> <span class="token operator" data-v-76901c3f>?</span>string <span class="token operator" data-v-76901c3f>=</span> vnode<span class="token punctuation" data-v-76901c3f>.</span>key <span class="token operator" data-v-76901c3f>==</span> <span class="token keyword" data-v-76901c3f>null</span>
        <span class="token operator" data-v-76901c3f>?</span> componentOptions<span class="token punctuation" data-v-76901c3f>.</span>Ctor<span class="token punctuation" data-v-76901c3f>.</span>cid <span class="token operator" data-v-76901c3f>+</span> <span class="token punctuation" data-v-76901c3f>(</span>componentOptions<span class="token punctuation" data-v-76901c3f>.</span>tag <span class="token operator" data-v-76901c3f>?</span> <span class="token template-string" data-v-76901c3f><span class="token template-punctuation string" data-v-76901c3f>`</span><span class="token string" data-v-76901c3f>::</span><span class="token interpolation" data-v-76901c3f><span class="token interpolation-punctuation punctuation" data-v-76901c3f>${</span>componentOptions<span class="token punctuation" data-v-76901c3f>.</span>tag<span class="token interpolation-punctuation punctuation" data-v-76901c3f>}</span></span><span class="token template-punctuation string" data-v-76901c3f>`</span></span> <span class="token operator" data-v-76901c3f>:</span> <span class="token string" data-v-76901c3f>''</span><span class="token punctuation" data-v-76901c3f>)</span>
        <span class="token operator" data-v-76901c3f>:</span> vnode<span class="token punctuation" data-v-76901c3f>.</span>key
      <span class="token comment" data-v-76901c3f>// 已经缓存过该组件</span>
      <span class="token keyword" data-v-76901c3f>if</span> <span class="token punctuation" data-v-76901c3f>(</span>cache<span class="token punctuation" data-v-76901c3f>[</span>key<span class="token punctuation" data-v-76901c3f>]</span><span class="token punctuation" data-v-76901c3f>)</span> <span class="token punctuation" data-v-76901c3f>{</span>
        vnode<span class="token punctuation" data-v-76901c3f>.</span>componentInstance <span class="token operator" data-v-76901c3f>=</span> cache<span class="token punctuation" data-v-76901c3f>[</span>key<span class="token punctuation" data-v-76901c3f>]</span><span class="token punctuation" data-v-76901c3f>.</span>componentInstance
        <span class="token comment" data-v-76901c3f>// make current key freshest</span>
        <span class="token function" data-v-76901c3f>remove</span><span class="token punctuation" data-v-76901c3f>(</span>keys<span class="token punctuation" data-v-76901c3f>,</span> key<span class="token punctuation" data-v-76901c3f>)</span>
        keys<span class="token punctuation" data-v-76901c3f>.</span><span class="token function" data-v-76901c3f>push</span><span class="token punctuation" data-v-76901c3f>(</span>key<span class="token punctuation" data-v-76901c3f>)</span>
      <span class="token punctuation" data-v-76901c3f>}</span> <span class="token keyword" data-v-76901c3f>else</span> <span class="token punctuation" data-v-76901c3f>{</span>
        cache<span class="token punctuation" data-v-76901c3f>[</span>key<span class="token punctuation" data-v-76901c3f>]</span> <span class="token operator" data-v-76901c3f>=</span> vnode <span class="token comment" data-v-76901c3f>// 缓存组件对象</span>
        keys<span class="token punctuation" data-v-76901c3f>.</span><span class="token function" data-v-76901c3f>push</span><span class="token punctuation" data-v-76901c3f>(</span>key<span class="token punctuation" data-v-76901c3f>)</span>
        <span class="token comment" data-v-76901c3f>// 超过缓存数限制，将第一个删除</span>
        <span class="token keyword" data-v-76901c3f>if</span> <span class="token punctuation" data-v-76901c3f>(</span><span class="token keyword" data-v-76901c3f>this</span><span class="token punctuation" data-v-76901c3f>.</span>max <span class="token operator" data-v-76901c3f>&amp;&amp;</span> keys<span class="token punctuation" data-v-76901c3f>.</span>length <span class="token operator" data-v-76901c3f>&gt;</span> <span class="token function" data-v-76901c3f>parseInt</span><span class="token punctuation" data-v-76901c3f>(</span><span class="token keyword" data-v-76901c3f>this</span><span class="token punctuation" data-v-76901c3f>.</span>max<span class="token punctuation" data-v-76901c3f>)</span><span class="token punctuation" data-v-76901c3f>)</span> <span class="token punctuation" data-v-76901c3f>{</span>
          <span class="token function" data-v-76901c3f>pruneCacheEntry</span><span class="token punctuation" data-v-76901c3f>(</span>cache<span class="token punctuation" data-v-76901c3f>,</span> keys<span class="token punctuation" data-v-76901c3f>[</span><span class="token number" data-v-76901c3f>0</span><span class="token punctuation" data-v-76901c3f>]</span><span class="token punctuation" data-v-76901c3f>,</span> keys<span class="token punctuation" data-v-76901c3f>,</span> <span class="token keyword" data-v-76901c3f>this</span><span class="token punctuation" data-v-76901c3f>.</span>_vnode<span class="token punctuation" data-v-76901c3f>)</span>
        <span class="token punctuation" data-v-76901c3f>}</span>
      <span class="token punctuation" data-v-76901c3f>}</span>
      <span class="token comment" data-v-76901c3f>// 将该组件实例的keepAlive属性值设置为true</span>
      vnode<span class="token punctuation" data-v-76901c3f>.</span>data<span class="token punctuation" data-v-76901c3f>.</span>keepAlive <span class="token operator" data-v-76901c3f>=</span> <span class="token boolean" data-v-76901c3f>true</span>
    <span class="token punctuation" data-v-76901c3f>}</span>
    <span class="token keyword" data-v-76901c3f>return</span> vnode <span class="token operator" data-v-76901c3f>||</span> <span class="token punctuation" data-v-76901c3f>(</span>slot <span class="token operator" data-v-76901c3f>&amp;&amp;</span> slot<span class="token punctuation" data-v-76901c3f>[</span><span class="token number" data-v-76901c3f>0</span><span class="token punctuation" data-v-76901c3f>]</span><span class="token punctuation" data-v-76901c3f>)</span>
  <span class="token punctuation" data-v-76901c3f>}</span>
<span class="token punctuation" data-v-76901c3f>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-76901c3f><span class="line-number" data-v-76901c3f>1</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>2</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>3</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>4</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>5</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>6</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>7</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>8</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>9</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>10</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>11</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>12</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>13</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>14</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>15</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>16</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>17</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>18</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>19</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>20</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>21</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>22</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>23</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>24</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>25</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>26</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>27</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>28</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>29</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>30</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>31</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>32</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>33</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>34</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>35</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>36</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>37</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>38</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>39</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>40</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>41</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>42</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>43</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>44</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>45</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>46</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>47</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>48</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>49</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>50</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>51</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>52</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>53</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>54</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>55</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>56</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>57</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>58</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>59</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>60</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>61</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>62</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>63</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>64</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>65</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>66</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>67</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>68</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>69</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>70</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>71</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>72</span><br data-v-76901c3f></div></div><ul data-v-76901c3f><li data-v-76901c3f>组件缓存key放入<code data-v-76901c3f>this.keys</code>数组中。根据LRU策略，如果组件未缓存过，则直接push；若已缓存过，则先把keys数据中缓存的组件key删除，再push组件缓存key</li> <li data-v-76901c3f><code data-v-76901c3f>this.cache</code>对象中存储该组件实例并保存key值</li> <li data-v-76901c3f>检查缓存的实例数量是否超过max的设置值，超过则根据LRU策略删除最近最久未使用的实例（即是下标为0的那个key）</li> <li data-v-76901c3f>将该组件实例的<code data-v-76901c3f>keepAlive</code>属性值设置为true</li></ul> <p data-v-76901c3f>以上，是keep-alive的源码。简洁明了。</p> <h2 id="keep-alive组件渲染" data-v-76901c3f><a href="#keep-alive组件渲染" class="header-anchor" data-v-76901c3f>#</a> keep-alive组件渲染</h2> <p data-v-76901c3f><strong data-v-76901c3f>keep-alive 它不会生成真正的DOM节点，这是怎么做到的？</strong></p> <p data-v-76901c3f>kepp-alive 实际是一个<code data-v-76901c3f>抽象组件</code>，只对包裹的子组件做处理，并不会和子组件建立父子关系，也不会作为节点渲染到页面上。在组件开头就设置 <code data-v-76901c3f>abstract</code> 为 true，代表该组件是一个抽象组件。</p> <div class="language-js line-numbers-mode" data-v-76901c3f><pre class="language-js" data-v-76901c3f><code data-v-76901c3f><span class="token comment" data-v-76901c3f>// 源码位置： src/core/instance/lifecycle.js</span>
<span class="token keyword" data-v-76901c3f>export</span> <span class="token keyword" data-v-76901c3f>function</span> <span class="token function" data-v-76901c3f>initLifecycle</span> <span class="token punctuation" data-v-76901c3f>(</span><span class="token parameter" data-v-76901c3f><span class="token literal-property property" data-v-76901c3f>vm</span><span class="token operator" data-v-76901c3f>:</span> Component</span><span class="token punctuation" data-v-76901c3f>)</span> <span class="token punctuation" data-v-76901c3f>{</span>
  <span class="token keyword" data-v-76901c3f>const</span> options <span class="token operator" data-v-76901c3f>=</span> vm<span class="token punctuation" data-v-76901c3f>.</span>$options
  <span class="token comment" data-v-76901c3f>// 找到第一个非abstract的父组件实例</span>
  <span class="token keyword" data-v-76901c3f>let</span> parent <span class="token operator" data-v-76901c3f>=</span> options<span class="token punctuation" data-v-76901c3f>.</span>parent
  <span class="token keyword" data-v-76901c3f>if</span> <span class="token punctuation" data-v-76901c3f>(</span>parent <span class="token operator" data-v-76901c3f>&amp;&amp;</span> <span class="token operator" data-v-76901c3f>!</span>options<span class="token punctuation" data-v-76901c3f>.</span>abstract<span class="token punctuation" data-v-76901c3f>)</span> <span class="token punctuation" data-v-76901c3f>{</span>
    <span class="token keyword" data-v-76901c3f>while</span> <span class="token punctuation" data-v-76901c3f>(</span>parent<span class="token punctuation" data-v-76901c3f>.</span>$options<span class="token punctuation" data-v-76901c3f>.</span>abstract <span class="token operator" data-v-76901c3f>&amp;&amp;</span> parent<span class="token punctuation" data-v-76901c3f>.</span>$parent<span class="token punctuation" data-v-76901c3f>)</span> <span class="token punctuation" data-v-76901c3f>{</span>
      parent <span class="token operator" data-v-76901c3f>=</span> parent<span class="token punctuation" data-v-76901c3f>.</span>$parent
    <span class="token punctuation" data-v-76901c3f>}</span>
    parent<span class="token punctuation" data-v-76901c3f>.</span>$children<span class="token punctuation" data-v-76901c3f>.</span><span class="token function" data-v-76901c3f>push</span><span class="token punctuation" data-v-76901c3f>(</span>vm<span class="token punctuation" data-v-76901c3f>)</span>
  <span class="token punctuation" data-v-76901c3f>}</span>
  vm<span class="token punctuation" data-v-76901c3f>.</span>$parent <span class="token operator" data-v-76901c3f>=</span> parent
  <span class="token comment" data-v-76901c3f>// ...</span>
<span class="token punctuation" data-v-76901c3f>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-76901c3f><span class="line-number" data-v-76901c3f>1</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>2</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>3</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>4</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>5</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>6</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>7</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>8</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>9</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>10</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>11</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>12</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>13</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>14</span><br data-v-76901c3f></div></div><p data-v-76901c3f>在初始化阶段会调用 initLifecycle，里面判断父级是否为抽象组件，如果是抽象组件，就选取抽象组件的上一级作为父级，忽略与抽象组件和子组件之间的层级关系。</p> <p data-v-76901c3f>最后构建的组件树中就不会包含keep-alive组件，那么由组件树渲染成的DOM树自然也不会有keep-alive相关的节点了。</p> <p data-v-76901c3f>回到keep-alive组件，看看渲染keep-alive组件做了啥。
keep-alive组件由 <code data-v-76901c3f>render 函数</code>决定渲染结果</p> <div class="language-js line-numbers-mode" data-v-76901c3f><pre class="language-js" data-v-76901c3f><code data-v-76901c3f><span class="token keyword" data-v-76901c3f>const</span> slot <span class="token operator" data-v-76901c3f>=</span> <span class="token keyword" data-v-76901c3f>this</span><span class="token punctuation" data-v-76901c3f>.</span>$slots<span class="token punctuation" data-v-76901c3f>.</span>default
<span class="token keyword" data-v-76901c3f>const</span> <span class="token literal-property property" data-v-76901c3f>vnode</span><span class="token operator" data-v-76901c3f>:</span> VNode <span class="token operator" data-v-76901c3f>=</span> <span class="token function" data-v-76901c3f>getFirstComponentChild</span><span class="token punctuation" data-v-76901c3f>(</span>slot<span class="token punctuation" data-v-76901c3f>)</span>
</code></pre> <div class="line-numbers-wrapper" data-v-76901c3f><span class="line-number" data-v-76901c3f>1</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>2</span><br data-v-76901c3f></div></div><p data-v-76901c3f>如果 keep-alive 存在多个子元素，keep-alive 要求同时只有一个子元素被渲染。所以在开头会获取插槽内的子元素，调用 getFirstComponentChild 获取到第一个子元素的 VNode.</p> <div class="language-js line-numbers-mode" data-v-76901c3f><pre class="language-js" data-v-76901c3f><code data-v-76901c3f><span class="token keyword" data-v-76901c3f>if</span> <span class="token punctuation" data-v-76901c3f>(</span>
  <span class="token comment" data-v-76901c3f>// not included</span>
  <span class="token punctuation" data-v-76901c3f>(</span>include <span class="token operator" data-v-76901c3f>&amp;&amp;</span> <span class="token punctuation" data-v-76901c3f>(</span><span class="token operator" data-v-76901c3f>!</span>name <span class="token operator" data-v-76901c3f>||</span> <span class="token operator" data-v-76901c3f>!</span><span class="token function" data-v-76901c3f>matches</span><span class="token punctuation" data-v-76901c3f>(</span>include<span class="token punctuation" data-v-76901c3f>,</span> name<span class="token punctuation" data-v-76901c3f>)</span><span class="token punctuation" data-v-76901c3f>)</span><span class="token punctuation" data-v-76901c3f>)</span> <span class="token operator" data-v-76901c3f>||</span>
  <span class="token comment" data-v-76901c3f>// excluded</span>
  <span class="token punctuation" data-v-76901c3f>(</span>exclude <span class="token operator" data-v-76901c3f>&amp;&amp;</span> name <span class="token operator" data-v-76901c3f>&amp;&amp;</span> <span class="token function" data-v-76901c3f>matches</span><span class="token punctuation" data-v-76901c3f>(</span>exclude<span class="token punctuation" data-v-76901c3f>,</span> name<span class="token punctuation" data-v-76901c3f>)</span><span class="token punctuation" data-v-76901c3f>)</span>
<span class="token punctuation" data-v-76901c3f>)</span> <span class="token punctuation" data-v-76901c3f>{</span>
  <span class="token keyword" data-v-76901c3f>return</span> vnode
<span class="token punctuation" data-v-76901c3f>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-76901c3f><span class="line-number" data-v-76901c3f>1</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>2</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>3</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>4</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>5</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>6</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>7</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>8</span><br data-v-76901c3f></div></div><p data-v-76901c3f>判断当前组件【keep-alive组件内的第一个子组件】是否符合缓存条件，组件名与include不匹配或与exclude匹配都会直接退出并返回 VNode【组件实例】，不走缓存机制。</p> <div class="language-js line-numbers-mode" data-v-76901c3f><pre class="language-js" data-v-76901c3f><code data-v-76901c3f>vnode<span class="token punctuation" data-v-76901c3f>.</span>data<span class="token punctuation" data-v-76901c3f>.</span>keepAlive <span class="token operator" data-v-76901c3f>=</span> <span class="token boolean" data-v-76901c3f>true</span>
</code></pre> <div class="line-numbers-wrapper" data-v-76901c3f><span class="line-number" data-v-76901c3f>1</span><br data-v-76901c3f></div></div><p data-v-76901c3f>如果走缓存机制的话，最后会给keep-alive组件内的第一个子组件实例的keepAlive属性值设置为true</p> <div class="custom-block tip" data-v-76901c3f><p class="custom-block-title" data-v-76901c3f>Tips</p> <p data-v-76901c3f>keep-alive 它不会生成真正的DOM节点，但keep-alive 并非真的不会渲染，而是渲染的对象是包裹的子组件</p></div> <h2 id="keep-alive组件渲染过程" data-v-76901c3f><a href="#keep-alive组件渲染过程" class="header-anchor" data-v-76901c3f>#</a> keep-alive组件渲染过程</h2> <p data-v-76901c3f>渲染过程最主要的两个过程就是 render 和 patch，在 render 之前还会有模板编译，render 函数就是模板编译后的产物，它负责构建 VNode 树，构建好的 VNode 会传递给 patch，patch 根据 VNode 的关系生成真实dom节点树。</p> <p data-v-76901c3f>这张图描述了 Vue 视图渲染的流程：</p> <p data-v-76901c3f><img src="/assets/img/6.15792659.png" alt="render" data-v-76901c3f></p> <h3 id="keep-alive组件初始化渲染" data-v-76901c3f><a href="#keep-alive组件初始化渲染" class="header-anchor" data-v-76901c3f>#</a> keep-alive组件初始化渲染</h3> <p data-v-76901c3f>组件在 patch 过程是会执行 createComponent 来挂载组件的，A组件【缓存组件】也不例外。</p> <div class="language-js line-numbers-mode" data-v-76901c3f><pre class="language-js" data-v-76901c3f><code data-v-76901c3f><span class="token comment" data-v-76901c3f>// 源码位置：src/core/vdom/patch.js</span>
<span class="token keyword" data-v-76901c3f>function</span> <span class="token function" data-v-76901c3f>createComponent</span> <span class="token punctuation" data-v-76901c3f>(</span><span class="token parameter" data-v-76901c3f>vnode<span class="token punctuation" data-v-76901c3f>,</span> insertedVnodeQueue<span class="token punctuation" data-v-76901c3f>,</span> parentElm<span class="token punctuation" data-v-76901c3f>,</span> refElm</span><span class="token punctuation" data-v-76901c3f>)</span> <span class="token punctuation" data-v-76901c3f>{</span>
  <span class="token keyword" data-v-76901c3f>let</span> i <span class="token operator" data-v-76901c3f>=</span> vnode<span class="token punctuation" data-v-76901c3f>.</span>data
  <span class="token keyword" data-v-76901c3f>if</span> <span class="token punctuation" data-v-76901c3f>(</span><span class="token function" data-v-76901c3f>isDef</span><span class="token punctuation" data-v-76901c3f>(</span>i<span class="token punctuation" data-v-76901c3f>)</span><span class="token punctuation" data-v-76901c3f>)</span> <span class="token punctuation" data-v-76901c3f>{</span>
    <span class="token keyword" data-v-76901c3f>const</span> isReactivated <span class="token operator" data-v-76901c3f>=</span> <span class="token function" data-v-76901c3f>isDef</span><span class="token punctuation" data-v-76901c3f>(</span>vnode<span class="token punctuation" data-v-76901c3f>.</span>componentInstance<span class="token punctuation" data-v-76901c3f>)</span> <span class="token operator" data-v-76901c3f>&amp;&amp;</span> i<span class="token punctuation" data-v-76901c3f>.</span>keepAlive
    <span class="token keyword" data-v-76901c3f>if</span> <span class="token punctuation" data-v-76901c3f>(</span><span class="token function" data-v-76901c3f>isDef</span><span class="token punctuation" data-v-76901c3f>(</span>i <span class="token operator" data-v-76901c3f>=</span> i<span class="token punctuation" data-v-76901c3f>.</span>hook<span class="token punctuation" data-v-76901c3f>)</span> <span class="token operator" data-v-76901c3f>&amp;&amp;</span> <span class="token function" data-v-76901c3f>isDef</span><span class="token punctuation" data-v-76901c3f>(</span>i <span class="token operator" data-v-76901c3f>=</span> i<span class="token punctuation" data-v-76901c3f>.</span>init<span class="token punctuation" data-v-76901c3f>)</span><span class="token punctuation" data-v-76901c3f>)</span> <span class="token punctuation" data-v-76901c3f>{</span>
      <span class="token function" data-v-76901c3f>i</span><span class="token punctuation" data-v-76901c3f>(</span>vnode<span class="token punctuation" data-v-76901c3f>,</span> <span class="token boolean" data-v-76901c3f>false</span> <span class="token comment" data-v-76901c3f>/* hydrating */</span><span class="token punctuation" data-v-76901c3f>)</span>
    <span class="token punctuation" data-v-76901c3f>}</span>

    <span class="token keyword" data-v-76901c3f>if</span> <span class="token punctuation" data-v-76901c3f>(</span><span class="token function" data-v-76901c3f>isDef</span><span class="token punctuation" data-v-76901c3f>(</span>vnode<span class="token punctuation" data-v-76901c3f>.</span>componentInstance<span class="token punctuation" data-v-76901c3f>)</span><span class="token punctuation" data-v-76901c3f>)</span> <span class="token punctuation" data-v-76901c3f>{</span>
      <span class="token function" data-v-76901c3f>initComponent</span><span class="token punctuation" data-v-76901c3f>(</span>vnode<span class="token punctuation" data-v-76901c3f>,</span> insertedVnodeQueue<span class="token punctuation" data-v-76901c3f>)</span>
      <span class="token function" data-v-76901c3f>insert</span><span class="token punctuation" data-v-76901c3f>(</span>parentElm<span class="token punctuation" data-v-76901c3f>,</span> vnode<span class="token punctuation" data-v-76901c3f>.</span>elm<span class="token punctuation" data-v-76901c3f>,</span> refElm<span class="token punctuation" data-v-76901c3f>)</span>
      <span class="token keyword" data-v-76901c3f>if</span> <span class="token punctuation" data-v-76901c3f>(</span><span class="token function" data-v-76901c3f>isTrue</span><span class="token punctuation" data-v-76901c3f>(</span>isReactivated<span class="token punctuation" data-v-76901c3f>)</span><span class="token punctuation" data-v-76901c3f>)</span> <span class="token punctuation" data-v-76901c3f>{</span>
        <span class="token function" data-v-76901c3f>reactivateComponent</span><span class="token punctuation" data-v-76901c3f>(</span>vnode<span class="token punctuation" data-v-76901c3f>,</span> insertedVnodeQueue<span class="token punctuation" data-v-76901c3f>,</span> parentElm<span class="token punctuation" data-v-76901c3f>,</span> refElm<span class="token punctuation" data-v-76901c3f>)</span>
      <span class="token punctuation" data-v-76901c3f>}</span>
      <span class="token keyword" data-v-76901c3f>return</span> <span class="token boolean" data-v-76901c3f>true</span>
    <span class="token punctuation" data-v-76901c3f>}</span>
  <span class="token punctuation" data-v-76901c3f>}</span>
<span class="token punctuation" data-v-76901c3f>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-76901c3f><span class="line-number" data-v-76901c3f>1</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>2</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>3</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>4</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>5</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>6</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>7</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>8</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>9</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>10</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>11</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>12</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>13</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>14</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>15</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>16</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>17</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>18</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>19</span><br data-v-76901c3f></div></div><p data-v-76901c3f>isReactivated 标识组件是否重新激活。在A组件初始化渲染时，A组件还没有初始化构造完成，componentInstance 还是 undefined。而A组件的 keepAlive 是 true，因为 keep-alive 作为父级包裹组件，会先于A组件挂载，也就是 kepp-alive 会先执行 render 的过程，A组件被缓存起来，之后对插槽内第一个组件（A组件）的 keepAlive 赋值为 true。</p> <p data-v-76901c3f><strong data-v-76901c3f>在初始化渲染中，keep-alive 将A组件缓存起来，然后正常的渲染A组件</strong></p> <h3 id="缓存渲染" data-v-76901c3f><a href="#缓存渲染" class="header-anchor" data-v-76901c3f>#</a> 缓存渲染</h3> <p data-v-76901c3f>当切换到B组件，再切换回A组件时，A组件命中缓存被重新激活
非初始化渲染时，patch 会调用 patchVnode 对比新旧节点。patchVnode 内会调用 prepatch更新节属性。 prepatch内调用 updateChildComponent来更新vnode属性。</p> <div class="language-js line-numbers-mode" data-v-76901c3f><pre class="language-js" data-v-76901c3f><code data-v-76901c3f><span class="token comment" data-v-76901c3f>// 源码位置：src/core/instance/lifecycle.js</span>
<span class="token keyword" data-v-76901c3f>export</span> <span class="token keyword" data-v-76901c3f>function</span> <span class="token function" data-v-76901c3f>updateChildComponent</span> <span class="token punctuation" data-v-76901c3f>(</span>
  <span class="token parameter" data-v-76901c3f><span class="token literal-property property" data-v-76901c3f>vm</span><span class="token operator" data-v-76901c3f>:</span> Component<span class="token punctuation" data-v-76901c3f>,</span>
  <span class="token literal-property property" data-v-76901c3f>propsData</span><span class="token operator" data-v-76901c3f>:</span> <span class="token operator" data-v-76901c3f>?</span>Object<span class="token punctuation" data-v-76901c3f>,</span>
  <span class="token literal-property property" data-v-76901c3f>listeners</span><span class="token operator" data-v-76901c3f>:</span> <span class="token operator" data-v-76901c3f>?</span>Object<span class="token punctuation" data-v-76901c3f>,</span>
  <span class="token literal-property property" data-v-76901c3f>parentVnode</span><span class="token operator" data-v-76901c3f>:</span> MountedComponentVNode<span class="token punctuation" data-v-76901c3f>,</span>
  <span class="token literal-property property" data-v-76901c3f>renderChildren</span><span class="token operator" data-v-76901c3f>:</span> <span class="token operator" data-v-76901c3f>?</span>Array<span class="token operator" data-v-76901c3f>&lt;</span>VNode<span class="token operator" data-v-76901c3f>&gt;</span></span>
<span class="token punctuation" data-v-76901c3f>)</span> <span class="token punctuation" data-v-76901c3f>{</span>
  <span class="token comment" data-v-76901c3f>// ...</span>
  <span class="token keyword" data-v-76901c3f>const</span> needsForceUpdate <span class="token operator" data-v-76901c3f>=</span> <span class="token operator" data-v-76901c3f>!</span><span class="token operator" data-v-76901c3f>!</span><span class="token punctuation" data-v-76901c3f>(</span>
    renderChildren <span class="token operator" data-v-76901c3f>||</span>               <span class="token comment" data-v-76901c3f>// has new static slots</span>
    vm<span class="token punctuation" data-v-76901c3f>.</span>$options<span class="token punctuation" data-v-76901c3f>.</span>_renderChildren <span class="token operator" data-v-76901c3f>||</span>  <span class="token comment" data-v-76901c3f>// has old static slots</span>
    hasDynamicScopedSlot
  <span class="token punctuation" data-v-76901c3f>)</span>
  <span class="token comment" data-v-76901c3f>// ...</span>
  <span class="token comment" data-v-76901c3f>// resolve slots + force update if has children</span>
  <span class="token keyword" data-v-76901c3f>if</span> <span class="token punctuation" data-v-76901c3f>(</span>needsForceUpdate<span class="token punctuation" data-v-76901c3f>)</span> <span class="token punctuation" data-v-76901c3f>{</span>
    vm<span class="token punctuation" data-v-76901c3f>.</span>$slots <span class="token operator" data-v-76901c3f>=</span> <span class="token function" data-v-76901c3f>resolveSlots</span><span class="token punctuation" data-v-76901c3f>(</span>renderChildren<span class="token punctuation" data-v-76901c3f>,</span> parentVnode<span class="token punctuation" data-v-76901c3f>.</span>context<span class="token punctuation" data-v-76901c3f>)</span>
    vm<span class="token punctuation" data-v-76901c3f>.</span><span class="token function" data-v-76901c3f>$forceUpdate</span><span class="token punctuation" data-v-76901c3f>(</span><span class="token punctuation" data-v-76901c3f>)</span>
  <span class="token punctuation" data-v-76901c3f>}</span>
<span class="token punctuation" data-v-76901c3f>}</span>
<span class="token class-name" data-v-76901c3f>Vue</span><span class="token punctuation" data-v-76901c3f>.</span>prototype<span class="token punctuation" data-v-76901c3f>.</span><span class="token function-variable function" data-v-76901c3f>$forceUpdate</span> <span class="token operator" data-v-76901c3f>=</span> <span class="token keyword" data-v-76901c3f>function</span> <span class="token punctuation" data-v-76901c3f>(</span><span class="token punctuation" data-v-76901c3f>)</span> <span class="token punctuation" data-v-76901c3f>{</span>
  <span class="token keyword" data-v-76901c3f>const</span> <span class="token literal-property property" data-v-76901c3f>vm</span><span class="token operator" data-v-76901c3f>:</span> Component <span class="token operator" data-v-76901c3f>=</span> <span class="token keyword" data-v-76901c3f>this</span>
  <span class="token keyword" data-v-76901c3f>if</span> <span class="token punctuation" data-v-76901c3f>(</span>vm<span class="token punctuation" data-v-76901c3f>.</span>_watcher<span class="token punctuation" data-v-76901c3f>)</span> <span class="token punctuation" data-v-76901c3f>{</span>
    <span class="token comment" data-v-76901c3f>// 这里最终会执行 vm._update(vm._render)</span>
    vm<span class="token punctuation" data-v-76901c3f>.</span>_watcher<span class="token punctuation" data-v-76901c3f>.</span><span class="token function" data-v-76901c3f>update</span><span class="token punctuation" data-v-76901c3f>(</span><span class="token punctuation" data-v-76901c3f>)</span>
  <span class="token punctuation" data-v-76901c3f>}</span>
<span class="token punctuation" data-v-76901c3f>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-76901c3f><span class="line-number" data-v-76901c3f>1</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>2</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>3</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>4</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>5</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>6</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>7</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>8</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>9</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>10</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>11</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>12</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>13</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>14</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>15</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>16</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>17</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>18</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>19</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>20</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>21</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>22</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>23</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>24</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>25</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>26</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>27</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>28</span><br data-v-76901c3f></div></div><p data-v-76901c3f>从注释中可以看到 needsForceUpdate 是有插槽才会为 true，keep-alive 符合条件。首先调用 resolveSlots 更新 keep-alive 的插槽，然后调用 $forceUpdate 让 keep-alive 重新渲染，再走一遍 render。因为A组件在初始化已经缓存了，keep-alive 直接返回缓存好的A组件 VNode。VNode 准备好后，又来到了 patch 阶段中的createComponent</p> <p data-v-76901c3f>A组件再次经历 createComponent 的过程，调用 init</p> <div class="language-js line-numbers-mode" data-v-76901c3f><pre class="language-js" data-v-76901c3f><code data-v-76901c3f><span class="token keyword" data-v-76901c3f>const</span> componentVNodeHooks <span class="token operator" data-v-76901c3f>=</span> <span class="token punctuation" data-v-76901c3f>{</span>
  <span class="token function" data-v-76901c3f>init</span> <span class="token punctuation" data-v-76901c3f>(</span>vnode<span class="token operator" data-v-76901c3f>:</span> VNodeWithData<span class="token punctuation" data-v-76901c3f>,</span> <span class="token literal-property property" data-v-76901c3f>hydrating</span><span class="token operator" data-v-76901c3f>:</span> boolean<span class="token punctuation" data-v-76901c3f>)</span><span class="token operator" data-v-76901c3f>:</span> <span class="token operator" data-v-76901c3f>?</span>boolean <span class="token punctuation" data-v-76901c3f>{</span>
    <span class="token keyword" data-v-76901c3f>if</span> <span class="token punctuation" data-v-76901c3f>(</span>
      vnode<span class="token punctuation" data-v-76901c3f>.</span>componentInstance <span class="token operator" data-v-76901c3f>&amp;&amp;</span>
      <span class="token operator" data-v-76901c3f>!</span>vnode<span class="token punctuation" data-v-76901c3f>.</span>componentInstance<span class="token punctuation" data-v-76901c3f>.</span>_isDestroyed <span class="token operator" data-v-76901c3f>&amp;&amp;</span>
      vnode<span class="token punctuation" data-v-76901c3f>.</span>data<span class="token punctuation" data-v-76901c3f>.</span>keepAlive
    <span class="token punctuation" data-v-76901c3f>)</span> <span class="token punctuation" data-v-76901c3f>{</span>
      <span class="token comment" data-v-76901c3f>// kept-alive components, treat as a patch</span>
      <span class="token keyword" data-v-76901c3f>const</span> <span class="token literal-property property" data-v-76901c3f>mountedNode</span><span class="token operator" data-v-76901c3f>:</span> any <span class="token operator" data-v-76901c3f>=</span> vnode <span class="token comment" data-v-76901c3f>// work around flow</span>
      componentVNodeHooks<span class="token punctuation" data-v-76901c3f>.</span><span class="token function" data-v-76901c3f>prepatch</span><span class="token punctuation" data-v-76901c3f>(</span>mountedNode<span class="token punctuation" data-v-76901c3f>,</span> mountedNode<span class="token punctuation" data-v-76901c3f>)</span>
    <span class="token punctuation" data-v-76901c3f>}</span> <span class="token keyword" data-v-76901c3f>else</span> <span class="token punctuation" data-v-76901c3f>{</span>
      <span class="token keyword" data-v-76901c3f>const</span> child <span class="token operator" data-v-76901c3f>=</span> vnode<span class="token punctuation" data-v-76901c3f>.</span>componentInstance <span class="token operator" data-v-76901c3f>=</span> <span class="token function" data-v-76901c3f>createComponentInstanceForVnode</span><span class="token punctuation" data-v-76901c3f>(</span>
        vnode<span class="token punctuation" data-v-76901c3f>,</span>
        activeInstance
      <span class="token punctuation" data-v-76901c3f>)</span>
      child<span class="token punctuation" data-v-76901c3f>.</span><span class="token function" data-v-76901c3f>$mount</span><span class="token punctuation" data-v-76901c3f>(</span>hydrating <span class="token operator" data-v-76901c3f>?</span> vnode<span class="token punctuation" data-v-76901c3f>.</span>elm <span class="token operator" data-v-76901c3f>:</span> <span class="token keyword" data-v-76901c3f>undefined</span><span class="token punctuation" data-v-76901c3f>,</span> hydrating<span class="token punctuation" data-v-76901c3f>)</span>
    <span class="token punctuation" data-v-76901c3f>}</span>
  <span class="token punctuation" data-v-76901c3f>}</span><span class="token punctuation" data-v-76901c3f>,</span>
<span class="token punctuation" data-v-76901c3f>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-76901c3f><span class="line-number" data-v-76901c3f>1</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>2</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>3</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>4</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>5</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>6</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>7</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>8</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>9</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>10</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>11</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>12</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>13</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>14</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>15</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>16</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>17</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>18</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>19</span><br data-v-76901c3f></div></div><p data-v-76901c3f>这时将不再走 $mount 的逻辑，只调用 prepatch 更新实例属性。所以在缓存组件被激活时，不会执行 created 和 mounted 的生命周期函数。</p> <p data-v-76901c3f>最后调用 insert 插入组件的dom节点，至此缓存渲染流程完成</p> <p data-v-76901c3f><strong data-v-76901c3f>缓存渲染时，keep-alive 会更新插槽内容，之后 $forceUpdate 重新渲染</strong></p> <h2 id="面试" data-v-76901c3f><a href="#面试" class="header-anchor" data-v-76901c3f>#</a> 面试</h2> <p data-v-76901c3f>问：如何实现？
假设这里有 3 个路由： A、B、C。需求：</p> <ul data-v-76901c3f><li data-v-76901c3f>默认显示 A</li> <li data-v-76901c3f>B 跳到 A，A 不刷新</li> <li data-v-76901c3f>C 跳到 A，A 刷新</li></ul> <p data-v-76901c3f>答：
使用keep-alive + router-view结合</p> <div class="language-html line-numbers-mode" data-v-76901c3f><pre class="language-html" data-v-76901c3f><code data-v-76901c3f><span class="token tag" data-v-76901c3f><span class="token tag" data-v-76901c3f><span class="token punctuation" data-v-76901c3f>&lt;</span>keep-alive</span> <span class="token attr-name" data-v-76901c3f>v-if</span><span class="token attr-value" data-v-76901c3f><span class="token punctuation attr-equals" data-v-76901c3f>=</span><span class="token punctuation" data-v-76901c3f>&quot;</span>$route.meta.keepAlive<span class="token punctuation" data-v-76901c3f>&quot;</span></span><span class="token punctuation" data-v-76901c3f>&gt;</span></span>
  <span class="token tag" data-v-76901c3f><span class="token tag" data-v-76901c3f><span class="token punctuation" data-v-76901c3f>&lt;</span>router-view</span><span class="token punctuation" data-v-76901c3f>&gt;</span></span><span class="token tag" data-v-76901c3f><span class="token tag" data-v-76901c3f><span class="token punctuation" data-v-76901c3f>&lt;/</span>router-view</span><span class="token punctuation" data-v-76901c3f>&gt;</span></span>
<span class="token tag" data-v-76901c3f><span class="token tag" data-v-76901c3f><span class="token punctuation" data-v-76901c3f>&lt;/</span>keep-alive</span><span class="token punctuation" data-v-76901c3f>&gt;</span></span>
<span class="token tag" data-v-76901c3f><span class="token tag" data-v-76901c3f><span class="token punctuation" data-v-76901c3f>&lt;</span>router-view</span> <span class="token attr-name" data-v-76901c3f>v-else</span><span class="token punctuation" data-v-76901c3f>&gt;</span></span><span class="token tag" data-v-76901c3f><span class="token tag" data-v-76901c3f><span class="token punctuation" data-v-76901c3f>&lt;/</span>router-view</span><span class="token punctuation" data-v-76901c3f>&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper" data-v-76901c3f><span class="line-number" data-v-76901c3f>1</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>2</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>3</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>4</span><br data-v-76901c3f></div></div><ol data-v-76901c3f><li data-v-76901c3f>A路由，设置meta.keepAlive属性</li></ol> <div class="language-js line-numbers-mode" data-v-76901c3f><pre class="language-js" data-v-76901c3f><code data-v-76901c3f><span class="token punctuation" data-v-76901c3f>{</span>
  <span class="token literal-property property" data-v-76901c3f>path</span><span class="token operator" data-v-76901c3f>:</span> <span class="token string" data-v-76901c3f>'/'</span><span class="token punctuation" data-v-76901c3f>,</span>
  <span class="token literal-property property" data-v-76901c3f>name</span><span class="token operator" data-v-76901c3f>:</span> <span class="token string" data-v-76901c3f>'A'</span><span class="token punctuation" data-v-76901c3f>,</span>
  <span class="token literal-property property" data-v-76901c3f>component</span><span class="token operator" data-v-76901c3f>:</span> <span class="token constant" data-v-76901c3f>A</span><span class="token punctuation" data-v-76901c3f>,</span>
  <span class="token literal-property property" data-v-76901c3f>meta</span><span class="token operator" data-v-76901c3f>:</span> <span class="token punctuation" data-v-76901c3f>{</span>
    <span class="token literal-property property" data-v-76901c3f>keepAlive</span><span class="token operator" data-v-76901c3f>:</span> <span class="token boolean" data-v-76901c3f>true</span> <span class="token comment" data-v-76901c3f>// 默认会缓存</span>
  <span class="token punctuation" data-v-76901c3f>}</span>
<span class="token punctuation" data-v-76901c3f>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-76901c3f><span class="line-number" data-v-76901c3f>1</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>2</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>3</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>4</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>5</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>6</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>7</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>8</span><br data-v-76901c3f></div></div><ol start="2" data-v-76901c3f><li data-v-76901c3f>在 B 组件里面设置 beforeRouteLeave</li></ol> <div class="language-js line-numbers-mode" data-v-76901c3f><pre class="language-js" data-v-76901c3f><code data-v-76901c3f><span class="token keyword" data-v-76901c3f>export</span> <span class="token keyword" data-v-76901c3f>default</span> <span class="token punctuation" data-v-76901c3f>{</span>
  <span class="token function" data-v-76901c3f>data</span><span class="token punctuation" data-v-76901c3f>(</span><span class="token punctuation" data-v-76901c3f>)</span> <span class="token punctuation" data-v-76901c3f>{</span>
    <span class="token keyword" data-v-76901c3f>return</span> <span class="token punctuation" data-v-76901c3f>{</span><span class="token punctuation" data-v-76901c3f>}</span><span class="token punctuation" data-v-76901c3f>;</span>
  <span class="token punctuation" data-v-76901c3f>}</span><span class="token punctuation" data-v-76901c3f>,</span>
  <span class="token literal-property property" data-v-76901c3f>methods</span><span class="token operator" data-v-76901c3f>:</span> <span class="token punctuation" data-v-76901c3f>{</span><span class="token punctuation" data-v-76901c3f>}</span><span class="token punctuation" data-v-76901c3f>,</span>
  <span class="token function" data-v-76901c3f>beforeRouteLeave</span><span class="token punctuation" data-v-76901c3f>(</span><span class="token parameter" data-v-76901c3f>to<span class="token punctuation" data-v-76901c3f>,</span> from<span class="token punctuation" data-v-76901c3f>,</span> next</span><span class="token punctuation" data-v-76901c3f>)</span> <span class="token punctuation" data-v-76901c3f>{</span>
    <span class="token comment" data-v-76901c3f>// 设置下一个路由的 meta</span>
    to<span class="token punctuation" data-v-76901c3f>.</span>meta<span class="token punctuation" data-v-76901c3f>.</span>keepAlive <span class="token operator" data-v-76901c3f>=</span> <span class="token boolean" data-v-76901c3f>true</span><span class="token punctuation" data-v-76901c3f>;</span>  <span class="token comment" data-v-76901c3f>// 让 A 缓存，即不刷新</span>
    <span class="token function" data-v-76901c3f>next</span><span class="token punctuation" data-v-76901c3f>(</span><span class="token punctuation" data-v-76901c3f>)</span><span class="token punctuation" data-v-76901c3f>;</span>
  <span class="token punctuation" data-v-76901c3f>}</span>
<span class="token punctuation" data-v-76901c3f>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-76901c3f><span class="line-number" data-v-76901c3f>1</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>2</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>3</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>4</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>5</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>6</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>7</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>8</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>9</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>10</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>11</span><br data-v-76901c3f></div></div><ol start="3" data-v-76901c3f><li data-v-76901c3f>在 C 组件里面设置 beforeRouteLeave</li></ol> <div class="language-js line-numbers-mode" data-v-76901c3f><pre class="language-js" data-v-76901c3f><code data-v-76901c3f><span class="token keyword" data-v-76901c3f>export</span> <span class="token keyword" data-v-76901c3f>default</span> <span class="token punctuation" data-v-76901c3f>{</span>
  <span class="token function" data-v-76901c3f>data</span><span class="token punctuation" data-v-76901c3f>(</span><span class="token punctuation" data-v-76901c3f>)</span> <span class="token punctuation" data-v-76901c3f>{</span>
    <span class="token keyword" data-v-76901c3f>return</span> <span class="token punctuation" data-v-76901c3f>{</span><span class="token punctuation" data-v-76901c3f>}</span><span class="token punctuation" data-v-76901c3f>;</span>
  <span class="token punctuation" data-v-76901c3f>}</span><span class="token punctuation" data-v-76901c3f>,</span>
  <span class="token literal-property property" data-v-76901c3f>methods</span><span class="token operator" data-v-76901c3f>:</span> <span class="token punctuation" data-v-76901c3f>{</span><span class="token punctuation" data-v-76901c3f>}</span><span class="token punctuation" data-v-76901c3f>,</span>
  <span class="token function" data-v-76901c3f>beforeRouteLeave</span><span class="token punctuation" data-v-76901c3f>(</span><span class="token parameter" data-v-76901c3f>to<span class="token punctuation" data-v-76901c3f>,</span> from<span class="token punctuation" data-v-76901c3f>,</span> next</span><span class="token punctuation" data-v-76901c3f>)</span> <span class="token punctuation" data-v-76901c3f>{</span>
    <span class="token comment" data-v-76901c3f>// 设置下一个路由的 meta</span>
    to<span class="token punctuation" data-v-76901c3f>.</span>meta<span class="token punctuation" data-v-76901c3f>.</span>keepAlive <span class="token operator" data-v-76901c3f>=</span> <span class="token boolean" data-v-76901c3f>false</span><span class="token punctuation" data-v-76901c3f>;</span> <span class="token comment" data-v-76901c3f>// 让 A 不缓存，即刷新</span>
    <span class="token function" data-v-76901c3f>next</span><span class="token punctuation" data-v-76901c3f>(</span><span class="token punctuation" data-v-76901c3f>)</span><span class="token punctuation" data-v-76901c3f>;</span>
  <span class="token punctuation" data-v-76901c3f>}</span>
<span class="token punctuation" data-v-76901c3f>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-76901c3f><span class="line-number" data-v-76901c3f>1</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>2</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>3</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>4</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>5</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>6</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>7</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>8</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>9</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>10</span><br data-v-76901c3f><span class="line-number" data-v-76901c3f>11</span><br data-v-76901c3f></div></div><p data-v-76901c3f>这样便能实现 B 回到 A，A 不刷新；而 C 回到 A 则刷新</p> <p data-v-76901c3f>问：keep-alive原理，说说你的理解</p> <p data-v-76901c3f>答：</p> <ol data-v-76901c3f><li data-v-76901c3f>抽象组件：keep-alive 组件通过abstract 来声明成抽象组件, 在生成组件对应父子关系时会跳过抽象组件，所以keep-alive不会生成真正的DOM节点</li> <li data-v-76901c3f>渲染keep-alive: keep-alive组件定义了render函数。虽然keep-alive不会生成真正的DOM节点，但keep-alive 并非真的不会渲染，而是对keep-alive包裹的第一个子组件做处理(用到插槽this.$slots.default)；根据LRU策略缓存组件 VNode；render 函数返回第一个子组件的 VNode</li> <li data-v-76901c3f>缓存渲染过程：</li></ol> <ul data-v-76901c3f><li data-v-76901c3f>初始化渲染：，keep-alive 将缓存组件缓存起来，然后正常的渲染组件</li> <li data-v-76901c3f>缓存渲染时，keep-alive 会更新插槽内容，之后 $forceUpdate 重新渲染，从缓存中读取之前的组件 VNode 实现状态缓存</li></ul> <p data-v-76901c3f><strong data-v-76901c3f>第三步加点额外理解</strong>：$forceUpdate重新渲染，先渲染keep-alive，从this.cache缓存命中缓存组件，返回缓存组件的vnode。接着渲染缓存组件，由于vnode.componentInstance &amp;&amp; vnode.data.keepAlive为true，所以不走$mount，也就没有beforeCreate、created、mounted 钩子</p> <p data-v-76901c3f>参考：
<a href="https://www.jianshu.com/p/0b0222954483" target="_blank" rel="noopener noreferrer" data-v-76901c3f>vue-router 之 keep-alive<span data-v-76901c3f><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://www.cnblogs.com/chanwahfung/p/13523396.html" target="_blank" rel="noopener noreferrer" data-v-76901c3f>Vue源码解析，keep-alive是如何实现缓存的？<span data-v-76901c3f><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://juejin.cn/post/6844903837770203144" target="_blank" rel="noopener noreferrer" data-v-76901c3f>彻底揭秘keep-alive原理<span data-v-76901c3f><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/13/2021, 11:38:38 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vue/compiler/slot.html" class="prev">
        插槽
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.e8c3aa62.js" defer></script><script src="/assets/js/2.1d5e0d04.js" defer></script><script src="/assets/js/29.391ab5ba.js" defer></script>
  </body>
</html>
