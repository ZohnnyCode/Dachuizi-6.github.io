<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Zohnny前端小册</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Zohnny前端小册">
    
    <link rel="preload" href="/assets/css/0.styles.9a0b0289.css" as="style"><link rel="preload" href="/assets/js/app.e8c3aa62.js" as="script"><link rel="preload" href="/assets/js/2.1d5e0d04.js" as="script"><link rel="preload" href="/assets/js/18.5e0519af.js" as="script"><link rel="prefetch" href="/assets/js/10.0bc17075.js"><link rel="prefetch" href="/assets/js/100.194dcfa0.js"><link rel="prefetch" href="/assets/js/101.f8977d49.js"><link rel="prefetch" href="/assets/js/102.68d460f2.js"><link rel="prefetch" href="/assets/js/103.3ac580e7.js"><link rel="prefetch" href="/assets/js/104.9d4751c7.js"><link rel="prefetch" href="/assets/js/105.a5f0c700.js"><link rel="prefetch" href="/assets/js/106.e56dcf3c.js"><link rel="prefetch" href="/assets/js/107.1f1c30b4.js"><link rel="prefetch" href="/assets/js/108.68ca0fc6.js"><link rel="prefetch" href="/assets/js/109.50ce68c2.js"><link rel="prefetch" href="/assets/js/11.979bcc85.js"><link rel="prefetch" href="/assets/js/110.f56975a0.js"><link rel="prefetch" href="/assets/js/111.52d900c7.js"><link rel="prefetch" href="/assets/js/112.00424531.js"><link rel="prefetch" href="/assets/js/113.ea237985.js"><link rel="prefetch" href="/assets/js/114.57f07f83.js"><link rel="prefetch" href="/assets/js/115.ec061508.js"><link rel="prefetch" href="/assets/js/116.944ac05b.js"><link rel="prefetch" href="/assets/js/117.51a3bd3d.js"><link rel="prefetch" href="/assets/js/118.b1708a32.js"><link rel="prefetch" href="/assets/js/119.547f729e.js"><link rel="prefetch" href="/assets/js/12.f7837a85.js"><link rel="prefetch" href="/assets/js/120.77b77710.js"><link rel="prefetch" href="/assets/js/121.a6f28bc6.js"><link rel="prefetch" href="/assets/js/13.8e015820.js"><link rel="prefetch" href="/assets/js/14.34a558be.js"><link rel="prefetch" href="/assets/js/15.60fac476.js"><link rel="prefetch" href="/assets/js/16.be05c3ca.js"><link rel="prefetch" href="/assets/js/17.f8c4932c.js"><link rel="prefetch" href="/assets/js/19.db909a84.js"><link rel="prefetch" href="/assets/js/20.8cc2df06.js"><link rel="prefetch" href="/assets/js/21.f4b0b435.js"><link rel="prefetch" href="/assets/js/22.d559c9b3.js"><link rel="prefetch" href="/assets/js/23.74ba9f22.js"><link rel="prefetch" href="/assets/js/24.2a4117e9.js"><link rel="prefetch" href="/assets/js/25.73c08c20.js"><link rel="prefetch" href="/assets/js/26.c19cc994.js"><link rel="prefetch" href="/assets/js/27.81cd809b.js"><link rel="prefetch" href="/assets/js/28.6791b309.js"><link rel="prefetch" href="/assets/js/29.391ab5ba.js"><link rel="prefetch" href="/assets/js/3.1efbb513.js"><link rel="prefetch" href="/assets/js/30.0b1d7a71.js"><link rel="prefetch" href="/assets/js/31.1f2bb083.js"><link rel="prefetch" href="/assets/js/32.cae2775b.js"><link rel="prefetch" href="/assets/js/33.1e9405be.js"><link rel="prefetch" href="/assets/js/34.9210faf9.js"><link rel="prefetch" href="/assets/js/35.2ac222fd.js"><link rel="prefetch" href="/assets/js/36.c1aa7d10.js"><link rel="prefetch" href="/assets/js/37.47ed6a00.js"><link rel="prefetch" href="/assets/js/38.0743fb65.js"><link rel="prefetch" href="/assets/js/39.f1abc33e.js"><link rel="prefetch" href="/assets/js/4.c29c9b60.js"><link rel="prefetch" href="/assets/js/40.4c2c9b8b.js"><link rel="prefetch" href="/assets/js/41.f38fd71e.js"><link rel="prefetch" href="/assets/js/42.59cc5e7a.js"><link rel="prefetch" href="/assets/js/43.54713365.js"><link rel="prefetch" href="/assets/js/44.cc7cdb87.js"><link rel="prefetch" href="/assets/js/45.cdc6ea0c.js"><link rel="prefetch" href="/assets/js/46.2ab8048b.js"><link rel="prefetch" href="/assets/js/47.f6a00ea3.js"><link rel="prefetch" href="/assets/js/48.8349de8f.js"><link rel="prefetch" href="/assets/js/49.98c2ddda.js"><link rel="prefetch" href="/assets/js/5.40944f1c.js"><link rel="prefetch" href="/assets/js/50.425c325b.js"><link rel="prefetch" href="/assets/js/51.b4870e91.js"><link rel="prefetch" href="/assets/js/52.aef0d698.js"><link rel="prefetch" href="/assets/js/53.e07d00ac.js"><link rel="prefetch" href="/assets/js/54.b7687687.js"><link rel="prefetch" href="/assets/js/55.65cf97ed.js"><link rel="prefetch" href="/assets/js/56.3444efc3.js"><link rel="prefetch" href="/assets/js/57.5377eb7e.js"><link rel="prefetch" href="/assets/js/58.e5099448.js"><link rel="prefetch" href="/assets/js/59.d09bc881.js"><link rel="prefetch" href="/assets/js/6.732df0ed.js"><link rel="prefetch" href="/assets/js/60.eba8f995.js"><link rel="prefetch" href="/assets/js/61.bd8ab09f.js"><link rel="prefetch" href="/assets/js/62.0bd4e7fc.js"><link rel="prefetch" href="/assets/js/63.640df805.js"><link rel="prefetch" href="/assets/js/64.35c8b8f7.js"><link rel="prefetch" href="/assets/js/65.affde9cb.js"><link rel="prefetch" href="/assets/js/66.9f8cabb6.js"><link rel="prefetch" href="/assets/js/67.00890bbe.js"><link rel="prefetch" href="/assets/js/68.0936ba21.js"><link rel="prefetch" href="/assets/js/69.a33cdaf9.js"><link rel="prefetch" href="/assets/js/7.31bb07dc.js"><link rel="prefetch" href="/assets/js/70.1df3e127.js"><link rel="prefetch" href="/assets/js/71.f4124ef5.js"><link rel="prefetch" href="/assets/js/72.01e6c977.js"><link rel="prefetch" href="/assets/js/73.b07f15a4.js"><link rel="prefetch" href="/assets/js/74.f72cdef2.js"><link rel="prefetch" href="/assets/js/75.ee885b7d.js"><link rel="prefetch" href="/assets/js/76.84c918df.js"><link rel="prefetch" href="/assets/js/77.a28fd7f5.js"><link rel="prefetch" href="/assets/js/78.482bfb70.js"><link rel="prefetch" href="/assets/js/79.091c9dbf.js"><link rel="prefetch" href="/assets/js/8.c0da64f7.js"><link rel="prefetch" href="/assets/js/80.df33fddc.js"><link rel="prefetch" href="/assets/js/81.6e6db080.js"><link rel="prefetch" href="/assets/js/82.e9138597.js"><link rel="prefetch" href="/assets/js/83.31c363ff.js"><link rel="prefetch" href="/assets/js/84.1e1be0f3.js"><link rel="prefetch" href="/assets/js/85.c861f43f.js"><link rel="prefetch" href="/assets/js/86.5a205712.js"><link rel="prefetch" href="/assets/js/87.d9dc3fb3.js"><link rel="prefetch" href="/assets/js/88.4297aa82.js"><link rel="prefetch" href="/assets/js/89.0a4430b5.js"><link rel="prefetch" href="/assets/js/9.0c30cda9.js"><link rel="prefetch" href="/assets/js/90.c95ae974.js"><link rel="prefetch" href="/assets/js/91.ff322a2a.js"><link rel="prefetch" href="/assets/js/92.6272aacc.js"><link rel="prefetch" href="/assets/js/93.f34792ac.js"><link rel="prefetch" href="/assets/js/94.5cd9fa78.js"><link rel="prefetch" href="/assets/js/95.4c0963b8.js"><link rel="prefetch" href="/assets/js/96.4b8520b9.js"><link rel="prefetch" href="/assets/js/97.cdf1abbd.js"><link rel="prefetch" href="/assets/js/98.4d55767c.js"><link rel="prefetch" href="/assets/js/99.0a1d65d6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9a0b0289.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Zohnny前端小册</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/basic/basic/" class="nav-link">
  基础
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  css
</a></div><div class="nav-item"><a href="/browser/theory/" class="nav-link">
  浏览器相关
</a></div><div class="nav-item"><a href="/nodejs/" class="nav-link">
  nodejs
</a></div><div class="nav-item"><a href="/babel/" class="nav-link">
  babel
</a></div><div class="nav-item"><a href="/buildTools/webpack/" class="nav-link">
  打包工具
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue/reactive/" class="nav-link">
  响应式
</a></li><li class="dropdown-item"><!----> <a href="/vue/compiler/" class="nav-link">
  模版编译
</a></li><li class="dropdown-item"><!----> <a href="/vue/vnode/" class="nav-link">
  虚拟DOM
</a></li><li class="dropdown-item"><!----> <a href="/vue/whole-process/" class="nav-link">
  整体流程
</a></li><li class="dropdown-item"><!----> <a href="/vue/vuex/" class="nav-link">
  Vuex&amp;Vue-router
</a></li></ul></div></div><div class="nav-item"><a href="/mobile/" class="nav-link">
  移动端
</a></div><div class="nav-item"><a href="/code-reviews/" class="nav-link">
  LC
</a></div><div class="nav-item"><a href="/project/B/batch_download.html" class="nav-link">
  项目
</a></div><div class="nav-item"><a href="/news/vue3.html" class="nav-link">
  前沿
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://0zcl.github.io/utils-library/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  公共函数库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://0zcl.github.io/h5-sdk/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  h5-sdk
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/0zcl/h5_template" target="_blank" rel="noopener noreferrer" class="nav-link external">
  移动端多页面模版
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/0zcl/zcl-mobile-ui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  移动端组件库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://gitlab.61info.com:8190/zcl/tpc-cli" target="_blank" rel="noopener noreferrer" class="nav-link external">
  zcl脚手架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/Dachuizi-6" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/basic/basic/" class="nav-link">
  基础
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  css
</a></div><div class="nav-item"><a href="/browser/theory/" class="nav-link">
  浏览器相关
</a></div><div class="nav-item"><a href="/nodejs/" class="nav-link">
  nodejs
</a></div><div class="nav-item"><a href="/babel/" class="nav-link">
  babel
</a></div><div class="nav-item"><a href="/buildTools/webpack/" class="nav-link">
  打包工具
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue/reactive/" class="nav-link">
  响应式
</a></li><li class="dropdown-item"><!----> <a href="/vue/compiler/" class="nav-link">
  模版编译
</a></li><li class="dropdown-item"><!----> <a href="/vue/vnode/" class="nav-link">
  虚拟DOM
</a></li><li class="dropdown-item"><!----> <a href="/vue/whole-process/" class="nav-link">
  整体流程
</a></li><li class="dropdown-item"><!----> <a href="/vue/vuex/" class="nav-link">
  Vuex&amp;Vue-router
</a></li></ul></div></div><div class="nav-item"><a href="/mobile/" class="nav-link">
  移动端
</a></div><div class="nav-item"><a href="/code-reviews/" class="nav-link">
  LC
</a></div><div class="nav-item"><a href="/project/B/batch_download.html" class="nav-link">
  项目
</a></div><div class="nav-item"><a href="/news/vue3.html" class="nav-link">
  前沿
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://0zcl.github.io/utils-library/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  公共函数库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://0zcl.github.io/h5-sdk/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  h5-sdk
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/0zcl/h5_template" target="_blank" rel="noopener noreferrer" class="nav-link external">
  移动端多页面模版
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/0zcl/zcl-mobile-ui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  移动端组件库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://gitlab.61info.com:8190/zcl/tpc-cli" target="_blank" rel="noopener noreferrer" class="nav-link external">
  zcl脚手架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/Dachuizi-6" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>B端</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/project/B/batch_download.html" class="sidebar-link">批量下载图片</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/project/B/batch_download.html#需求场景" class="sidebar-link">需求场景</a></li><li class="sidebar-sub-header"><a href="/project/B/batch_download.html#任务" class="sidebar-link">任务</a></li><li class="sidebar-sub-header"><a href="/project/B/batch_download.html#实现" class="sidebar-link">实现</a></li><li class="sidebar-sub-header"><a href="/project/B/batch_download.html#结果" class="sidebar-link">结果</a></li><li class="sidebar-sub-header"><a href="/project/B/batch_download.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/project/B/hll-compoments.html" class="sidebar-link">业务组件库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/project/B/hll-compoments.html#rollup构建" class="sidebar-link">rollup构建</a></li><li class="sidebar-sub-header"><a href="/project/B/hll-compoments.html#rollup构建优化" class="sidebar-link">rollup构建优化</a></li><li class="sidebar-sub-header"><a href="/project/B/hll-compoments.html#组件库初始化" class="sidebar-link">组件库初始化</a></li><li class="sidebar-sub-header"><a href="/project/B/hll-compoments.html#使用业务组件库" class="sidebar-link">使用业务组件库</a></li><li class="sidebar-sub-header"><a href="/project/B/hll-compoments.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/project/B/common-utils.html" class="sidebar-link">公共组件库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/project/B/common-utils.html#场景" class="sidebar-link">场景</a></li><li class="sidebar-sub-header"><a href="/project/B/common-utils.html#实现" class="sidebar-link">实现</a></li><li class="sidebar-sub-header"><a href="/project/B/common-utils.html#baselist" class="sidebar-link">baseList</a></li><li class="sidebar-sub-header"><a href="/project/B/common-utils.html#basedialog" class="sidebar-link">baseDialog</a></li><li class="sidebar-sub-header"><a href="/project/B/common-utils.html#axios" class="sidebar-link">axios</a></li><li class="sidebar-sub-header"><a href="/project/B/common-utils.html#_1-axios源码浅析" class="sidebar-link">1. axios源码浅析</a></li><li class="sidebar-sub-header"><a href="/project/B/common-utils.html#_2-loading封装" class="sidebar-link">2. loading封装</a></li><li class="sidebar-sub-header"><a href="/project/B/common-utils.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/project/B/sso-login.html" class="sidebar-link">单点登录</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/project/B/sso-login.html#场景" class="sidebar-link">场景</a></li><li class="sidebar-sub-header"><a href="/project/B/sso-login.html#实现" class="sidebar-link">实现</a></li><li class="sidebar-sub-header"><a href="/project/B/sso-login.html#jwt" class="sidebar-link">JWT</a></li><li class="sidebar-sub-header"><a href="/project/B/sso-login.html#面试" class="sidebar-link">面试</a></li></ul></li><li><a href="/project/B/common-web-system.html" aria-current="page" class="active sidebar-link">微前端系统</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/project/B/common-web-system.html#场景" class="sidebar-link">场景</a></li><li class="sidebar-sub-header"><a href="/project/B/common-web-system.html#实现" class="sidebar-link">实现</a></li><li class="sidebar-sub-header"><a href="/project/B/common-web-system.html#_1-动态路由" class="sidebar-link">1. 动态路由</a></li><li class="sidebar-sub-header"><a href="/project/B/common-web-system.html#_2-消息通信" class="sidebar-link">2. 消息通信</a></li><li class="sidebar-sub-header"><a href="/project/B/common-web-system.html#_3-注册子应用" class="sidebar-link">3. 注册子应用</a></li><li class="sidebar-sub-header"><a href="/project/B/common-web-system.html#_4-接入" class="sidebar-link">4. 接入</a></li><li class="sidebar-sub-header"><a href="/project/B/common-web-system.html#qiankun" class="sidebar-link">qiankun</a></li><li class="sidebar-sub-header"><a href="/project/B/common-web-system.html#_3-怎么处理js隔离" class="sidebar-link">3. 怎么处理JS隔离？</a></li><li class="sidebar-sub-header"><a href="/project/B/common-web-system.html#总结" class="sidebar-link">总结</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>移动端H5</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><div class="custom-block tip"><p class="custom-block-title">Tips</p> <p>STAR：Situation（情景），Task（任务），Action（行动）和 Result（结果）</p> <p>XXX 项目出现 XXX 问题，我作为 XXX，负责其中的 XXX 部分，我通过 XXX 方式（或技术方案）成功解决了该问题，使 XXX 提高了 XXX，XXX 增长了 XXX</p> <p>在项目经历描述中，通过交代清楚你在团队中的位置，以及大略描述你在团队中起到的作用</p></div> <p>微前端特性：</p> <ul><li>📦 基于 single-spa 封装，提供了更加开箱即用的 API。</li> <li>📱 技术栈无关，任意技术栈的应用均可 使用/接入，不论是 React/Vue/Angular/JQuery 还是其他等框架。</li> <li>💪 HTML Entry 接入方式，让你接入微应用像使用 iframe 一样简单。</li> <li>🛡​ 样式隔离，确保微应用之间样式互相不干扰。</li> <li>🧳 JS 沙箱，确保微应用之间 全局变量/事件 不冲突。</li></ul> <p><a href="https://qiankun.umijs.org/zh/api#registermicroappsapps-lifecycles" target="_blank" rel="noopener noreferrer">qiankun<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>使用：</p> <ol><li>主应用：</li></ol> <ul><li>registerMicroApps(apps, lifeCycles?): 注册微应用的基础配置信息。当浏览器 url 发生变化时，会自动检查每一个微应用注册的 activeRule 规则，符合规则的应用将会被自动激活。</li> <li>start(opts?)：启动 qiankun</li> <li>initGlobalState(state)：定义全局状态。建议在主应用使用，微应用通过 props 获取通信方法</li></ul> <ol start="2"><li>微应用</li></ol> <ul><li>RegistrableApp注册子应用时，使用props参数，主应用将数据传递给子应用。</li></ul> <h2 id="场景"><a href="#场景" class="header-anchor">#</a> 场景</h2> <p>后台项目多，需要到A项目才能看到A1内容，到B项目才能看到B1内容。使用微前端项目统一接入各个后台项目，通过配置，能直接在微前端项目快速访问各个后台业务。微前端项目由运营支撑部开发维护，我负责cms后台接入微前端。</p> <h2 id="实现"><a href="#实现" class="header-anchor">#</a> 实现</h2> <h2 id="_1-动态路由"><a href="#_1-动态路由" class="header-anchor">#</a> 1. 动态路由</h2> <p>根据配置，后端返回菜单的数据。一个菜单下可以有多个子菜单，树形结构。<code>userShow</code>字段表示菜单是否显示。</p> <details class="custom-block details"><summary>DETAILS</summary> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1612858</span><span class="token punctuation">,</span>
	<span class="token property">&quot;systemId&quot;</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
	<span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
	<span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;课程管理&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;detail&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;level&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
	<span class="token property">&quot;order&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token property">&quot;icon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cms_book&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;parentId&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token property">&quot;modules&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
		<span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1612859</span><span class="token punctuation">,</span>
		<span class="token property">&quot;systemId&quot;</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
		<span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
		<span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;课程管理&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;detail&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/cms/course/courseManage&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;level&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
		<span class="token property">&quot;order&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		<span class="token property">&quot;icon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;parentId&quot;</span><span class="token operator">:</span> <span class="token number">1612858</span><span class="token punctuation">,</span>
		<span class="token property">&quot;modules&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token property">&quot;userShow&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1612860</span><span class="token punctuation">,</span>
		<span class="token property">&quot;systemId&quot;</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
		<span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
		<span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;画作工具库&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;detail&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/cms/course/drawToolLib&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;level&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
		<span class="token property">&quot;order&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		<span class="token property">&quot;icon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;parentId&quot;</span><span class="token operator">:</span> <span class="token number">1612858</span><span class="token punctuation">,</span>
		<span class="token property">&quot;modules&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token property">&quot;userShow&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
	<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token property">&quot;userShow&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div></details> <p>递归渲染</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>template v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;(value, index) in menuData&quot;</span><span class="token operator">&gt;</span>
  <span class="token comment">// 有子菜单</span>
  <span class="token operator">&lt;</span>el<span class="token operator">-</span>submenu v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;value.modules &amp;&amp; value.modules.length &amp;&amp; isShow(value)&quot;</span> <span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">&quot;value.id&quot;</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">&quot;index&quot;</span> <span class="token operator">:</span>index<span class="token operator">=</span><span class="token string">&quot;`${value.id}`&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>template slot<span class="token operator">=</span><span class="token string">&quot;title&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>menuTitle <span class="token operator">:</span>menu<span class="token operator">-</span>data<span class="token operator">=</span><span class="token string">&quot;value&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>tree<span class="token operator">-</span>menu <span class="token operator">:</span>menu<span class="token operator">-</span>data<span class="token operator">=</span><span class="token string">&quot;value.modules&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>submenu<span class="token operator">&gt;</span>
  <span class="token comment">// 无子菜单</span>
  <span class="token operator">&lt;</span>el<span class="token operator">-</span>menu<span class="token operator">-</span>item v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;isShow(value)&quot;</span> <span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">&quot;value.detail&quot;</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">&quot;index&quot;</span> <span class="token operator">:</span>index<span class="token operator">=</span><span class="token string">&quot;addPathPrefix(value.detail)&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>menuTitle <span class="token operator">:</span>menu<span class="token operator">-</span>data<span class="token operator">=</span><span class="token string">&quot;value&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>menu<span class="token operator">-</span>item<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="_2-消息通信"><a href="#_2-消息通信" class="header-anchor">#</a> 2. 消息通信</h2> <ol><li>initGlobalState. 官方提供的接口.</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 主应用</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> onGlobalStateChange<span class="token punctuation">,</span> setGlobalState <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">initGlobalState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token string">'qiankun'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 主应用监听数据</span>
<span class="token function">onGlobalStateChange</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> prev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'[onGlobalStateChange - master]:'</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> prev<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setGlobalState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">ignore</span><span class="token operator">:</span> <span class="token string">'master'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'master'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 子应用</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">mount</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">storeTest</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">storeTest</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 子应用监听数据</span>
  props<span class="token punctuation">.</span>onGlobalStateChange <span class="token operator">&amp;&amp;</span>
    props<span class="token punctuation">.</span><span class="token function">onGlobalStateChange</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> prev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[onGlobalStateChange - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]:</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> prev<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 子应用修改数据</span>
  props<span class="token punctuation">.</span>setGlobalState <span class="token operator">&amp;&amp;</span>
    props<span class="token punctuation">.</span><span class="token function">setGlobalState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">ignore</span><span class="token operator">:</span> props<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
      <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> props<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAisAAABZCAYAAAD/22TLAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAABiWSURBVHhe7Z3dq23XWcbPfxIF/4dcKHifm8R4lxspepFAoRwhhLQxYDFEIy2FtsEL0xAo2EZLW+tNKYUQSolWjRxKmpJqoXBuGojpRY4XoSz97exn+/TNGPNrzbn2PGs/P3hZa4wxx/cc7/uOsT7mrcOZ8fVX//7wW7/9O4dH/uAPD++9995l7P/zzjs/O/zu7/3+4VOfun24d+/eZWy4aVznfUJ5lPvGG/98GRNCCGGIs3NWQtgzf/lXL1w4SbyGEEKYRpyVEEIIIeyaOCshhBBC2DW33n///UMkEolEIpHIXiUnKyGEEELYNXFWQgghhLBr4qyEEEIIYdfEWQkhhBDCromzEkIIIYRdE2clhBBCCLsmzkoIIYQQds0mzoqeu3KqvxXnGStL6uP5L5/4xJ80nw0zxtI69wZ9ZwwYi7Av/B7Ls6xCuD5+9K//fvijP3784nUpL/7N3x6+9Y//dBnalnv3/ufwF8//9YXw/hzYzFnZwoBTppQ3Uh8EN7feY5wV0atzqK3HOAhLx1YPz1N7eEgf9cdZOZ6tx5B7J85KCNfHTXdW1H/k8U/ePvzsP//rMuUj6BdpWzpH94WzIkM7VuZenJWxdpzaWaE+ni7cyhdn5XjirIQQxjils7ImOCa3n3z6ykHh9TPPfvb/9N5/X4Tpl/p2Vs4K8drd++P5UfTPPPPshShdpxG89h7l7/TqHavz5ZdfuUqnDMF7xdc00aqTcKsd4G2ReJt6ddJWTkM8zdPB83qZQ8aOazC0vTGo9Xo5XPelL794UVetE6hX+SQqm+uUz+O3wttKH9Rf1TvUT/B506lUjZf4OAz1c+z+E7350/jyGkJYH51QtE4UMNakfeWVr16dOlRnBCOutJqu0wjkT5/89EV5ive6eCU85VTHy0So3/H29E5Iajz1ejmMyee+8MVm3rNxVojzeK6TEpaxULoraC/PDWBV7K1659RJuHfSQhz5alqrTjdQtY1A+pSdeKvOVn3AuHi8h3t5QG31MemNAVCOjCPlurEkTf2lnIcfefSqj94G6sFIK62Gt4D6mWvaSn/V1t64eD9pF+2jnS168znWT15pk49Za+xph+bHIT7OSgjbgyPBaYIbaOJwMmSgSWudOAjeY9ChOgA1LMMvh2iKo1KpZdI+nIwhZ6LlrNR+US7OTm3T2TgrLYPkyrkqag+3ypOxcep1c+us18sYSHxHLVptE5SHkakGhfqot5YFY3X26iPO8yEycKT12ljb0gr7yQCica9t8TD5q7PiDhH98jKRKUbXxxShbZq/IdQ275+3d6ifSmvNP3iZzlg/SSffWPu5vuWshBBOQ89Z8TgPt653Z4X3OuGQVEOva5RnLtVZoU04V60TlTFog9qJw3PWJyso2qXOSktZU76Miaj1zq3TrycOAyXDQphrvSxo9bVS298ra0qdvfqIU74KeXrGrtZRw5Tr9fFe417b4mHq6jkVlM04t9qzFWqb98/by6v3hffqp/A++Vi35gnG+kk6+TQuPer9E0I4LVs4K2OnJVzz6T/7899wOOZQnRWBM4FTgeMx1oYW9I38vDpn46xAyyAoXBW3hxGMnRsP8lVj0qrX6wAP1zrdKJBWTwbmnqwIrnFjI6NXnYspdfYMF9e6Q+C0xk+Q5obWw2qn8hFHexTm1fvuYdrZG5eh9myF2ub9U9xYPyvEe1pvPsf6ST1+//XozTnx1XEKIaxPy/mocR6WQyDnRCcTHvbvqVRIx9FQOdWpIDx26tJzVgR5a37CQycvtV8OcWfjrEipa7ftCrgq7hqW4ldeV9LU5/GI6h+r04/pq7GnDKWxQ/ZTml6dtT7E6xQyNIjXO1Qn1PLdEHremlbHT04Q8TLeus7DtZ18SVXl8qpxBg+3xsH7SflDY782apv3z9s71E9PQ+bM51A/SfN7vAdlD9XJawhhfXAmcCr0EQgiYz7krACvXEsenIbqHBDn5SqNV3dkVI7nXeKsKI+k5VhQXnVW5KAoH+U45PFykSEnaSkndVbCzaEaWDkvcgDCdHrOSggh9MCJ2MJpuC7irIRN4B5wA8vpAacKOQWYT5yVEE7Pm/9x52MnBnsWp35c07p+a/naq9+4qHstNnNWdOwdp+VmopMU3QdITlXmgZOisYuzEkIYon5cc06nKrCJsxJCCCGEsBZxVkIIIYSwa+KshBBCCGHXxFkJIYQQwq7ZxFn5yds/vXw3D/0nhf4D5H5GXzKe+sVIfSF1i77rvwLO7QtXLX750kuHHz/44OHDd9+9jNmeXp26B+Z+sXjp+tEvrqjzfv/V1RJdsHS8x8j6uT7uvfXW4c0HHjj86rXXLmM+Ql8+zw84bg6bOCvPv/D5wze//Z3L0DQw1vUP0O5X6AN9WfLrDRTt2gvwJinbXzz11IWckqE6uRem/PGbw/pB5jot3Dfn8NPwY3TBkvEeI+tnG3BA3rh160pa9XJNz3lijv0PLMN5s5mzwk+nkKlOyzEGfm/gcCzd3R2T96bz6w8+OLzz2GMf24VtyVidS+7rJesHxc3J3JpG+ro4Rheckx45NdexfgQnKG8/9NDHnBJOenrO0znd82GczZ2VqQqXHWE9UWBHM/R3xvV35f4XxeB/A+xpvJLvu9/7/lU6Yf/rYR0zLtmpHrPDXXN37ONT+wd1/BD9iRC7yNd/8MOr9PoXzPWvm/UXzJTJEzkZW/3VdJ0Xyla+2i6MDApo6sdnY6D8UIIoQ4HyQwlCVYY1rGNo7f7mKvLWfT1GXT/I2BrqGWnGWnMKrbDqqHPMe80hMmeOMSB8JDW377BkzMQxeSu+PrJ+tl0/5PF8U4hjerM4ibOCEDdEy0izuHFOtFBruCpep6WUFZYS1kKnPHeCgLYs+f7IMd6+FE0dh6Wg8OhTHTeQotWYKIzS1HvmTUqU8dN7Xl2BEvaxJE3prXJVTg2DxmAtg1N3izXsihc8zDVcS55WeApLPtZrrR9k6GOh1onc2Hgz98xrC67hWvLU8NAcCzkrS04JW7pgKkvGu0fWz7brxx0ZL2Mq3CNrOWVh/1z7yQrKpXeCwSJ0ZeqLGlAUlC+FIVAuviNEPB/luLJYAykJf1DdEo7Zkfao4wh1LF0hSwm6Ima3xzWkV8fO8/L+9pNP/0a6oE6fE6RnLNfEFSgK8udPPHGhMBHea9foiljvtSNEUKy+w5wKcznnvqjrh3DPUWHd9L5Uynwwj7rP69xpPuocaP69DX4yMDTHxzCkC+Ywd7zHyPrZdv3oWuqZC/fMOfwgI4yzqbMypGQdlAqGvioXFmLduVTHBIijPqVVRVLhulY5a4CiXeposODW/nIg+DiKOga815i58gReSZMy9TQgr5RmS7ELv+6UoGilbFGI2hWiOP1zcuL1Zb7W8fdclp6UubMy5SNU6uE4vCrsug58jh0ZQc0Nc1sNqjM0x8fS0wVTWDreY9BXXytA2ON8bLN+5q8fyp3rrKBnW056OE82c1aQqbQ+e2TRs8BZvMAidYekUhf80MkJ16ncFrQHb32J0mPx1AXEokIo9+FHHr14VZxDvhoniEcR+xhNwceR8eBzdKjj5caKsBs1D6NsfedXw5Q7NEdeboul/RwChXn3ueeuXgXKlR0dOzvS2Pm5suW9FPMSmOclzqfWz9RfA/UMfGuOe+Pvc8x9wvohrsXQHIOcht69PERLF7AuKO/u3bsXJyasS8X5dUPjnfWznK3XD9fMPbVkjvNLoJvFJs7K3J9c9k4jWJwoATkpKAMpUE9D6iLmWk+XAkDhDO0agfas9eVaV9zE4wTduXPnKs6peR3Slh5tayzcgaP/+qiMseOY2sdWihdaYY2rfzzgir2F0pUX8Ws1VmsrWylOKVaheI6opVh1xA2E/Ri75h+DuaxzPIW566dl4KHOMYZW88i4+zxU576ma32NzTFwjy79KLM1ZoS5J1g32kQozvs8NN7EZ/0sY+314/mUl7g59O75cL5s4qzMpXUacT/Cwmkdx09hLC/KdqsxmuLAhfmc6r5e6hTtkWPGbChv1s95cU73fJjGLpyVLRXJKTnmaJLF19oRMS69L1AuhR0aOz3tEtnpaecc1uGUx9TcG+eiuJfqgt54Z/2cH+hIdCU6M9wcduGsoGA43l3zG/zXhZTjVOOhviOnMGzCj/mHvt8T5iFFuraBHII1w9o59T20BXN1wXWMN2T9XA/o1Tn6NZwPu3BWQgghhBB6xFkJIYQQwq6JsxJCCCGEXXPr/fffP0QikUgkEonsVXKyEkIIIYRdE2clhBBCCLsmzkoIIYQQdk2clRBCCCHsmjgrIYQQQtg1cVZCCCGEsGvirIQQQghh12zirOj5OKd6hgMPtFpSH88h4eFnS55HtLTOvdF7AFyYjt8Laz+eP4SwDjxokgdObvHQSZ64/fgnb1881HIqXMuzpbZ8CCYP3JzTpj2zmbOyhQGnTBkFpD51c269xzgrolfnUFuPcRCWjq0/8A3RQ+/irKwHcxxnJYR9sjdnRZDHH4bJK2E9KBPB6XD8QZpD/ZGzor57mWN5HcrxfNQvanu3co7uC2dFhnaszL04K2PtOLWzQn08xbaVL87KesRZCSHMRY6EHACM/2ee/eyFA9SiOjdDDJ2sEF+doCnQTjk5arvqqH1Zk5M7K8Rrd++PgcdYPvPMsxeidJ1G8DrlkfG9esfqfPnlV67SKUPwXvE1TbTqJNxqB3hbJN6mXp20ldMQT/N08Lxe5pAR5Rqcld4Y1Hq9HK770pdfvKir1gnUq3wSlc11yufxW0H5dQyYC9Xr76GGea+21n6K3jhrHHgNISwDw/p3X/+HixMM3mu3L8OIwdTuvu7wuUbx1UBz3Vde+erV6cBUR0CGWeUibqRreq9cnUwo75CzQpmf+8IXu44MaFwkPg6iVwfXMr5D5XONxpBy6KP3i/RWncdyUmeFOI/nOil3GUWlu+L38twAujGBVr1z6iTcO2khjnw1rVWnG+LaRiB9ymlGq85WfcC4eLyHe3lAbfUx6Y0BUI6MLuW6ESZN/aWchx959KqP3gbqwUlUWg1vQR3zGva2g4eHxtYhXuPoEB9nJYTjwEDKqOsjF+JahrFlRMENrSAOoy5noVfmGORzZ4X3tS7HnRm/jjbLcULceeAVJwPnSumel/c13OpLaxyA+Jaz4m1yp6uepOi6VtnHcjJnpWWQeC/D6O9rWqs8NyaiXje3znq9jIxE3/NwWm0TlIfxqoaK+qi3lgVjdfbqI87zITKcpPXaWNvSCvsJCKJxr23xMPmrs+IOkZ/WSKYYcx9TpHfK0YI2qO3U5W3nvdLAw7z3diI9p6QVH0I4HhleGWwMoxtjDKYMONIyui0jXeNa10yBPO6sUDdtcOPuTDklAdqjMlSm+uzOAun1tMTHR7SumwN1eZ/UJjkyOFK1zjW4L5yVlhGoxgVqvXPr9OuJwxDKgBLmWi8LWn2t1Pb3yppSZ68+4pSvQp6eEa111DDlen2817jXtniYuqhTxt2dCspmnFvt2RKvl3b6eHm/wMP12h51nkMI6yHDi3GszgrvMZS+w28ZZK6tjkiNa10zBfK4syLUtpbzNAXvr78XPga1z0pziFvSPzHmZPXG4Viu9WMgD2NIMJJu0BRGMHY9YyJa9Xod4OFapxsb0urJwNyTFcE1bsR4JVwN4JQ6ewaRa3unDK3xE6T1nBW1U/mIoz0K8+p99zDt7I3LUHu2hu/YqG0+hoS97ThY3s/e2Dq9uVF5vIYQliHD6wbb424/+fSVASVuzZMV4jg5GDLC5JmTLidmzLCTT+1pfewiB0VptBXUZoWhjlOFa8ecKur2kxWH/LSBtqzNSZ0VGT/ttl2xYwh7zgrIwCmvK3/q83hE9Y/V6R9HVINEGUpjR+6nNL06a32I1ylkwBCvd6hOqOXLoILnrWl1/OQEEd9zVqC2E2OvcnnVOIOHW+Pg/aT8obHfip7j4O2h3XzheOrYCsocmutaZwhhOhhsjCGGtDorStdHQOz8fffPNUqTyAEgTe+hhkH55zgjtc5aZs9ZUXwvH33Sxy6I5/c08tEGRBBXy3O4tjortT3VGfF+DpV9LCd1VsLNoRpuOS8tI38u9JyVEMJ5U088wvrEWQmbwD3ghlsnO+d8uhBnJYRt+Jcf/dvV7n0PUuEkQh+vtK6/ifK1V79xOTrrsJmzouPyOC03E52k6D5AzvVUBSdFfYyzEsLNYOjjmLA+mzgrIYQQQghrEWclhBBCCLsmzkoIIYQQdk2clRBCCCHsmk2clZ+8/dPLd/PQf13oP0DuZ/Ql46lfuNQXUrfou34nv+Vv4PfCL1966fDjBx88fPjuu5cx29OrU/fA3C8WL10/+sUVdd7vv7paoguWjvcYWT/Xx7233jq8+cADh1+99tplzEfoS+35AcfNYRNn5fkXPn/45re/cxmaBsa6/gHa/Qp9oC9LfhWCol17Ad4kZfuLp566kFMyVCf3gv+54RRYP8hcp4X75hx+Gn6MLlgy3mNk/WwDDsgbt25dSateruk5T8yx/4FlOG82c1b4KRcy1Wk5xsDvDRyOpbu7Y/LedH79wQeHdx577GO7sC0Zq3PJfb1k/aC4OZlb00hfF8fognPSI6fmOtaP4ATl7Yce+phTwklPz3k6p3s+jLO5szJV4bIjrCcK7Gj8wUw1rH8NVD3sfrhG+N8Aexqv5Pvu975/lV7/QljHjEt2qsfscNfcHfv41P5BHT9Ef83MLvL1H/zwKr3+BTP/KeD59B8DlMnfXDO2+g+COi+UrXy1XRgZFNDUj8/GQPmhBFGGAuWHEoSqDGtYx9Da/c1V5K37eoy6fpCxNdQz0ox1/bvtGlYddY57/yMxZY4xIHwkNbfvsGTMxDF5K74+sn62XT/k8XxTiGN6sziJs4IQN0TLSLO49QyIVrgqXqellBWWEtZCpzx3goC2LPn+yDHevhRNHYeloPDoUx03kKLVmCiM0tR75k1KlPHTe15dgRL2sSRN6a1yVU4Ng8ZgLYNTd4s17IoXPMw1XEueVngKSz7Wa60fZOhjodaJ3Nh4M/fMawuu4Vry1PDQHAs5K0tOCVu6YCpLxrtH1s+268cdGS9jKtwjazllYf9c+8kKyqV3gsEidGXqixpQFJQvhSFQLr4jRDwf5biyWAMpiWMfyHfMjrRHHUeoY+kKWUrQFbEeCkZ6dew8L+97T/WkTp8TpGcs18QVKAry5088caEwEd5r1+iKWO+1I0RQrL7DnApzOee+qOuHcM9RYd30vlTKfDCPus/r3Gk+6hxo/r0NfjIwNMfHMKQL5jB3vMfI+tl2/eha6pkL98w5/CAjjLOpszKkZB2UCoa+KhcWYt25VMcEiKM+pVVFUuG6VjlrgKJd6miw4Nb+ciD4OIo6BrzXmLnyBF5JkzL1NCCvlGZLsQu/7pSgaKVsUYjaFaI4/XNy4vVlvtbx91yWnpS5szLlI1Tq4Ti8Kuy6DnyOHRlBzQ1zWw2qMzTHx9LTBVNYOt5j0FdfK0DY43xss37mrx/KneusoGdbTno4TzZzVpCptD57ZNGzwFm8wCJ1h6RSF/zQyQnXqdwWtAdvfYnSY/HUBcSiQij34UcevXhVnEO+GieIRxH7GE3Bx5Hx4HN0qOPlxoqwGzUPo2x951fDlDs0R15ui6X9HAKFefe5565eBcqVHR07O9LY+bmy5b0U8xKY5yXOp9bP1F8D9Qx8a4574+9zzH3C+iGuxdAcg5yG3r08REsXsC4o7+7duxcnJqxLxfl1Q+Od9bOcrdcP18w9tWSO80ugm8Umzsrcn1z2TiNYnCgBOSkoAylQT0PqIuZaT5cCQOEM7RqB9qz15VpX3MTjBN25c+cqzql5HdKWHm1rLNyBo//6qIyx45jax1aKF1phjat/POCKvYXSlRfxazVWaytbKU4pVqF4jqilWHXEDYT9GLvmH4O5rHM8hbnrp2Xgoc4xhlbzyLj7PFTnvqZrfY3NMXCPLv0oszVmhLknWDfaRCjO+zw03sRn/Sxj7fXj+ZSXuDn07vlwvmzirMyldRpxP8LCaR3HT2EsL8p2qzGa4sCF+Zzqvl7qFO2RY8ZsKG/Wz3lxTvd8mMYunJUtFckpOeZoksXX2hExLr0vUC6FHRo7Pe0S2elp5xzW4ZTH1Nwb56K4l+qC3nhn/Zwf6Eh0JToz3Bx24aygYDjeXfMb/NeFlONU46G+I6cwbMKP+Ye+3xPmIUW6toEcgjXD2jn1PbQFc3XBdYw3ZP1cD+jVOfo1nA+7cFZCCCGEEHrEWQkhhBDCromzEkIIIYRdE2clhBBCCLvm1uGD1w+RSCQSiUQie5Vbhw/vHiKRSCQSiUT2KnFWIpFIJBKJ7FrirEQikUgkEtm1xFmJRCKRSCSya4mzEolEIpFIZMdy9/C/MEaHINw46YQAAAAASUVORK5CYII=" alt="initGlobalState"></p> <p>父应用和子应用都监听了<code>{ ignore: 'master', user: { name: 'master', }, }</code>对象, 子应用修改监听的数据, 触发了主应用和子应用的回调. 本质上和eventEmit是一样的.</p> <ul><li>优点: 有qiankun官方支持, 使用简单</li> <li>缺点: 子应用需要先了解监听的数据池, 再进行通信; 容易出现状态混乱(不知道谁改的数据)</li></ul> <ol start="2"><li>父应用注册子应用是可通过<code>props</code>向子应用传递数据。可以传父应用的store对象, 传给子应用, 子应用再调用<code>store.dispatch</code>, 通知父应用.</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 传入到子应用的数据</span>
<span class="token keyword">const</span> initData <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">user</span><span class="token operator">:</span> user <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 用户相关信息</span>
  store<span class="token punctuation">,</span>
  <span class="token literal-property property">menus</span><span class="token operator">:</span> menuData<span class="token punctuation">.</span>menus<span class="token punctuation">,</span> <span class="token comment">// 菜单</span>
  <span class="token literal-property property">resources</span><span class="token operator">:</span> menuData<span class="token punctuation">.</span>resources<span class="token punctuation">,</span> <span class="token comment">// 权限code</span>
<span class="token punctuation">}</span>

<span class="token literal-property property">props</span><span class="token operator">:</span> initData
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>注意了，这里把主应用的<code>store</code>对象传出去了，子应用拿到主应用的<code>store</code>对象，需要时执行<code>store.dispatch</code>，主应用通过<code>Vuex：Action --&gt; Mutation</code>的形式来修改数据即可。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 这部分代码在子应用中执行。事实上，为了避免子应用们代码冗余，会把这部分逻辑封装到Npm包中，抛出函数给子应用使用</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token literal-property property">moduleId</span><span class="token operator">:</span> detail<span class="token punctuation">,</span>
  <span class="token literal-property property">redPointNum</span><span class="token operator">:</span> count
<span class="token punctuation">}</span><span class="token punctuation">]</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'redPoint/setCounts'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="_3-注册子应用"><a href="#_3-注册子应用" class="header-anchor">#</a> 3. 注册子应用</h2> <p>先初始化主应用，再在主应用中注册子应用。</p> <details class="custom-block details"><summary>DETAILS</summary> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 获取子应用列表</span>
<span class="token punctuation">{</span>
  <span class="token literal-property property">appCode</span><span class="token operator">:</span> <span class="token string">&quot;cms&quot;</span>
  <span class="token literal-property property">appName</span><span class="token operator">:</span> <span class="token string">&quot;cms&quot;</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;1280077660296974336&quot;</span>
  <span class="token literal-property property">route</span><span class="token operator">:</span> <span class="token string">&quot;/cms&quot;</span>
  <span class="token literal-property property">siteUrl</span><span class="token operator">:</span> <span class="token string">&quot;//manager-test.61info.cn/index.html&quot;</span>
  <span class="token literal-property property">versionAddress</span><span class="token operator">:</span> <span class="token string">&quot;//manager-test.61info.cn/index.html&quot;</span>
  <span class="token literal-property property">versionCode</span><span class="token operator">:</span> <span class="token keyword">null</span>
  <span class="token literal-property property">versionName</span><span class="token operator">:</span> <span class="token keyword">null</span>
  <span class="token literal-property property">weight</span><span class="token operator">:</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></details> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// render.tsx</span>
<span class="token keyword">function</span> <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">appContent</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">loading</span><span class="token operator">:</span> boolean</span><span class="token punctuation">)</span><span class="token operator">:</span> Vue <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> render <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token literal-property property">app</span><span class="token operator">:</span> Vue
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> appContent<span class="token punctuation">,</span> loading <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>appContent<span class="token punctuation">,</span> loading<span class="token punctuation">)</span>
    <span class="token keyword">return</span> app
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// index.tsx</span>
<span class="token keyword">function</span> <span class="token function">activeRule</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">routerPrefix</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span><span class="token operator">:</span> any <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">location</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> location<span class="token punctuation">.</span>hash<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>routerPrefix<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 实例化主应用</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">appContent</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token literal-property property">loading</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">setApps</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> appsData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchUserApps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>list <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token comment">// 获取到用户的菜单和权限</span>
  <span class="token keyword">const</span> menuData <span class="token operator">=</span> <span class="token keyword">await</span> MenuStore<span class="token punctuation">.</span><span class="token function">fetchMenus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 传入到子应用的数据</span>
  <span class="token keyword">const</span> initData <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">user</span><span class="token operator">:</span> user <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    store<span class="token punctuation">,</span>
    <span class="token literal-property property">menus</span><span class="token operator">:</span> menuData<span class="token punctuation">.</span>menus<span class="token punctuation">,</span> <span class="token comment">// 菜单列表</span>
    <span class="token literal-property property">resources</span><span class="token operator">:</span> menuData<span class="token punctuation">.</span>resources<span class="token punctuation">,</span> <span class="token comment">// 按钮权限code列表</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">const</span> microAppSettings <span class="token operator">=</span> appsData<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> app</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> app<span class="token punctuation">.</span>appName<span class="token punctuation">,</span>
      <span class="token literal-property property">entry</span><span class="token operator">:</span> app<span class="token punctuation">.</span>siteUrl<span class="token punctuation">,</span>
      <span class="token literal-property property">container</span><span class="token operator">:</span> <span class="token string">'#appContainer'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">props</span><span class="token operator">:</span> initData<span class="token punctuation">,</span>
      <span class="token literal-property property">activeRule</span><span class="token operator">:</span> <span class="token function">activeRule</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>route<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
    <span class="token keyword">return</span> list
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
   
  <span class="token function">registerMicroApps</span><span class="token punctuation">(</span>microAppSettings<span class="token punctuation">)</span>
  <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">prefetch</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">setApps</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><h2 id="_4-接入"><a href="#_4-接入" class="header-anchor">#</a> 4. 接入</h2> <p>微应用需要在自己的入口 js (通常就是你配置的 webpack 的 entry js) 导出 <code>bootstrap</code>、<code>mount</code>、<code>unmount</code> 三个生命周期钩子，以供主应用在适当的时机调用</p> <ul><li>bootstrap: 只会在子应用初始化的时候调用一次，再进入子应用时，不会再次触发</li> <li>mount: 每次进入都会调用 mount 方法，这里触发应用的渲染方法</li> <li>unmount: 应用每次 切出/卸载 会调用的方法，通常在这里我们会卸载微应用的应用实例</li></ul> <p>register函数，为子应用提供注册。兼容qiankun和非qiankun下的独立运行。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 子应用</span>
<span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">el</span><span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>
    router<span class="token punctuation">,</span>
    store<span class="token punctuation">,</span>
    <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    app<span class="token punctuation">.</span><span class="token function">$destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    app <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 下面的代码封装到npm供子应用们使用</span>
<span class="token keyword">let</span> <span class="token literal-property property">appRender</span><span class="token operator">:</span> <span class="token function-variable function">Function</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'please run register method to init app'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">props<span class="token operator">?</span><span class="token operator">:</span> MicroParams</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Function<span class="token punctuation">,</span> <span class="token literal-property property">conf</span><span class="token operator">:</span> MicroConf <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> Function <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
	options <span class="token operator">=</span> conf
  <span class="token comment">// appRender()返回一个函数，包含卸载微应用的逻辑</span>
  appRender <span class="token operator">=</span> render
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>__POWERED_BY_QIANKUN__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token function">getParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> params<span class="token punctuation">.</span>user
    <span class="token comment">// 自动更新本地缓存</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>accessToken<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'accessToken'</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>accessToken<span class="token punctuation">)</span>
      localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'loginInfo'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> <span class="token literal-property property">microProps</span><span class="token operator">:</span>MicroParams <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>
      <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      params<span class="token punctuation">,</span> 
      <span class="token punctuation">{</span>
        <span class="token literal-property property">menus</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">resources</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token function">render</span><span class="token punctuation">(</span>microProps<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">mount</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">props</span><span class="token operator">:</span> MicroParams</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	options<span class="token punctuation">.</span>mount <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  unmountAppCallback <span class="token operator">=</span> <span class="token function">appRender</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">unmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// options.unmount &amp;&amp; options.unmount()</span>
	unmountAppCallback <span class="token operator">&amp;&amp;</span> <span class="token function">unmountAppCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'child app unmount'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><h2 id="qiankun"><a href="#qiankun" class="header-anchor">#</a> qiankun</h2> <p>HTML Entry 是由<code>import-html-entry</code>库实现的，通过 http 请求加载指定地址的首屏内容即 html 页面，然后解析这个 html 模版得到 template, scripts , entry, styles</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  template<span class="token operator">:</span> 经过处理的脚本，link、script 标签都被注释掉了<span class="token punctuation">,</span>
  scripts<span class="token operator">:</span> <span class="token punctuation">[</span>脚本的http地址 或者 <span class="token punctuation">{</span> async<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> src<span class="token operator">:</span> xx <span class="token punctuation">}</span> 或者 代码块<span class="token punctuation">]</span><span class="token punctuation">,</span>
  styles<span class="token operator">:</span> <span class="token punctuation">[</span>样式的http地址<span class="token punctuation">]</span><span class="token punctuation">,</span>
 	entry<span class="token operator">:</span> 入口脚本的地址，要不是标有 entry 的 script 的 src，要不就是最后一个 script 标签的 src
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>然后远程加载 styles 中的样式内容，将 template 模版中注释掉的 link 标签替换为相应的 style 元素。</p> <p><img src="/assets/img/36.09b4ff5c.png" alt="html entry"></p> <ol><li>为什么要用微前端？</li></ol> <p>使用微前端项目统一接入各个后台项目，通过配置，能直接在微前端项目快速访问各个后台业务</p> <ol start="2"><li>怎么处理样式隔离？</li></ol> <ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/Web_Components/Using_shadow_DOM" target="_blank" rel="noopener noreferrer">Shadow DOM<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>scopedCSS</li></ul> <p><a href="https://qiankun.umijs.org/zh/api#startopts" target="_blank" rel="noopener noreferrer">start(opts?)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> API有个<code>sandbox</code>属性, <code>boolean | { strictStyleIsolation?: boolean, experimentalStyleIsolation?: boolean }</code></p> <p>当配置为 { strictStyleIsolation: true } 时表示开启严格的样式隔离模式。这种模式下 qiankun 会为每个微应用的容器包裹上一个 shadow dom 节点，从而确保微应用的样式不会对全局造成影响</p> <p>当 experimentalStyleIsolation 被设置为 true 时，qiankun 会改写子应用所添加的样式为所有样式规则增加一个特殊的选择器规则来限定其影响范围，因此改写后的代码会表达类似为如下结构</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 假设应用名是 react16</span>
<span class="token punctuation">.</span>app<span class="token operator">-</span>main <span class="token punctuation">{</span>
  font<span class="token operator">-</span>size<span class="token operator">:</span> 14px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

div<span class="token punctuation">[</span>data<span class="token operator">-</span>qiankun<span class="token operator">-</span>react16<span class="token punctuation">]</span> <span class="token punctuation">.</span>app<span class="token operator">-</span>main <span class="token punctuation">{</span>
  font<span class="token operator">-</span>size<span class="token operator">:</span> 14px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="_3-怎么处理js隔离"><a href="#_3-怎么处理js隔离" class="header-anchor">#</a> 3. 怎么处理JS隔离？</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> useLooseSandbox <span class="token operator">=</span> <span class="token keyword">typeof</span> sandbox <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token operator">!</span>sandbox<span class="token punctuation">.</span>loose<span class="token punctuation">;</span>
<span class="token comment">// src/sandbox/index.ts</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createSandboxContainer</span><span class="token punctuation">(</span>
  <span class="token literal-property property">appName</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
  <span class="token function-variable function">elementGetter</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> HTMLElement <span class="token operator">|</span> ShadowRoot<span class="token punctuation">,</span>
  <span class="token literal-property property">scopedCSS</span><span class="token operator">:</span> boolean<span class="token punctuation">,</span>
  useLooseSandbox<span class="token operator">?</span><span class="token operator">:</span> boolean<span class="token punctuation">,</span>
  excludeAssetFilter<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">url</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> boolean<span class="token punctuation">,</span>
  globalContext<span class="token operator">?</span><span class="token operator">:</span> <span class="token keyword">typeof</span> window<span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token literal-property property">sandbox</span><span class="token operator">:</span> SandBox<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>Proxy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sandbox <span class="token operator">=</span> useLooseSandbox <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">LegacySandbox</span><span class="token punctuation">(</span>appName<span class="token punctuation">,</span> globalContext<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ProxySandbox</span><span class="token punctuation">(</span>appName<span class="token punctuation">,</span> globalContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    sandbox <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SnapshotSandbox</span><span class="token punctuation">(</span>appName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>浏览器不支持Proxy，使用<code>SnapshotSandbox</code>快照沙箱；支持Proxy的话，默认使用<code>ProxySandbox</code>。如果sandbox配置loose，才用<code>LegacySandbox</code>沙箱，不过官方文档没有loose的说明。</p> <p><img src="/assets/img/37.002dc270.png" alt="proxy_sandbox"></p> <h3 id="snapshotsandbox快照沙箱"><a href="#snapshotsandbox快照沙箱" class="header-anchor">#</a> SnapshotSandbox快照沙箱</h3> <ol><li>激活时保存window快照信息到windowSnapshot，modifyPropsMap保存激活期间修改的信息，</li> <li>如果modifyPropsMap有数据，需要把window还原到上次的状态；激活期间可以修改window的数据；</li> <li>退出激活状态，对比window和快照windowSnapshot，把修改的信息存到modifyPropsMap，并还原window的状态，即windowSanpshot的状态</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">iter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">window<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> prop <span class="token keyword">in</span> window<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">callback</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">SnapshotSandbox</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>proxy <span class="token operator">=</span> window<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>modifyPropsMap <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 激活沙箱</span>
  <span class="token function">active</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 缓存active状态的window</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>windowSnapshot <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">iter</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">prop</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>windowSnapshot<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> window<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>modifyPropsMap<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">p</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      window<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modifyPropsMap<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 退出沙箱</span>
  <span class="token function">inactive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">iter</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">prop</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>windowSnapshot<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">!==</span> window<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 记录变更</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>modifyPropsMap<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> window<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// 还原window</span>
        window<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>windowSnapshot<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>snapshotSandbox会污染全局window，但是可以支持不兼容Proxy的浏览器</p> <h3 id="legacysandbox"><a href="#legacysandbox" class="header-anchor">#</a> LegacySandbox</h3> <p>LegacySandbox使用三次参数来记录，实现消息JS沙箱</p> <ul><li>addedPropsMapInSandbox: 记录新增的属性全局</li> <li>modifiedPropsOriginalValueMapInSandbox：记录修改的属性的初始值。</li> <li>currentUpdatedPropsValueMap：记录激活状态下修改属性的最终值，即属性多次修改，记录最后一次修改的数据</li></ul> <details class="custom-block details"><summary>DETAILS</summary> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Legacy</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 沙箱期间新增的全局变量</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>addedPropsMapInSandbox <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 沙箱期间更新的全局变量</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>modifiedPropsOriginalValueMapInSandbox <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 持续记录更新的(新增和修改的)全局变量的 map，用于在任意时刻做 snapshot</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>currentUpdatedPropsValueMap <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> rawWindow <span class="token operator">=</span> window<span class="token punctuation">;</span>
    <span class="token keyword">const</span> fakeWindow <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>sandboxRunning <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>fakeWindow<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果是激活状态</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sandboxRunning<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 判断当前window上存不存在该属性</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rawWindow<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 记录新增值</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>addedPropsMapInSandbox<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>modifiedPropsOriginalValueMapInSandbox<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 记录更新值的初始值</span>
            <span class="token keyword">const</span> originValue <span class="token operator">=</span> rawWindow<span class="token punctuation">[</span>prop<span class="token punctuation">]</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>modifiedPropsOriginalValueMapInSandbox<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> originValue<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token comment">// 纪录此次修改的属性</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>currentUpdatedPropsValueMap<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
          <span class="token comment">// 将设置的属性和值赋给了当前window，还是污染了全局window变量</span>
          rawWindow<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> rawWindow<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>proxy <span class="token operator">=</span> proxy<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">active</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>sandboxRunning<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 还原上次修改的值</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>currentUpdatedPropsValueMap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>currentUpdatedPropsValueMap<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>sandboxRunning <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">inactive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 将更新值的初始值还原给window</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modifiedPropsOriginalValueMapInSandbox<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      window<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modifiedPropsOriginalValueMapInSandbox<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 将新增的值删掉</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>addedPropsMapInSandbox<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">delete</span> window<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>sandboxRunning <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br></div></div></details> <p>同样会对window造成污染，但是性能比快照沙箱好，不用遍历window对象</p> <h3 id="proxysandbox代理沙箱"><a href="#proxysandbox代理沙箱" class="header-anchor">#</a> ProxySandbox代理沙箱</h3> <ul><li>激活沙箱后，每次对window取值的时候，先从自己沙箱环境的fakeWindow里面找，如果不存在，就从rawWindow(外部的window)里去找；</li> <li>当对沙箱内部的window对象赋值的时候，会直接操作fakeWindow，而不会影响到rawWindow
<img src="/assets/img/38.6adcd121.png" alt="proxySandbox"></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">ProxySandbox</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> rawWindow <span class="token operator">=</span> window
    <span class="token keyword">const</span> fakeWindow <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">const</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>fakeWindow<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> value <span class="token operator">=</span> prop <span class="token keyword">in</span> target <span class="token operator">?</span> target<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">:</span> rawWindow<span class="token punctuation">[</span>prop<span class="token punctuation">]</span>
        <span class="token keyword">return</span> value
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// set代理应当返回一个布尔值。严格模式下，set代理如果没有返回true，就会报错</span>
      <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sandboxRunning<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          target<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> value
          <span class="token keyword">return</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>sandboxRunning <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>proxy <span class="token operator">=</span> proxy
  <span class="token punctuation">}</span>
  <span class="token function">active</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>sandboxRunning <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
  <span class="token function">inactive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>sandboxRunning <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 测试</span>
  window<span class="token punctuation">.</span>sex <span class="token operator">=</span> <span class="token string">'男'</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> proxy1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProxySandbox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> proxy2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProxySandbox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">window</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    proxy1<span class="token punctuation">.</span><span class="token function">active</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'修改前proxy1的sex'</span><span class="token punctuation">,</span> window<span class="token punctuation">.</span>sex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    window<span class="token punctuation">.</span>sex <span class="token operator">=</span> <span class="token string">'女'</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'修改后proxy1的sex'</span><span class="token punctuation">,</span> window<span class="token punctuation">.</span>sex<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>proxy1<span class="token punctuation">.</span>proxy<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'外部window.sex=&gt;1'</span><span class="token punctuation">,</span> window<span class="token punctuation">.</span>sex<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">window</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    proxy2<span class="token punctuation">.</span><span class="token function">active</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'修改前proxy2的sex'</span><span class="token punctuation">,</span> window<span class="token punctuation">.</span>sex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    window<span class="token punctuation">.</span>sex <span class="token operator">=</span> <span class="token string">'111'</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'修改后proxy2的sex'</span><span class="token punctuation">,</span> window<span class="token punctuation">.</span>sex<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>proxy2<span class="token punctuation">.</span>proxy<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'外部window.sex=&gt;2'</span><span class="token punctuation">,</span> window<span class="token punctuation">.</span>sex<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p><img src="data:image/png;base64,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" alt="proxy"></p> <p>不会污染全局window，支持多个子应用同时加载。六一工作台的微前端JS隔离是用ProxySandbox方案</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>参考:
<a href="https://juejin.cn/post/6885211340999229454#heading-39" target="_blank" rel="noopener noreferrer">微前端框架 之 qiankun 从入门到源码分析<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://juejin.cn/post/6885212507837825038#heading-3" target="_blank" rel="noopener noreferrer">HTML Entry 源码分析<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://juejin.cn/post/6981374562877308936" target="_blank" rel="noopener noreferrer">说说微前端JS沙箱实现的几种方式<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://juejin.cn/post/6920110573418086413#heading-0" target="_blank" rel="noopener noreferrer">15分钟快速理解qiankun的js沙箱原理及其实现<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">11/2/2021, 4:44:24 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/project/B/sso-login.html" class="prev">
        单点登录
      </a></span> <span class="next"><a href="/project/H5/common-login-h5.html">
        统一登陆
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.e8c3aa62.js" defer></script><script src="/assets/js/2.1d5e0d04.js" defer></script><script src="/assets/js/18.5e0519af.js" defer></script>
  </body>
</html>
