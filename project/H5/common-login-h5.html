<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>需求背景 | Zohnny前端小册</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Zohnny前端小册">
    
    <link rel="preload" href="/assets/css/0.styles.9a0b0289.css" as="style"><link rel="preload" href="/assets/js/app.e8c3aa62.js" as="script"><link rel="preload" href="/assets/js/2.1d5e0d04.js" as="script"><link rel="preload" href="/assets/js/8.c0da64f7.js" as="script"><link rel="prefetch" href="/assets/js/10.0bc17075.js"><link rel="prefetch" href="/assets/js/100.194dcfa0.js"><link rel="prefetch" href="/assets/js/101.f8977d49.js"><link rel="prefetch" href="/assets/js/102.68d460f2.js"><link rel="prefetch" href="/assets/js/103.3ac580e7.js"><link rel="prefetch" href="/assets/js/104.9d4751c7.js"><link rel="prefetch" href="/assets/js/105.a5f0c700.js"><link rel="prefetch" href="/assets/js/106.e56dcf3c.js"><link rel="prefetch" href="/assets/js/107.1f1c30b4.js"><link rel="prefetch" href="/assets/js/108.68ca0fc6.js"><link rel="prefetch" href="/assets/js/109.50ce68c2.js"><link rel="prefetch" href="/assets/js/11.979bcc85.js"><link rel="prefetch" href="/assets/js/110.f56975a0.js"><link rel="prefetch" href="/assets/js/111.52d900c7.js"><link rel="prefetch" href="/assets/js/112.00424531.js"><link rel="prefetch" href="/assets/js/113.ea237985.js"><link rel="prefetch" href="/assets/js/114.57f07f83.js"><link rel="prefetch" href="/assets/js/115.ec061508.js"><link rel="prefetch" href="/assets/js/116.944ac05b.js"><link rel="prefetch" href="/assets/js/117.51a3bd3d.js"><link rel="prefetch" href="/assets/js/118.b1708a32.js"><link rel="prefetch" href="/assets/js/119.547f729e.js"><link rel="prefetch" href="/assets/js/12.f7837a85.js"><link rel="prefetch" href="/assets/js/120.77b77710.js"><link rel="prefetch" href="/assets/js/121.a6f28bc6.js"><link rel="prefetch" href="/assets/js/13.8e015820.js"><link rel="prefetch" href="/assets/js/14.34a558be.js"><link rel="prefetch" href="/assets/js/15.60fac476.js"><link rel="prefetch" href="/assets/js/16.be05c3ca.js"><link rel="prefetch" href="/assets/js/17.f8c4932c.js"><link rel="prefetch" href="/assets/js/18.5e0519af.js"><link rel="prefetch" href="/assets/js/19.db909a84.js"><link rel="prefetch" href="/assets/js/20.8cc2df06.js"><link rel="prefetch" href="/assets/js/21.f4b0b435.js"><link rel="prefetch" href="/assets/js/22.d559c9b3.js"><link rel="prefetch" href="/assets/js/23.74ba9f22.js"><link rel="prefetch" href="/assets/js/24.2a4117e9.js"><link rel="prefetch" href="/assets/js/25.73c08c20.js"><link rel="prefetch" href="/assets/js/26.c19cc994.js"><link rel="prefetch" href="/assets/js/27.81cd809b.js"><link rel="prefetch" href="/assets/js/28.6791b309.js"><link rel="prefetch" href="/assets/js/29.391ab5ba.js"><link rel="prefetch" href="/assets/js/3.1efbb513.js"><link rel="prefetch" href="/assets/js/30.0b1d7a71.js"><link rel="prefetch" href="/assets/js/31.1f2bb083.js"><link rel="prefetch" href="/assets/js/32.cae2775b.js"><link rel="prefetch" href="/assets/js/33.1e9405be.js"><link rel="prefetch" href="/assets/js/34.9210faf9.js"><link rel="prefetch" href="/assets/js/35.2ac222fd.js"><link rel="prefetch" href="/assets/js/36.c1aa7d10.js"><link rel="prefetch" href="/assets/js/37.47ed6a00.js"><link rel="prefetch" href="/assets/js/38.0743fb65.js"><link rel="prefetch" href="/assets/js/39.f1abc33e.js"><link rel="prefetch" href="/assets/js/4.c29c9b60.js"><link rel="prefetch" href="/assets/js/40.4c2c9b8b.js"><link rel="prefetch" href="/assets/js/41.f38fd71e.js"><link rel="prefetch" href="/assets/js/42.59cc5e7a.js"><link rel="prefetch" href="/assets/js/43.54713365.js"><link rel="prefetch" href="/assets/js/44.cc7cdb87.js"><link rel="prefetch" href="/assets/js/45.cdc6ea0c.js"><link rel="prefetch" href="/assets/js/46.2ab8048b.js"><link rel="prefetch" href="/assets/js/47.f6a00ea3.js"><link rel="prefetch" href="/assets/js/48.8349de8f.js"><link rel="prefetch" href="/assets/js/49.98c2ddda.js"><link rel="prefetch" href="/assets/js/5.40944f1c.js"><link rel="prefetch" href="/assets/js/50.425c325b.js"><link rel="prefetch" href="/assets/js/51.b4870e91.js"><link rel="prefetch" href="/assets/js/52.aef0d698.js"><link rel="prefetch" href="/assets/js/53.e07d00ac.js"><link rel="prefetch" href="/assets/js/54.b7687687.js"><link rel="prefetch" href="/assets/js/55.65cf97ed.js"><link rel="prefetch" href="/assets/js/56.3444efc3.js"><link rel="prefetch" href="/assets/js/57.5377eb7e.js"><link rel="prefetch" href="/assets/js/58.e5099448.js"><link rel="prefetch" href="/assets/js/59.d09bc881.js"><link rel="prefetch" href="/assets/js/6.732df0ed.js"><link rel="prefetch" href="/assets/js/60.eba8f995.js"><link rel="prefetch" href="/assets/js/61.bd8ab09f.js"><link rel="prefetch" href="/assets/js/62.0bd4e7fc.js"><link rel="prefetch" href="/assets/js/63.640df805.js"><link rel="prefetch" href="/assets/js/64.35c8b8f7.js"><link rel="prefetch" href="/assets/js/65.affde9cb.js"><link rel="prefetch" href="/assets/js/66.9f8cabb6.js"><link rel="prefetch" href="/assets/js/67.00890bbe.js"><link rel="prefetch" href="/assets/js/68.0936ba21.js"><link rel="prefetch" href="/assets/js/69.a33cdaf9.js"><link rel="prefetch" href="/assets/js/7.31bb07dc.js"><link rel="prefetch" href="/assets/js/70.1df3e127.js"><link rel="prefetch" href="/assets/js/71.f4124ef5.js"><link rel="prefetch" href="/assets/js/72.01e6c977.js"><link rel="prefetch" href="/assets/js/73.b07f15a4.js"><link rel="prefetch" href="/assets/js/74.f72cdef2.js"><link rel="prefetch" href="/assets/js/75.ee885b7d.js"><link rel="prefetch" href="/assets/js/76.84c918df.js"><link rel="prefetch" href="/assets/js/77.a28fd7f5.js"><link rel="prefetch" href="/assets/js/78.482bfb70.js"><link rel="prefetch" href="/assets/js/79.091c9dbf.js"><link rel="prefetch" href="/assets/js/80.df33fddc.js"><link rel="prefetch" href="/assets/js/81.6e6db080.js"><link rel="prefetch" href="/assets/js/82.e9138597.js"><link rel="prefetch" href="/assets/js/83.31c363ff.js"><link rel="prefetch" href="/assets/js/84.1e1be0f3.js"><link rel="prefetch" href="/assets/js/85.c861f43f.js"><link rel="prefetch" href="/assets/js/86.5a205712.js"><link rel="prefetch" href="/assets/js/87.d9dc3fb3.js"><link rel="prefetch" href="/assets/js/88.4297aa82.js"><link rel="prefetch" href="/assets/js/89.0a4430b5.js"><link rel="prefetch" href="/assets/js/9.0c30cda9.js"><link rel="prefetch" href="/assets/js/90.c95ae974.js"><link rel="prefetch" href="/assets/js/91.ff322a2a.js"><link rel="prefetch" href="/assets/js/92.6272aacc.js"><link rel="prefetch" href="/assets/js/93.f34792ac.js"><link rel="prefetch" href="/assets/js/94.5cd9fa78.js"><link rel="prefetch" href="/assets/js/95.4c0963b8.js"><link rel="prefetch" href="/assets/js/96.4b8520b9.js"><link rel="prefetch" href="/assets/js/97.cdf1abbd.js"><link rel="prefetch" href="/assets/js/98.4d55767c.js"><link rel="prefetch" href="/assets/js/99.0a1d65d6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9a0b0289.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Zohnny前端小册</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/basic/basic/" class="nav-link">
  基础
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  css
</a></div><div class="nav-item"><a href="/browser/theory/" class="nav-link">
  浏览器相关
</a></div><div class="nav-item"><a href="/nodejs/" class="nav-link">
  nodejs
</a></div><div class="nav-item"><a href="/babel/" class="nav-link">
  babel
</a></div><div class="nav-item"><a href="/buildTools/webpack/" class="nav-link">
  打包工具
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue/reactive/" class="nav-link">
  响应式
</a></li><li class="dropdown-item"><!----> <a href="/vue/compiler/" class="nav-link">
  模版编译
</a></li><li class="dropdown-item"><!----> <a href="/vue/vnode/" class="nav-link">
  虚拟DOM
</a></li><li class="dropdown-item"><!----> <a href="/vue/whole-process/" class="nav-link">
  整体流程
</a></li><li class="dropdown-item"><!----> <a href="/vue/vuex/" class="nav-link">
  Vuex&amp;Vue-router
</a></li></ul></div></div><div class="nav-item"><a href="/mobile/" class="nav-link">
  移动端
</a></div><div class="nav-item"><a href="/code-reviews/" class="nav-link">
  LC
</a></div><div class="nav-item"><a href="/project/B/batch_download.html" class="nav-link">
  项目
</a></div><div class="nav-item"><a href="/news/vue3.html" class="nav-link">
  前沿
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://0zcl.github.io/utils-library/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  公共函数库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://0zcl.github.io/h5-sdk/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  h5-sdk
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/0zcl/h5_template" target="_blank" rel="noopener noreferrer" class="nav-link external">
  移动端多页面模版
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/0zcl/zcl-mobile-ui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  移动端组件库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://gitlab.61info.com:8190/zcl/tpc-cli" target="_blank" rel="noopener noreferrer" class="nav-link external">
  zcl脚手架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/Dachuizi-6" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/basic/basic/" class="nav-link">
  基础
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  css
</a></div><div class="nav-item"><a href="/browser/theory/" class="nav-link">
  浏览器相关
</a></div><div class="nav-item"><a href="/nodejs/" class="nav-link">
  nodejs
</a></div><div class="nav-item"><a href="/babel/" class="nav-link">
  babel
</a></div><div class="nav-item"><a href="/buildTools/webpack/" class="nav-link">
  打包工具
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue/reactive/" class="nav-link">
  响应式
</a></li><li class="dropdown-item"><!----> <a href="/vue/compiler/" class="nav-link">
  模版编译
</a></li><li class="dropdown-item"><!----> <a href="/vue/vnode/" class="nav-link">
  虚拟DOM
</a></li><li class="dropdown-item"><!----> <a href="/vue/whole-process/" class="nav-link">
  整体流程
</a></li><li class="dropdown-item"><!----> <a href="/vue/vuex/" class="nav-link">
  Vuex&amp;Vue-router
</a></li></ul></div></div><div class="nav-item"><a href="/mobile/" class="nav-link">
  移动端
</a></div><div class="nav-item"><a href="/code-reviews/" class="nav-link">
  LC
</a></div><div class="nav-item"><a href="/project/B/batch_download.html" class="nav-link">
  项目
</a></div><div class="nav-item"><a href="/news/vue3.html" class="nav-link">
  前沿
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://0zcl.github.io/utils-library/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  公共函数库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://0zcl.github.io/h5-sdk/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  h5-sdk
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/0zcl/h5_template" target="_blank" rel="noopener noreferrer" class="nav-link external">
  移动端多页面模版
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/0zcl/zcl-mobile-ui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  移动端组件库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://gitlab.61info.com:8190/zcl/tpc-cli" target="_blank" rel="noopener noreferrer" class="nav-link external">
  zcl脚手架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/Dachuizi-6" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>B端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>移动端H5</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/project/H5/common-login-h5.html" aria-current="page" class="active sidebar-link">统一登陆</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/project/H5/common-login-h5.html#需求背景" class="sidebar-link">需求背景</a></li><li class="sidebar-sub-header"><a href="/project/H5/common-login-h5.html#业务-了解" class="sidebar-link">业务(了解)</a></li><li class="sidebar-sub-header"><a href="/project/H5/common-login-h5.html#统一登陆相关h5" class="sidebar-link">统一登陆相关H5</a></li><li class="sidebar-sub-header"><a href="/project/H5/common-login-h5.html#微信授权登陆" class="sidebar-link">微信授权登陆</a></li><li class="sidebar-sub-header"><a href="/project/H5/common-login-h5.html#统一登陆banner" class="sidebar-link">统一登陆Banner</a></li><li class="sidebar-sub-header"><a href="/project/H5/common-login-h5.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/project/H5/h5-sdk.html" class="sidebar-link">h5-sdk</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/project/H5/h5-sdk.html#需求场景" class="sidebar-link">需求场景</a></li><li class="sidebar-sub-header"><a href="/project/H5/h5-sdk.html#拓展性实现" class="sidebar-link">拓展性实现</a></li><li class="sidebar-sub-header"><a href="/project/H5/h5-sdk.html#一、appsdk" class="sidebar-link">一、appSdk</a></li><li class="sidebar-sub-header"><a href="/project/H5/h5-sdk.html#二、wxsdk" class="sidebar-link">二、wxSdk</a></li><li class="sidebar-sub-header"><a href="/project/H5/h5-sdk.html#三、loginsdk" class="sidebar-link">三、loginSdk</a></li><li class="sidebar-sub-header"><a href="/project/H5/h5-sdk.html#登陆banner" class="sidebar-link">登陆Banner</a></li><li class="sidebar-sub-header"><a href="/project/H5/h5-sdk.html#loginsdk难点" class="sidebar-link">loginSdk难点</a></li><li class="sidebar-sub-header"><a href="/project/H5/h5-sdk.html#打包优化" class="sidebar-link">打包优化</a></li><li class="sidebar-sub-header"><a href="/project/H5/h5-sdk.html#打包难点" class="sidebar-link">打包难点</a></li><li class="sidebar-sub-header"><a href="/project/H5/h5-sdk.html#部署" class="sidebar-link">部署</a></li><li class="sidebar-sub-header"><a href="/project/H5/h5-sdk.html#nginx配置" class="sidebar-link">nginx配置</a></li><li class="sidebar-sub-header"><a href="/project/H5/h5-sdk.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/project/H5/h5-template.html" class="sidebar-link">vue移动端多页面</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/project/H5/h5-template.html#场景" class="sidebar-link">场景</a></li><li class="sidebar-sub-header"><a href="/project/H5/h5-template.html#代码" class="sidebar-link">代码</a></li></ul></li><li><a href="/project/H5/mobile-ui.html" class="sidebar-link">移动端UI组件库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/project/H5/mobile-ui.html#场景" class="sidebar-link">场景</a></li><li class="sidebar-sub-header"><a href="/project/H5/mobile-ui.html#实现" class="sidebar-link">实现</a></li><li class="sidebar-sub-header"><a href="/project/H5/mobile-ui.html#难点" class="sidebar-link">难点</a></li><li class="sidebar-sub-header"><a href="/project/H5/mobile-ui.html#vant-cli源码简析" class="sidebar-link">vant-cli源码简析</a></li><li class="sidebar-sub-header"><a href="/project/H5/mobile-ui.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/project/H5/pay-center.html" class="sidebar-link">支付中心</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/project/H5/pay-center.html#场景" class="sidebar-link">场景</a></li><li class="sidebar-sub-header"><a href="/project/H5/pay-center.html#业务" class="sidebar-link">业务</a></li><li class="sidebar-sub-header"><a href="/project/H5/pay-center.html#难点" class="sidebar-link">难点</a></li><li class="sidebar-sub-header"><a href="/project/H5/pay-center.html#总结" class="sidebar-link">总结</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default" data-v-b392aade data-v-b392aade><h2 id="需求背景" data-v-b392aade><a href="#需求背景" class="header-anchor" data-v-b392aade>#</a> 需求背景</h2> <ul data-v-b392aade><li data-v-b392aade><code data-v-b392aade>重复开发</code>，效率低。各个业务都是独自设计和开发的登录页，重复造轮子(copy代码也累)。</li> <li data-v-b392aade><code data-v-b392aade>重复维护</code>，维护难。登录逻辑有修改，需要整理全部需要登录的业务，容易遗漏，然后单个修改处理，消耗人力</li></ul> <p data-v-b392aade>基于以上问题。想把登陆相关页面与逻辑从业务中抽离出来，统一维护。</p> <h2 id="业务-了解" data-v-b392aade><a href="#业务-了解" class="header-anchor" data-v-b392aade>#</a> 业务(了解)</h2> <p data-v-b392aade>这部分不介绍。自行查看大图
</p><div class="img-box" data-v-b392aade><div data-v-b392aade><p data-v-b392aade>验证码登录</p> <img src="/assets/img/smsCode.2754e765.png" class="small-img" data-v-b392aade></div> <div data-v-b392aade><p data-v-b392aade>密码登录</p> <img src="/assets/img/pwd.d73c60d8.png" class="small-img" data-v-b392aade></div> <div data-v-b392aade><p data-v-b392aade>找回密码</p> <img src="/assets/img/findPwd.fb87649c.png" class="small-img" data-v-b392aade></div></div><p data-v-b392aade></p> <ul data-v-b392aade><li data-v-b392aade>相关页面</li></ul> <p data-v-b392aade><img src="/assets/img/commonLogin.e5756f35.png" alt="common-login" data-v-b392aade></p> <h2 id="统一登陆相关h5" data-v-b392aade><a href="#统一登陆相关h5" class="header-anchor" data-v-b392aade>#</a> 统一登陆相关H5</h2> <p data-v-b392aade>统一登陆相关H5包括：登陆页、注册页、用户隐私政策页、用户协议页、忘记密码(找回密码)页。这都是常见且通用的页面。产品和UI根据公司产品风格统一好UI后，前端就可以进行开发。开个新项目hll-common-login-h5，使用Vue + webpack打包即可。</p> <p data-v-b392aade>登陆页：</p> <ol data-v-b392aade><li data-v-b392aade><code data-v-b392aade>gotoUrl</code>: gotoUrl是登陆成功的回跳地址</li> <li data-v-b392aade><code data-v-b392aade>appType</code>：表示不同的公众号类型，默认为1表示hll VIP课堂；2表示分销平台公众号。问了下同事，说是由于分销平台风险高，可能会被微信封号，所以才多加个销平台公众号。</li> <li data-v-b392aade><code data-v-b392aade>loginEnv</code>: 登陆环境。目前有三种：微信环境，APP环境，web(浏览器)环境。后端接口需要传这个参数，因此前端需要loginEnv字段</li></ol> <div class="language-js line-numbers-mode" data-v-b392aade><pre class="language-js" data-v-b392aade><code data-v-b392aade><span class="token comment" data-v-b392aade>// 页面链接：http://pay-test.61info.cn/common-login-test/#/login?appType=1&amp;gotoUrl=http%3A%2F%2F172.16.28.108%3A3000%2F%23home</span>
<span class="token function" data-v-b392aade>created</span><span class="token punctuation" data-v-b392aade>(</span><span class="token punctuation" data-v-b392aade>)</span> <span class="token punctuation" data-v-b392aade>{</span>
  <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>gotoUrl <span class="token operator" data-v-b392aade>=</span> <span class="token function" data-v-b392aade>getQueryString</span><span class="token punctuation" data-v-b392aade>(</span><span class="token string" data-v-b392aade>'gotoUrl'</span><span class="token punctuation" data-v-b392aade>)</span>
  <span class="token keyword" data-v-b392aade>if</span> <span class="token punctuation" data-v-b392aade>(</span><span class="token operator" data-v-b392aade>!</span><span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>gotoUrl<span class="token punctuation" data-v-b392aade>)</span> <span class="token punctuation" data-v-b392aade>{</span>
    <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>gotoUrl <span class="token operator" data-v-b392aade>=</span> sessionStorage<span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>getItem</span><span class="token punctuation" data-v-b392aade>(</span><span class="token string" data-v-b392aade>'gotoUrl'</span><span class="token punctuation" data-v-b392aade>)</span> <span class="token operator" data-v-b392aade>||</span> <span class="token string" data-v-b392aade>''</span>
  <span class="token punctuation" data-v-b392aade>}</span> <span class="token keyword" data-v-b392aade>else</span> <span class="token punctuation" data-v-b392aade>{</span>
    sessionStorage<span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>setItem</span><span class="token punctuation" data-v-b392aade>(</span><span class="token string" data-v-b392aade>'gotoUrl'</span><span class="token punctuation" data-v-b392aade>,</span> <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>gotoUrl<span class="token punctuation" data-v-b392aade>)</span>
  <span class="token punctuation" data-v-b392aade>}</span>
  <span class="token comment" data-v-b392aade>// 登录环境：1=web环境；2=微信环境；3=app环境</span>
  <span class="token keyword" data-v-b392aade>const</span> ua <span class="token operator" data-v-b392aade>=</span> navigator<span class="token punctuation" data-v-b392aade>.</span>userAgent
  <span class="token keyword" data-v-b392aade>if</span> <span class="token punctuation" data-v-b392aade>(</span>ua<span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>indexOf</span><span class="token punctuation" data-v-b392aade>(</span><span class="token string" data-v-b392aade>'MicroMessenger'</span><span class="token punctuation" data-v-b392aade>)</span> <span class="token operator" data-v-b392aade>&gt;</span> <span class="token operator" data-v-b392aade>-</span><span class="token number" data-v-b392aade>1</span><span class="token punctuation" data-v-b392aade>)</span> <span class="token punctuation" data-v-b392aade>{</span>
    <span class="token comment" data-v-b392aade>// 微信环境</span>
    <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>loginEnv <span class="token operator" data-v-b392aade>=</span> <span class="token number" data-v-b392aade>2</span>
    <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>getCode</span><span class="token punctuation" data-v-b392aade>(</span><span class="token punctuation" data-v-b392aade>)</span> <span class="token comment" data-v-b392aade>// 下面微信授权登陆细说</span>
  <span class="token punctuation" data-v-b392aade>}</span> <span class="token keyword" data-v-b392aade>else</span> <span class="token keyword" data-v-b392aade>if</span> <span class="token punctuation" data-v-b392aade>(</span>ua<span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>indexOf</span><span class="token punctuation" data-v-b392aade>(</span><span class="token string" data-v-b392aade>'hualalaApp'</span><span class="token punctuation" data-v-b392aade>)</span> <span class="token operator" data-v-b392aade>&gt;</span> <span class="token operator" data-v-b392aade>-</span><span class="token number" data-v-b392aade>1</span><span class="token punctuation" data-v-b392aade>)</span> <span class="token punctuation" data-v-b392aade>{</span>
    <span class="token comment" data-v-b392aade>// APP环境</span>
    <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>loginEnv <span class="token operator" data-v-b392aade>=</span> <span class="token number" data-v-b392aade>3</span>
  <span class="token punctuation" data-v-b392aade>}</span> <span class="token keyword" data-v-b392aade>else</span> <span class="token punctuation" data-v-b392aade>{</span>
    <span class="token comment" data-v-b392aade>// web环境</span>
    <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>loginEnv <span class="token operator" data-v-b392aade>=</span> <span class="token number" data-v-b392aade>1</span>
  <span class="token punctuation" data-v-b392aade>}</span>
<span class="token punctuation" data-v-b392aade>}</span>

<span class="token comment" data-v-b392aade>// 通用处理获取验证码，倒计时60秒</span>
<span class="token function" data-v-b392aade>handleCommonSms</span><span class="token punctuation" data-v-b392aade>(</span><span class="token punctuation" data-v-b392aade>)</span> <span class="token punctuation" data-v-b392aade>{</span>
  <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>$toast</span><span class="token punctuation" data-v-b392aade>(</span><span class="token template-string" data-v-b392aade><span class="token template-punctuation string" data-v-b392aade>`</span><span class="token string" data-v-b392aade>已发送验证码至</span><span class="token interpolation" data-v-b392aade><span class="token interpolation-punctuation punctuation" data-v-b392aade>${</span><span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>form<span class="token punctuation" data-v-b392aade>.</span>phone<span class="token interpolation-punctuation punctuation" data-v-b392aade>}</span></span><span class="token string" data-v-b392aade>，请注意查收</span><span class="token template-punctuation string" data-v-b392aade>`</span></span><span class="token punctuation" data-v-b392aade>)</span>
  <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>smsSendStatus <span class="token operator" data-v-b392aade>=</span> <span class="token boolean" data-v-b392aade>true</span>
  <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>smsCountDownInterval <span class="token operator" data-v-b392aade>=</span> <span class="token function" data-v-b392aade>setInterval</span><span class="token punctuation" data-v-b392aade>(</span><span class="token punctuation" data-v-b392aade>(</span><span class="token punctuation" data-v-b392aade>)</span> <span class="token operator" data-v-b392aade>=&gt;</span> <span class="token punctuation" data-v-b392aade>{</span>
    <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>smsCountDown <span class="token operator" data-v-b392aade>-=</span> <span class="token number" data-v-b392aade>1</span>
    <span class="token keyword" data-v-b392aade>if</span> <span class="token punctuation" data-v-b392aade>(</span><span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>smsCountDown <span class="token operator" data-v-b392aade>===</span> <span class="token number" data-v-b392aade>0</span><span class="token punctuation" data-v-b392aade>)</span> <span class="token punctuation" data-v-b392aade>{</span>
      <span class="token function" data-v-b392aade>clearInterval</span><span class="token punctuation" data-v-b392aade>(</span><span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>smsCountDownInterval<span class="token punctuation" data-v-b392aade>)</span>
      <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>smsCountDown <span class="token operator" data-v-b392aade>=</span> <span class="token number" data-v-b392aade>60</span>
      <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>smsSendStatus <span class="token operator" data-v-b392aade>=</span> <span class="token boolean" data-v-b392aade>false</span>
    <span class="token punctuation" data-v-b392aade>}</span>
  <span class="token punctuation" data-v-b392aade>}</span><span class="token punctuation" data-v-b392aade>,</span> <span class="token number" data-v-b392aade>1000</span><span class="token punctuation" data-v-b392aade>)</span>
<span class="token punctuation" data-v-b392aade>}</span><span class="token punctuation" data-v-b392aade>,</span>
</code></pre> <div class="line-numbers-wrapper" data-v-b392aade><span class="line-number" data-v-b392aade>1</span><br data-v-b392aade><span class="line-number" data-v-b392aade>2</span><br data-v-b392aade><span class="line-number" data-v-b392aade>3</span><br data-v-b392aade><span class="line-number" data-v-b392aade>4</span><br data-v-b392aade><span class="line-number" data-v-b392aade>5</span><br data-v-b392aade><span class="line-number" data-v-b392aade>6</span><br data-v-b392aade><span class="line-number" data-v-b392aade>7</span><br data-v-b392aade><span class="line-number" data-v-b392aade>8</span><br data-v-b392aade><span class="line-number" data-v-b392aade>9</span><br data-v-b392aade><span class="line-number" data-v-b392aade>10</span><br data-v-b392aade><span class="line-number" data-v-b392aade>11</span><br data-v-b392aade><span class="line-number" data-v-b392aade>12</span><br data-v-b392aade><span class="line-number" data-v-b392aade>13</span><br data-v-b392aade><span class="line-number" data-v-b392aade>14</span><br data-v-b392aade><span class="line-number" data-v-b392aade>15</span><br data-v-b392aade><span class="line-number" data-v-b392aade>16</span><br data-v-b392aade><span class="line-number" data-v-b392aade>17</span><br data-v-b392aade><span class="line-number" data-v-b392aade>18</span><br data-v-b392aade><span class="line-number" data-v-b392aade>19</span><br data-v-b392aade><span class="line-number" data-v-b392aade>20</span><br data-v-b392aade><span class="line-number" data-v-b392aade>21</span><br data-v-b392aade><span class="line-number" data-v-b392aade>22</span><br data-v-b392aade><span class="line-number" data-v-b392aade>23</span><br data-v-b392aade><span class="line-number" data-v-b392aade>24</span><br data-v-b392aade><span class="line-number" data-v-b392aade>25</span><br data-v-b392aade><span class="line-number" data-v-b392aade>26</span><br data-v-b392aade><span class="line-number" data-v-b392aade>27</span><br data-v-b392aade><span class="line-number" data-v-b392aade>28</span><br data-v-b392aade><span class="line-number" data-v-b392aade>29</span><br data-v-b392aade><span class="line-number" data-v-b392aade>30</span><br data-v-b392aade><span class="line-number" data-v-b392aade>31</span><br data-v-b392aade><span class="line-number" data-v-b392aade>32</span><br data-v-b392aade><span class="line-number" data-v-b392aade>33</span><br data-v-b392aade><span class="line-number" data-v-b392aade>34</span><br data-v-b392aade><span class="line-number" data-v-b392aade>35</span><br data-v-b392aade><span class="line-number" data-v-b392aade>36</span><br data-v-b392aade></div></div><p data-v-b392aade>登陆成功后跳转</p> <ul data-v-b392aade><li data-v-b392aade>非微信环境：回到回跳地址，并在链接上带上userToken, refreshToken</li> <li data-v-b392aade>微信环境：微信环境，有两种方式来到登陆页</li></ul> <ol data-v-b392aade><li data-v-b392aade>业务登陆入口 --&gt; 登陆页 --&gt; 业务页面。业务登陆入口 跳转到 登陆页，登陆成功后，回到业务页面。</li> <li data-v-b392aade>绑定页面 --&gt; 登陆页 --&gt; 绑定页。绑定页面点添加宝贝 跳转到 登陆页，登陆成功，前端再做绑定，最后回到绑定页面查看绑定列表。</li></ol> <p data-v-b392aade><img src="/assets/img/bind.7fe0e92c.png" alt="bind" data-v-b392aade></p> <div class="custom-block tip" data-v-b392aade><p class="custom-block-title" data-v-b392aade>Tips</p> <p data-v-b392aade>微信绑定账号需求背景：
家长可以通过【画啦啦VIP课堂】服务号，获得孩子的上课通知、作业通知、阶段学习报告等消息；但是家长需要完成两个行为才可以</p> <ol data-v-b392aade><li data-v-b392aade>微信绑定画啦啦账号</li> <li data-v-b392aade>关注【画啦啦VIP课堂】</li></ol> <p data-v-b392aade>产品为了：提高家长账号绑定微信号的占比，为后续通过微信公众号通知家长上课、作业、请假、学习报告等，提高人效</p> <p data-v-b392aade>因此，家长在微信环境登录画啦啦账号时，给用户默认微信绑定账号。<code data-v-b392aade>登陆成功后给用户绑定账号</code></p></div> <div class="language-js line-numbers-mode" data-v-b392aade><pre class="language-js" data-v-b392aade><code data-v-b392aade><span class="token comment" data-v-b392aade>// 登录成功后跳转</span>
<span class="token function" data-v-b392aade>handleRedirect</span><span class="token punctuation" data-v-b392aade>(</span><span class="token punctuation" data-v-b392aade>)</span> <span class="token punctuation" data-v-b392aade>{</span>
  <span class="token comment" data-v-b392aade>// 微信环境下</span>
  <span class="token keyword" data-v-b392aade>if</span> <span class="token punctuation" data-v-b392aade>(</span>navigator<span class="token punctuation" data-v-b392aade>.</span>userAgent<span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>indexOf</span><span class="token punctuation" data-v-b392aade>(</span><span class="token string" data-v-b392aade>'MicroMessenger'</span><span class="token punctuation" data-v-b392aade>)</span> <span class="token operator" data-v-b392aade>&gt;</span> <span class="token operator" data-v-b392aade>-</span><span class="token number" data-v-b392aade>1</span><span class="token punctuation" data-v-b392aade>)</span> <span class="token punctuation" data-v-b392aade>{</span>
    <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>handleBindAccount</span><span class="token punctuation" data-v-b392aade>(</span><span class="token punctuation" data-v-b392aade>)</span>
  <span class="token punctuation" data-v-b392aade>}</span> <span class="token keyword" data-v-b392aade>else</span> <span class="token punctuation" data-v-b392aade>{</span>
    <span class="token comment" data-v-b392aade>// 非微信环境, 登陆成功后，回到业务页面</span>
    location<span class="token punctuation" data-v-b392aade>.</span>href <span class="token operator" data-v-b392aade>=</span> <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>gotoUrl <span class="token operator" data-v-b392aade>+</span> <span class="token template-string" data-v-b392aade><span class="token template-punctuation string" data-v-b392aade>`</span><span class="token string" data-v-b392aade>&amp;userToken=</span><span class="token interpolation" data-v-b392aade><span class="token interpolation-punctuation punctuation" data-v-b392aade>${</span><span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>userToken<span class="token interpolation-punctuation punctuation" data-v-b392aade>}</span></span><span class="token string" data-v-b392aade>&amp;refreshToken=</span><span class="token interpolation" data-v-b392aade><span class="token interpolation-punctuation punctuation" data-v-b392aade>${</span><span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>refreshToken<span class="token interpolation-punctuation punctuation" data-v-b392aade>}</span></span><span class="token template-punctuation string" data-v-b392aade>`</span></span>
  <span class="token punctuation" data-v-b392aade>}</span>
<span class="token punctuation" data-v-b392aade>}</span>
<span class="token comment" data-v-b392aade>// 绑定账号</span>
<span class="token function" data-v-b392aade>handleBindAccount</span><span class="token punctuation" data-v-b392aade>(</span><span class="token punctuation" data-v-b392aade>)</span> <span class="token punctuation" data-v-b392aade>{</span>
  <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>$toast<span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>loading</span><span class="token punctuation" data-v-b392aade>(</span><span class="token punctuation" data-v-b392aade>{</span>
    <span class="token literal-property property" data-v-b392aade>message</span><span class="token operator" data-v-b392aade>:</span> <span class="token string" data-v-b392aade>'绑定账号中...'</span><span class="token punctuation" data-v-b392aade>,</span>
    <span class="token literal-property property" data-v-b392aade>forbidClick</span><span class="token operator" data-v-b392aade>:</span> <span class="token boolean" data-v-b392aade>true</span><span class="token punctuation" data-v-b392aade>,</span>
    <span class="token literal-property property" data-v-b392aade>loadingType</span><span class="token operator" data-v-b392aade>:</span> <span class="token string" data-v-b392aade>'spinner'</span><span class="token punctuation" data-v-b392aade>,</span>
    <span class="token literal-property property" data-v-b392aade>duration</span><span class="token operator" data-v-b392aade>:</span> <span class="token number" data-v-b392aade>0</span><span class="token punctuation" data-v-b392aade>,</span>
  <span class="token punctuation" data-v-b392aade>}</span><span class="token punctuation" data-v-b392aade>)</span>
  <span class="token function" data-v-b392aade>request</span><span class="token punctuation" data-v-b392aade>(</span><span class="token string" data-v-b392aade>'xxx-发起绑定请求'</span><span class="token punctuation" data-v-b392aade>)</span><span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>then</span><span class="token punctuation" data-v-b392aade>(</span><span class="token parameter" data-v-b392aade>res</span> <span class="token operator" data-v-b392aade>=&gt;</span> <span class="token punctuation" data-v-b392aade>{</span>
    <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>$toast<span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>clear</span><span class="token punctuation" data-v-b392aade>(</span><span class="token punctuation" data-v-b392aade>)</span>
    <span class="token keyword" data-v-b392aade>if</span> <span class="token punctuation" data-v-b392aade>(</span><span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>gotoUrl<span class="token punctuation" data-v-b392aade>)</span> <span class="token punctuation" data-v-b392aade>{</span>
      <span class="token comment" data-v-b392aade>// 微信环境, 回到业务页面</span>
      location<span class="token punctuation" data-v-b392aade>.</span>href <span class="token operator" data-v-b392aade>=</span> <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>gotoUrl <span class="token operator" data-v-b392aade>+</span> <span class="token template-string" data-v-b392aade><span class="token template-punctuation string" data-v-b392aade>`</span><span class="token string" data-v-b392aade>&amp;userToken=</span><span class="token interpolation" data-v-b392aade><span class="token interpolation-punctuation punctuation" data-v-b392aade>${</span><span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>userToken<span class="token interpolation-punctuation punctuation" data-v-b392aade>}</span></span><span class="token string" data-v-b392aade>&amp;refreshToken=</span><span class="token interpolation" data-v-b392aade><span class="token interpolation-punctuation punctuation" data-v-b392aade>${</span><span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>refreshToken<span class="token interpolation-punctuation punctuation" data-v-b392aade>}</span></span><span class="token template-punctuation string" data-v-b392aade>`</span></span>
    <span class="token punctuation" data-v-b392aade>}</span> <span class="token keyword" data-v-b392aade>else</span> <span class="token punctuation" data-v-b392aade>{</span>
      <span class="token comment" data-v-b392aade>// 微信环境, 回到绑定页面</span>
      window<span class="token punctuation" data-v-b392aade>.</span>location<span class="token punctuation" data-v-b392aade>.</span>href <span class="token operator" data-v-b392aade>=</span> location<span class="token punctuation" data-v-b392aade>.</span>origin <span class="token operator" data-v-b392aade>+</span> location<span class="token punctuation" data-v-b392aade>.</span>pathname <span class="token operator" data-v-b392aade>+</span> <span class="token string" data-v-b392aade>'?time='</span> <span class="token operator" data-v-b392aade>+</span> <span class="token function" data-v-b392aade>Number</span><span class="token punctuation" data-v-b392aade>(</span><span class="token keyword" data-v-b392aade>new</span> <span class="token class-name" data-v-b392aade>Date</span><span class="token punctuation" data-v-b392aade>(</span><span class="token punctuation" data-v-b392aade>)</span><span class="token punctuation" data-v-b392aade>)</span> <span class="token operator" data-v-b392aade>+</span> <span class="token string" data-v-b392aade>'#bind?appType='</span> <span class="token operator" data-v-b392aade>+</span> <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>appType
    <span class="token punctuation" data-v-b392aade>}</span>
  <span class="token punctuation" data-v-b392aade>}</span><span class="token punctuation" data-v-b392aade>)</span>
<span class="token punctuation" data-v-b392aade>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-b392aade><span class="line-number" data-v-b392aade>1</span><br data-v-b392aade><span class="line-number" data-v-b392aade>2</span><br data-v-b392aade><span class="line-number" data-v-b392aade>3</span><br data-v-b392aade><span class="line-number" data-v-b392aade>4</span><br data-v-b392aade><span class="line-number" data-v-b392aade>5</span><br data-v-b392aade><span class="line-number" data-v-b392aade>6</span><br data-v-b392aade><span class="line-number" data-v-b392aade>7</span><br data-v-b392aade><span class="line-number" data-v-b392aade>8</span><br data-v-b392aade><span class="line-number" data-v-b392aade>9</span><br data-v-b392aade><span class="line-number" data-v-b392aade>10</span><br data-v-b392aade><span class="line-number" data-v-b392aade>11</span><br data-v-b392aade><span class="line-number" data-v-b392aade>12</span><br data-v-b392aade><span class="line-number" data-v-b392aade>13</span><br data-v-b392aade><span class="line-number" data-v-b392aade>14</span><br data-v-b392aade><span class="line-number" data-v-b392aade>15</span><br data-v-b392aade><span class="line-number" data-v-b392aade>16</span><br data-v-b392aade><span class="line-number" data-v-b392aade>17</span><br data-v-b392aade><span class="line-number" data-v-b392aade>18</span><br data-v-b392aade><span class="line-number" data-v-b392aade>19</span><br data-v-b392aade><span class="line-number" data-v-b392aade>20</span><br data-v-b392aade><span class="line-number" data-v-b392aade>21</span><br data-v-b392aade><span class="line-number" data-v-b392aade>22</span><br data-v-b392aade><span class="line-number" data-v-b392aade>23</span><br data-v-b392aade><span class="line-number" data-v-b392aade>24</span><br data-v-b392aade><span class="line-number" data-v-b392aade>25</span><br data-v-b392aade><span class="line-number" data-v-b392aade>26</span><br data-v-b392aade><span class="line-number" data-v-b392aade>27</span><br data-v-b392aade><span class="line-number" data-v-b392aade>28</span><br data-v-b392aade><span class="line-number" data-v-b392aade>29</span><br data-v-b392aade></div></div><h2 id="微信授权登陆" data-v-b392aade><a href="#微信授权登陆" class="header-anchor" data-v-b392aade>#</a> 微信授权登陆</h2> <p data-v-b392aade>微信<a href="(https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html)" data-v-b392aade>网页授权</a>有两种：</p> <ul data-v-b392aade><li data-v-b392aade>主动授权：<code data-v-b392aade>scope=snsapi_userinfo</code> 静默授权并自动跳转到回调页的。用户感知的就是直接进入了回调页（往往是业务页面）</li> <li data-v-b392aade>静默授权：<code data-v-b392aade>scope=snsapi_base</code> 需要用户手动同意，并且由于用户同意过，所以无须关注，就可在授权后获取该用户的基本信息</li></ul> <h3 id="网页授权流程分为四步" data-v-b392aade><a href="#网页授权流程分为四步" class="header-anchor" data-v-b392aade>#</a> 网页授权流程分为四步</h3> <ol data-v-b392aade><li data-v-b392aade>用户同意授权，获取code</li></ol> <div class="language-js line-numbers-mode" data-v-b392aade><pre class="language-js" data-v-b392aade><code data-v-b392aade><span class="token comment" data-v-b392aade>// 由于授权操作安全等级较高，所以在发起授权请求时，微信会对授权链接做正则强匹配校验，如果链接的参数顺序不对，授权页面将无法正常访问</span>
<span class="token literal-property property" data-v-b392aade>https</span><span class="token operator" data-v-b392aade>:</span><span class="token operator" data-v-b392aade>/</span><span class="token operator" data-v-b392aade>/</span>open<span class="token punctuation" data-v-b392aade>.</span>weixin<span class="token punctuation" data-v-b392aade>.</span>qq<span class="token punctuation" data-v-b392aade>.</span>com<span class="token operator" data-v-b392aade>/</span>connect<span class="token operator" data-v-b392aade>/</span>oauth2<span class="token operator" data-v-b392aade>/</span>authorize<span class="token operator" data-v-b392aade>?</span>appid<span class="token operator" data-v-b392aade>=</span><span class="token constant" data-v-b392aade>APPID</span><span class="token operator" data-v-b392aade>&amp;</span>redirect_uri<span class="token operator" data-v-b392aade>=</span><span class="token constant" data-v-b392aade>REDIRECT_URI</span><span class="token operator" data-v-b392aade>&amp;</span>response_type<span class="token operator" data-v-b392aade>=</span>code<span class="token operator" data-v-b392aade>&amp;</span>scope<span class="token operator" data-v-b392aade>=</span><span class="token constant" data-v-b392aade>SCOPE</span><span class="token operator" data-v-b392aade>&amp;</span>state<span class="token operator" data-v-b392aade>=</span><span class="token constant" data-v-b392aade>STATE</span>#wechat_redirect
</code></pre> <div class="line-numbers-wrapper" data-v-b392aade><span class="line-number" data-v-b392aade>1</span><br data-v-b392aade><span class="line-number" data-v-b392aade>2</span><br data-v-b392aade></div></div><p data-v-b392aade>下图为scope等于snsapi_userinfo时的授权页面：界面样式可能不一样</p> <p data-v-b392aade><img src="data:image/png;base64,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" alt="主动授权" data-v-b392aade></p> <ol start="2" data-v-b392aade><li data-v-b392aade>通过code换取网页授权access_token和openid: 这部分<code data-v-b392aade>后端实现</code></li> <li data-v-b392aade>刷新access_token（如果需要）</li> <li data-v-b392aade>拉取用户信息(需scope为 snsapi_userinfo)
如果网页授权作用域为snsapi_userinfo，则此时开发者可以通过access_token和openid拉取用户信息了</li></ol> <table data-v-b392aade><thead data-v-b392aade><tr data-v-b392aade><th data-v-b392aade>参数</th> <th data-v-b392aade>描述</th></tr></thead> <tbody data-v-b392aade><tr data-v-b392aade><td data-v-b392aade>openid</td> <td data-v-b392aade>用户的唯一标识</td></tr> <tr data-v-b392aade><td data-v-b392aade>nickname</td> <td data-v-b392aade>用户昵称</td></tr> <tr data-v-b392aade><td data-v-b392aade>sex</td> <td data-v-b392aade>用户的性别，值为1时是男性，值为2时是女性，值为0时是未知</td></tr> <tr data-v-b392aade><td data-v-b392aade>province</td> <td data-v-b392aade>用户个人资料填写的省份</td></tr> <tr data-v-b392aade><td data-v-b392aade>city</td> <td data-v-b392aade>普通用户个人资料填写的城市</td></tr> <tr data-v-b392aade><td data-v-b392aade>country</td> <td data-v-b392aade>国家，如中国为CN</td></tr> <tr data-v-b392aade><td data-v-b392aade>headimgurl</td> <td data-v-b392aade>用户头像，最后一个数值代表正方形头像大小（有0、46、64、96、132数值可选，0</td></tr> <tr data-v-b392aade><td data-v-b392aade>privilege</td> <td data-v-b392aade>用户特权信息，json 数组，如微信沃卡用户为（chinaunicom）</td></tr> <tr data-v-b392aade><td data-v-b392aade>unionid</td> <td data-v-b392aade>只有在用户将公众号绑定到微信开放平台帐号后，才会出现该字段。</td></tr></tbody></table> <p data-v-b392aade>后端 openId 和用户信息做关联，通过openId能拿到用户信息。</p> <div class="custom-block warning" data-v-b392aade><p class="custom-block-title" data-v-b392aade>Note</p> <p data-v-b392aade>为什么登陆页用主动授权？ 绑定列表页用静默授权？</p></div> <p data-v-b392aade>登陆页要用主动授权是由于，<code data-v-b392aade>只有主动授权才能拿到用户的微信相关信息</code>(字段如上)，然后后端保存用户微信信息，并用用户openId做关联，通过openId就可以查到用户相关信息。</p> <div class="language-js line-numbers-mode" data-v-b392aade><pre class="language-js" data-v-b392aade><code data-v-b392aade><span class="token comment" data-v-b392aade>// 微信登录失败重试次数</span>
<span class="token keyword" data-v-b392aade>const</span> <span class="token constant" data-v-b392aade>WX_AUTO_LOGIN_RETRY_COUNT</span> <span class="token operator" data-v-b392aade>=</span> <span class="token number" data-v-b392aade>2</span>
<span class="token comment" data-v-b392aade>// 微信登录失败重试间隔秒数</span>
<span class="token keyword" data-v-b392aade>const</span> <span class="token constant" data-v-b392aade>WX_AUTO_LOGIN_RETRY_TIME</span> <span class="token operator" data-v-b392aade>=</span> <span class="token number" data-v-b392aade>5</span>
<span class="token function" data-v-b392aade>created</span><span class="token punctuation" data-v-b392aade>(</span><span class="token punctuation" data-v-b392aade>)</span> <span class="token punctuation" data-v-b392aade>{</span>
  <span class="token comment" data-v-b392aade>// 微信环境</span>
  <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>getCode</span><span class="token punctuation" data-v-b392aade>(</span><span class="token punctuation" data-v-b392aade>)</span>
<span class="token punctuation" data-v-b392aade>}</span>
<span class="token literal-property property" data-v-b392aade>methods</span><span class="token operator" data-v-b392aade>:</span> <span class="token punctuation" data-v-b392aade>{</span>
  <span class="token function" data-v-b392aade>getCode</span><span class="token punctuation" data-v-b392aade>(</span><span class="token punctuation" data-v-b392aade>)</span> <span class="token punctuation" data-v-b392aade>{</span>
    <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>code <span class="token operator" data-v-b392aade>=</span> <span class="token function" data-v-b392aade>getQueryString</span><span class="token punctuation" data-v-b392aade>(</span><span class="token string" data-v-b392aade>'code'</span><span class="token punctuation" data-v-b392aade>)</span>
    <span class="token comment" data-v-b392aade>// 没有code的情况 且同时 没有openid 或者 没有wxCodeLogin的情况 都要请求授权，兼容接口拿不到hllopenid的情况</span>
    <span class="token keyword" data-v-b392aade>if</span> <span class="token punctuation" data-v-b392aade>(</span><span class="token operator" data-v-b392aade>!</span><span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>code <span class="token operator" data-v-b392aade>&amp;&amp;</span> <span class="token punctuation" data-v-b392aade>(</span><span class="token operator" data-v-b392aade>!</span><span class="token function" data-v-b392aade>getCookie</span><span class="token punctuation" data-v-b392aade>(</span><span class="token string" data-v-b392aade>'wxCodeLogin'</span> <span class="token operator" data-v-b392aade>+</span> <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>appType<span class="token punctuation" data-v-b392aade>)</span> <span class="token operator" data-v-b392aade>||</span> <span class="token operator" data-v-b392aade>!</span>localStorage<span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>getItem</span><span class="token punctuation" data-v-b392aade>(</span><span class="token string" data-v-b392aade>'hllOpenid'</span><span class="token punctuation" data-v-b392aade>)</span><span class="token punctuation" data-v-b392aade>)</span><span class="token punctuation" data-v-b392aade>)</span> <span class="token punctuation" data-v-b392aade>{</span>
      <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>wxAuthHandle</span><span class="token punctuation" data-v-b392aade>(</span><span class="token punctuation" data-v-b392aade>)</span>
    <span class="token punctuation" data-v-b392aade>}</span> <span class="token keyword" data-v-b392aade>else</span> <span class="token keyword" data-v-b392aade>if</span> <span class="token punctuation" data-v-b392aade>(</span><span class="token operator" data-v-b392aade>!</span><span class="token function" data-v-b392aade>getCookie</span><span class="token punctuation" data-v-b392aade>(</span><span class="token string" data-v-b392aade>'wxCodeLogin'</span> <span class="token operator" data-v-b392aade>+</span> <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>appType<span class="token punctuation" data-v-b392aade>)</span> <span class="token operator" data-v-b392aade>||</span> <span class="token operator" data-v-b392aade>!</span>localStorage<span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>getItem</span><span class="token punctuation" data-v-b392aade>(</span><span class="token string" data-v-b392aade>'hllOpenid'</span><span class="token punctuation" data-v-b392aade>)</span><span class="token punctuation" data-v-b392aade>)</span> <span class="token punctuation" data-v-b392aade>{</span>
      <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>getOpenId</span><span class="token punctuation" data-v-b392aade>(</span><span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>code<span class="token punctuation" data-v-b392aade>)</span>
    <span class="token punctuation" data-v-b392aade>}</span>
  <span class="token punctuation" data-v-b392aade>}</span><span class="token punctuation" data-v-b392aade>,</span>
  <span class="token function" data-v-b392aade>wxAuthHandle</span><span class="token punctuation" data-v-b392aade>(</span><span class="token punctuation" data-v-b392aade>)</span> <span class="token punctuation" data-v-b392aade>{</span>
    <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>$toast<span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>loading</span><span class="token punctuation" data-v-b392aade>(</span><span class="token punctuation" data-v-b392aade>{</span>
      <span class="token literal-property property" data-v-b392aade>message</span><span class="token operator" data-v-b392aade>:</span> <span class="token string" data-v-b392aade>'加载中...'</span><span class="token punctuation" data-v-b392aade>,</span>
      <span class="token literal-property property" data-v-b392aade>forbidClick</span><span class="token operator" data-v-b392aade>:</span> <span class="token boolean" data-v-b392aade>true</span><span class="token punctuation" data-v-b392aade>,</span>
      <span class="token literal-property property" data-v-b392aade>loadingType</span><span class="token operator" data-v-b392aade>:</span> <span class="token string" data-v-b392aade>'spinner'</span><span class="token punctuation" data-v-b392aade>,</span>
      <span class="token literal-property property" data-v-b392aade>duration</span><span class="token operator" data-v-b392aade>:</span> <span class="token number" data-v-b392aade>0</span><span class="token punctuation" data-v-b392aade>,</span>
    <span class="token punctuation" data-v-b392aade>}</span><span class="token punctuation" data-v-b392aade>)</span>
    <span class="token keyword" data-v-b392aade>const</span> appid <span class="token operator" data-v-b392aade>=</span> <span class="token string" data-v-b392aade>'xxx'</span> <span class="token comment" data-v-b392aade>// 公众号的appId</span>
    <span class="token keyword" data-v-b392aade>const</span> redirectUrl <span class="token operator" data-v-b392aade>=</span> <span class="token template-string" data-v-b392aade><span class="token template-punctuation string" data-v-b392aade>`</span><span class="token string" data-v-b392aade>xxx/#/login?appType=</span><span class="token interpolation" data-v-b392aade><span class="token interpolation-punctuation punctuation" data-v-b392aade>${</span><span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>appType<span class="token interpolation-punctuation punctuation" data-v-b392aade>}</span></span><span class="token template-punctuation string" data-v-b392aade>`</span></span> <span class="token comment" data-v-b392aade>// 回调的页面。即登陆页url</span>
    <span class="token comment" data-v-b392aade>// 主动授权</span>
    window<span class="token punctuation" data-v-b392aade>.</span>location<span class="token punctuation" data-v-b392aade>.</span>href <span class="token operator" data-v-b392aade>=</span> <span class="token template-string" data-v-b392aade><span class="token template-punctuation string" data-v-b392aade>`</span><span class="token string" data-v-b392aade>https://open.weixin.qq.com/connect/oauth2/authorize?appid=</span><span class="token interpolation" data-v-b392aade><span class="token interpolation-punctuation punctuation" data-v-b392aade>${</span>appid<span class="token interpolation-punctuation punctuation" data-v-b392aade>}</span></span><span class="token string" data-v-b392aade>&amp;redirect_uri=</span><span class="token interpolation" data-v-b392aade><span class="token interpolation-punctuation punctuation" data-v-b392aade>${</span>redirectUrl<span class="token interpolation-punctuation punctuation" data-v-b392aade>}</span></span><span class="token string" data-v-b392aade>&amp;response_type=code&amp;scope=snsapi_userinfo&amp;state=#wechat_redirect</span><span class="token template-punctuation string" data-v-b392aade>`</span></span>
  <span class="token punctuation" data-v-b392aade>}</span><span class="token punctuation" data-v-b392aade>,</span>
  <span class="token comment" data-v-b392aade>// 通过code获取openid</span>
  <span class="token function" data-v-b392aade>getOpenId</span><span class="token punctuation" data-v-b392aade>(</span><span class="token parameter" data-v-b392aade>code</span><span class="token punctuation" data-v-b392aade>)</span> <span class="token punctuation" data-v-b392aade>{</span>
    <span class="token keyword" data-v-b392aade>const</span> nowTime <span class="token operator" data-v-b392aade>=</span> <span class="token function" data-v-b392aade>Number</span><span class="token punctuation" data-v-b392aade>(</span><span class="token keyword" data-v-b392aade>new</span> <span class="token class-name" data-v-b392aade>Date</span><span class="token punctuation" data-v-b392aade>(</span><span class="token punctuation" data-v-b392aade>)</span><span class="token punctuation" data-v-b392aade>)</span> <span class="token operator" data-v-b392aade>/</span> <span class="token number" data-v-b392aade>1000</span>
    <span class="token keyword" data-v-b392aade>let</span> retryCount <span class="token operator" data-v-b392aade>=</span> <span class="token function" data-v-b392aade>parseInt</span><span class="token punctuation" data-v-b392aade>(</span><span class="token function" data-v-b392aade>getCookie</span><span class="token punctuation" data-v-b392aade>(</span><span class="token string" data-v-b392aade>'retryCount'</span><span class="token punctuation" data-v-b392aade>)</span> <span class="token operator" data-v-b392aade>||</span> <span class="token number" data-v-b392aade>1</span><span class="token punctuation" data-v-b392aade>)</span>
    <span class="token keyword" data-v-b392aade>const</span> retryTime <span class="token operator" data-v-b392aade>=</span> <span class="token function" data-v-b392aade>parseInt</span><span class="token punctuation" data-v-b392aade>(</span><span class="token function" data-v-b392aade>getCookie</span><span class="token punctuation" data-v-b392aade>(</span><span class="token string" data-v-b392aade>'retryTime'</span><span class="token punctuation" data-v-b392aade>)</span> <span class="token operator" data-v-b392aade>||</span> nowTime<span class="token punctuation" data-v-b392aade>)</span>
    <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>$toast<span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>loading</span><span class="token punctuation" data-v-b392aade>(</span><span class="token punctuation" data-v-b392aade>{</span>
      <span class="token literal-property property" data-v-b392aade>message</span><span class="token operator" data-v-b392aade>:</span> <span class="token string" data-v-b392aade>'加载中...'</span><span class="token punctuation" data-v-b392aade>,</span>
      <span class="token literal-property property" data-v-b392aade>forbidClick</span><span class="token operator" data-v-b392aade>:</span> <span class="token boolean" data-v-b392aade>true</span><span class="token punctuation" data-v-b392aade>,</span>
      <span class="token literal-property property" data-v-b392aade>loadingType</span><span class="token operator" data-v-b392aade>:</span> <span class="token string" data-v-b392aade>'spinner'</span><span class="token punctuation" data-v-b392aade>,</span>
      <span class="token literal-property property" data-v-b392aade>duration</span><span class="token operator" data-v-b392aade>:</span> <span class="token number" data-v-b392aade>0</span><span class="token punctuation" data-v-b392aade>,</span>
    <span class="token punctuation" data-v-b392aade>}</span><span class="token punctuation" data-v-b392aade>)</span>
    <span class="token function" data-v-b392aade>request</span><span class="token punctuation" data-v-b392aade>(</span><span class="token template-string" data-v-b392aade><span class="token template-punctuation string" data-v-b392aade>`</span><span class="token string" data-v-b392aade>/hualala/vip/sso/getWxInfo/</span><span class="token interpolation" data-v-b392aade><span class="token interpolation-punctuation punctuation" data-v-b392aade>${</span>code<span class="token interpolation-punctuation punctuation" data-v-b392aade>}</span></span><span class="token template-punctuation string" data-v-b392aade>`</span></span><span class="token punctuation" data-v-b392aade>)</span>
      <span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>then</span><span class="token punctuation" data-v-b392aade>(</span><span class="token parameter" data-v-b392aade>res</span> <span class="token operator" data-v-b392aade>=&gt;</span> <span class="token punctuation" data-v-b392aade>{</span>
        <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>$toast<span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>clear</span><span class="token punctuation" data-v-b392aade>(</span><span class="token punctuation" data-v-b392aade>)</span>
        <span class="token keyword" data-v-b392aade>if</span> <span class="token punctuation" data-v-b392aade>(</span>
          res<span class="token punctuation" data-v-b392aade>.</span>msg <span class="token operator" data-v-b392aade>===</span> <span class="token string" data-v-b392aade>'获取OpenId失败'</span> <span class="token operator" data-v-b392aade>&amp;&amp;</span>
          <span class="token punctuation" data-v-b392aade>(</span>retryCount <span class="token operator" data-v-b392aade>&lt;</span> <span class="token constant" data-v-b392aade>WX_AUTO_LOGIN_RETRY_COUNT</span> <span class="token operator" data-v-b392aade>||</span> nowTime <span class="token operator" data-v-b392aade>-</span> retryTime <span class="token operator" data-v-b392aade>&gt;</span> <span class="token constant" data-v-b392aade>WX_AUTO_LOGIN_RETRY_TIME</span><span class="token punctuation" data-v-b392aade>)</span>
        <span class="token punctuation" data-v-b392aade>)</span> <span class="token punctuation" data-v-b392aade>{</span>
          <span class="token keyword" data-v-b392aade>if</span> <span class="token punctuation" data-v-b392aade>(</span>nowTime <span class="token operator" data-v-b392aade>-</span> retryTime <span class="token operator" data-v-b392aade>&gt;</span> <span class="token constant" data-v-b392aade>WX_AUTO_LOGIN_RETRY_TIME</span><span class="token punctuation" data-v-b392aade>)</span> <span class="token punctuation" data-v-b392aade>{</span>
            <span class="token function" data-v-b392aade>setCookie</span><span class="token punctuation" data-v-b392aade>(</span><span class="token string" data-v-b392aade>'retryCount'</span><span class="token punctuation" data-v-b392aade>,</span> <span class="token number" data-v-b392aade>1</span><span class="token punctuation" data-v-b392aade>)</span>
          <span class="token punctuation" data-v-b392aade>}</span> <span class="token keyword" data-v-b392aade>else</span> <span class="token punctuation" data-v-b392aade>{</span>
            retryCount<span class="token operator" data-v-b392aade>++</span>
            <span class="token function" data-v-b392aade>setCookie</span><span class="token punctuation" data-v-b392aade>(</span><span class="token string" data-v-b392aade>'retryCount'</span><span class="token punctuation" data-v-b392aade>,</span> retryCount<span class="token punctuation" data-v-b392aade>)</span>
          <span class="token punctuation" data-v-b392aade>}</span>
          <span class="token function" data-v-b392aade>setCookie</span><span class="token punctuation" data-v-b392aade>(</span><span class="token string" data-v-b392aade>'retryTime'</span><span class="token punctuation" data-v-b392aade>,</span> nowTime<span class="token punctuation" data-v-b392aade>)</span>
          <span class="token function" data-v-b392aade>setCookie</span><span class="token punctuation" data-v-b392aade>(</span><span class="token string" data-v-b392aade>'wxCodeLogin'</span> <span class="token operator" data-v-b392aade>+</span> <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>appType<span class="token punctuation" data-v-b392aade>,</span> <span class="token string" data-v-b392aade>''</span><span class="token punctuation" data-v-b392aade>)</span>
          <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>wxAuthHandle</span><span class="token punctuation" data-v-b392aade>(</span><span class="token punctuation" data-v-b392aade>)</span>
          <span class="token keyword" data-v-b392aade>return</span>
        <span class="token punctuation" data-v-b392aade>}</span>
        <span class="token keyword" data-v-b392aade>if</span> <span class="token punctuation" data-v-b392aade>(</span>res<span class="token punctuation" data-v-b392aade>.</span>code <span class="token operator" data-v-b392aade>===</span> <span class="token number" data-v-b392aade>0</span> <span class="token operator" data-v-b392aade>&amp;&amp;</span> res<span class="token punctuation" data-v-b392aade>.</span>data<span class="token punctuation" data-v-b392aade>)</span> <span class="token punctuation" data-v-b392aade>{</span>
          localStorage<span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>setItem</span><span class="token punctuation" data-v-b392aade>(</span><span class="token string" data-v-b392aade>'hllOpenid'</span><span class="token punctuation" data-v-b392aade>,</span> res<span class="token punctuation" data-v-b392aade>.</span>data<span class="token punctuation" data-v-b392aade>.</span>openId<span class="token punctuation" data-v-b392aade>)</span>
          <span class="token function" data-v-b392aade>setCookie</span><span class="token punctuation" data-v-b392aade>(</span><span class="token string" data-v-b392aade>'wxCodeLogin'</span> <span class="token operator" data-v-b392aade>+</span> <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>appType<span class="token punctuation" data-v-b392aade>,</span> <span class="token string" data-v-b392aade>'true'</span><span class="token punctuation" data-v-b392aade>)</span>
        <span class="token punctuation" data-v-b392aade>}</span> <span class="token keyword" data-v-b392aade>else</span> <span class="token punctuation" data-v-b392aade>{</span>
          <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>$toast</span><span class="token punctuation" data-v-b392aade>(</span>res<span class="token punctuation" data-v-b392aade>.</span>msg<span class="token punctuation" data-v-b392aade>)</span>
        <span class="token punctuation" data-v-b392aade>}</span>
      <span class="token punctuation" data-v-b392aade>}</span><span class="token punctuation" data-v-b392aade>)</span>
      <span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>catch</span><span class="token punctuation" data-v-b392aade>(</span><span class="token parameter" data-v-b392aade>e</span> <span class="token operator" data-v-b392aade>=&gt;</span> <span class="token punctuation" data-v-b392aade>{</span>
        console<span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>log</span><span class="token punctuation" data-v-b392aade>(</span><span class="token string" data-v-b392aade>'getOpenId -&gt; e'</span><span class="token punctuation" data-v-b392aade>,</span> e<span class="token punctuation" data-v-b392aade>)</span>
      <span class="token punctuation" data-v-b392aade>}</span><span class="token punctuation" data-v-b392aade>)</span>
  <span class="token punctuation" data-v-b392aade>}</span><span class="token punctuation" data-v-b392aade>,</span>
<span class="token punctuation" data-v-b392aade>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-b392aade><span class="line-number" data-v-b392aade>1</span><br data-v-b392aade><span class="line-number" data-v-b392aade>2</span><br data-v-b392aade><span class="line-number" data-v-b392aade>3</span><br data-v-b392aade><span class="line-number" data-v-b392aade>4</span><br data-v-b392aade><span class="line-number" data-v-b392aade>5</span><br data-v-b392aade><span class="line-number" data-v-b392aade>6</span><br data-v-b392aade><span class="line-number" data-v-b392aade>7</span><br data-v-b392aade><span class="line-number" data-v-b392aade>8</span><br data-v-b392aade><span class="line-number" data-v-b392aade>9</span><br data-v-b392aade><span class="line-number" data-v-b392aade>10</span><br data-v-b392aade><span class="line-number" data-v-b392aade>11</span><br data-v-b392aade><span class="line-number" data-v-b392aade>12</span><br data-v-b392aade><span class="line-number" data-v-b392aade>13</span><br data-v-b392aade><span class="line-number" data-v-b392aade>14</span><br data-v-b392aade><span class="line-number" data-v-b392aade>15</span><br data-v-b392aade><span class="line-number" data-v-b392aade>16</span><br data-v-b392aade><span class="line-number" data-v-b392aade>17</span><br data-v-b392aade><span class="line-number" data-v-b392aade>18</span><br data-v-b392aade><span class="line-number" data-v-b392aade>19</span><br data-v-b392aade><span class="line-number" data-v-b392aade>20</span><br data-v-b392aade><span class="line-number" data-v-b392aade>21</span><br data-v-b392aade><span class="line-number" data-v-b392aade>22</span><br data-v-b392aade><span class="line-number" data-v-b392aade>23</span><br data-v-b392aade><span class="line-number" data-v-b392aade>24</span><br data-v-b392aade><span class="line-number" data-v-b392aade>25</span><br data-v-b392aade><span class="line-number" data-v-b392aade>26</span><br data-v-b392aade><span class="line-number" data-v-b392aade>27</span><br data-v-b392aade><span class="line-number" data-v-b392aade>28</span><br data-v-b392aade><span class="line-number" data-v-b392aade>29</span><br data-v-b392aade><span class="line-number" data-v-b392aade>30</span><br data-v-b392aade><span class="line-number" data-v-b392aade>31</span><br data-v-b392aade><span class="line-number" data-v-b392aade>32</span><br data-v-b392aade><span class="line-number" data-v-b392aade>33</span><br data-v-b392aade><span class="line-number" data-v-b392aade>34</span><br data-v-b392aade><span class="line-number" data-v-b392aade>35</span><br data-v-b392aade><span class="line-number" data-v-b392aade>36</span><br data-v-b392aade><span class="line-number" data-v-b392aade>37</span><br data-v-b392aade><span class="line-number" data-v-b392aade>38</span><br data-v-b392aade><span class="line-number" data-v-b392aade>39</span><br data-v-b392aade><span class="line-number" data-v-b392aade>40</span><br data-v-b392aade><span class="line-number" data-v-b392aade>41</span><br data-v-b392aade><span class="line-number" data-v-b392aade>42</span><br data-v-b392aade><span class="line-number" data-v-b392aade>43</span><br data-v-b392aade><span class="line-number" data-v-b392aade>44</span><br data-v-b392aade><span class="line-number" data-v-b392aade>45</span><br data-v-b392aade><span class="line-number" data-v-b392aade>46</span><br data-v-b392aade><span class="line-number" data-v-b392aade>47</span><br data-v-b392aade><span class="line-number" data-v-b392aade>48</span><br data-v-b392aade><span class="line-number" data-v-b392aade>49</span><br data-v-b392aade><span class="line-number" data-v-b392aade>50</span><br data-v-b392aade><span class="line-number" data-v-b392aade>51</span><br data-v-b392aade><span class="line-number" data-v-b392aade>52</span><br data-v-b392aade><span class="line-number" data-v-b392aade>53</span><br data-v-b392aade><span class="line-number" data-v-b392aade>54</span><br data-v-b392aade><span class="line-number" data-v-b392aade>55</span><br data-v-b392aade><span class="line-number" data-v-b392aade>56</span><br data-v-b392aade><span class="line-number" data-v-b392aade>57</span><br data-v-b392aade><span class="line-number" data-v-b392aade>58</span><br data-v-b392aade><span class="line-number" data-v-b392aade>59</span><br data-v-b392aade><span class="line-number" data-v-b392aade>60</span><br data-v-b392aade><span class="line-number" data-v-b392aade>61</span><br data-v-b392aade><span class="line-number" data-v-b392aade>62</span><br data-v-b392aade><span class="line-number" data-v-b392aade>63</span><br data-v-b392aade><span class="line-number" data-v-b392aade>64</span><br data-v-b392aade><span class="line-number" data-v-b392aade>65</span><br data-v-b392aade><span class="line-number" data-v-b392aade>66</span><br data-v-b392aade><span class="line-number" data-v-b392aade>67</span><br data-v-b392aade><span class="line-number" data-v-b392aade>68</span><br data-v-b392aade><span class="line-number" data-v-b392aade>69</span><br data-v-b392aade><span class="line-number" data-v-b392aade>70</span><br data-v-b392aade><span class="line-number" data-v-b392aade>71</span><br data-v-b392aade></div></div><p data-v-b392aade><img src="/assets/img/11.3a872b53.png" alt="微信授权" data-v-b392aade></p> <p data-v-b392aade>绑定页面，静默授权的处理和登陆页基本一致</p> <div class="language-js line-numbers-mode" data-v-b392aade><pre class="language-js" data-v-b392aade><code data-v-b392aade><span class="token function" data-v-b392aade>created</span><span class="token punctuation" data-v-b392aade>(</span><span class="token punctuation" data-v-b392aade>)</span> <span class="token punctuation" data-v-b392aade>{</span>
  <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>getCode</span><span class="token punctuation" data-v-b392aade>(</span><span class="token punctuation" data-v-b392aade>)</span>
<span class="token punctuation" data-v-b392aade>}</span><span class="token punctuation" data-v-b392aade>,</span>
<span class="token function" data-v-b392aade>getCode</span><span class="token punctuation" data-v-b392aade>(</span><span class="token punctuation" data-v-b392aade>)</span> <span class="token punctuation" data-v-b392aade>{</span>
  <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>code <span class="token operator" data-v-b392aade>=</span> <span class="token function" data-v-b392aade>getQueryString</span><span class="token punctuation" data-v-b392aade>(</span><span class="token string" data-v-b392aade>'code'</span><span class="token punctuation" data-v-b392aade>)</span>
  <span class="token keyword" data-v-b392aade>if</span> <span class="token punctuation" data-v-b392aade>(</span><span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>code <span class="token operator" data-v-b392aade>===</span> <span class="token keyword" data-v-b392aade>null</span> <span class="token operator" data-v-b392aade>||</span> <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>code <span class="token operator" data-v-b392aade>===</span> <span class="token string" data-v-b392aade>''</span><span class="token punctuation" data-v-b392aade>)</span> <span class="token punctuation" data-v-b392aade>{</span>
    <span class="token keyword" data-v-b392aade>const</span> appid <span class="token operator" data-v-b392aade>=</span> <span class="token string" data-v-b392aade>'xxx'</span> <span class="token comment" data-v-b392aade>// appid</span>
    <span class="token keyword" data-v-b392aade>const</span> redirectUrl <span class="token operator" data-v-b392aade>=</span> <span class="token template-string" data-v-b392aade><span class="token template-punctuation string" data-v-b392aade>`</span><span class="token string" data-v-b392aade>xxx/#/bind?appType=</span><span class="token interpolation" data-v-b392aade><span class="token interpolation-punctuation punctuation" data-v-b392aade>${</span><span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>appType<span class="token interpolation-punctuation punctuation" data-v-b392aade>}</span></span><span class="token template-punctuation string" data-v-b392aade>`</span></span> <span class="token comment" data-v-b392aade>// 绑定页面回调</span>
    <span class="token punctuation" data-v-b392aade>)</span>
    <span class="token comment" data-v-b392aade>// 静默授权</span>
    window<span class="token punctuation" data-v-b392aade>.</span>location<span class="token punctuation" data-v-b392aade>.</span>href <span class="token operator" data-v-b392aade>=</span> <span class="token template-string" data-v-b392aade><span class="token template-punctuation string" data-v-b392aade>`</span><span class="token string" data-v-b392aade>https://open.weixin.qq.com/connect/oauth2/authorize?appid=</span><span class="token interpolation" data-v-b392aade><span class="token interpolation-punctuation punctuation" data-v-b392aade>${</span>appid<span class="token interpolation-punctuation punctuation" data-v-b392aade>}</span></span><span class="token string" data-v-b392aade>&amp;redirect_uri=</span><span class="token interpolation" data-v-b392aade><span class="token interpolation-punctuation punctuation" data-v-b392aade>${</span>redirectUrl<span class="token interpolation-punctuation punctuation" data-v-b392aade>}</span></span><span class="token string" data-v-b392aade>&amp;response_type=code&amp;scope=snsapi_base&amp;state=123#wechat_redirect</span><span class="token template-punctuation string" data-v-b392aade>`</span></span>
  <span class="token punctuation" data-v-b392aade>}</span> <span class="token keyword" data-v-b392aade>else</span> <span class="token punctuation" data-v-b392aade>{</span>
    <span class="token keyword" data-v-b392aade>if</span> <span class="token punctuation" data-v-b392aade>(</span>sessionStorage<span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>getItem</span><span class="token punctuation" data-v-b392aade>(</span><span class="token string" data-v-b392aade>'wxcode'</span><span class="token punctuation" data-v-b392aade>)</span> <span class="token operator" data-v-b392aade>===</span> <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>code<span class="token punctuation" data-v-b392aade>)</span> <span class="token punctuation" data-v-b392aade>{</span>
      <span class="token comment" data-v-b392aade>// 授权成功，进入业务逻辑处理：获取绑定列表</span>
      <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>handleQueryInfo</span><span class="token punctuation" data-v-b392aade>(</span><span class="token punctuation" data-v-b392aade>)</span>
    <span class="token punctuation" data-v-b392aade>}</span> <span class="token keyword" data-v-b392aade>else</span> <span class="token punctuation" data-v-b392aade>{</span>
      <span class="token comment" data-v-b392aade>// 获取openId</span>
      <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>getOpenId</span><span class="token punctuation" data-v-b392aade>(</span><span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>code<span class="token punctuation" data-v-b392aade>)</span>
    <span class="token punctuation" data-v-b392aade>}</span>
  <span class="token punctuation" data-v-b392aade>}</span>
<span class="token punctuation" data-v-b392aade>}</span><span class="token punctuation" data-v-b392aade>,</span>
<span class="token comment" data-v-b392aade>// 通过code获取openid</span>
<span class="token function" data-v-b392aade>getOpenId</span><span class="token punctuation" data-v-b392aade>(</span><span class="token parameter" data-v-b392aade>code</span><span class="token punctuation" data-v-b392aade>)</span> <span class="token punctuation" data-v-b392aade>{</span>
  <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>$toast<span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>loading</span><span class="token punctuation" data-v-b392aade>(</span><span class="token punctuation" data-v-b392aade>)</span>
  <span class="token function" data-v-b392aade>request</span><span class="token punctuation" data-v-b392aade>(</span><span class="token template-string" data-v-b392aade><span class="token template-punctuation string" data-v-b392aade>`</span><span class="token string" data-v-b392aade>/hualala/vip/sso/getHualalaOpenId/</span><span class="token interpolation" data-v-b392aade><span class="token interpolation-punctuation punctuation" data-v-b392aade>${</span>code<span class="token interpolation-punctuation punctuation" data-v-b392aade>}</span></span><span class="token template-punctuation string" data-v-b392aade>`</span></span><span class="token punctuation" data-v-b392aade>)</span><span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>then</span><span class="token punctuation" data-v-b392aade>(</span><span class="token parameter" data-v-b392aade>res</span> <span class="token operator" data-v-b392aade>=&gt;</span> <span class="token punctuation" data-v-b392aade>{</span>
    <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span>$toast<span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>clear</span><span class="token punctuation" data-v-b392aade>(</span><span class="token punctuation" data-v-b392aade>)</span>
    <span class="token keyword" data-v-b392aade>if</span> <span class="token punctuation" data-v-b392aade>(</span>res<span class="token punctuation" data-v-b392aade>.</span>code <span class="token operator" data-v-b392aade>===</span> <span class="token number" data-v-b392aade>0</span><span class="token punctuation" data-v-b392aade>)</span> <span class="token punctuation" data-v-b392aade>{</span>
      localStorage<span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>setItem</span><span class="token punctuation" data-v-b392aade>(</span><span class="token string" data-v-b392aade>'hllOpenid'</span><span class="token punctuation" data-v-b392aade>,</span> res<span class="token punctuation" data-v-b392aade>.</span>data<span class="token punctuation" data-v-b392aade>)</span>
      sessionStorage<span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>setItem</span><span class="token punctuation" data-v-b392aade>(</span><span class="token string" data-v-b392aade>'wxcode'</span><span class="token punctuation" data-v-b392aade>,</span> code<span class="token punctuation" data-v-b392aade>)</span>
      <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>handleQueryInfo</span><span class="token punctuation" data-v-b392aade>(</span><span class="token punctuation" data-v-b392aade>)</span>
    <span class="token punctuation" data-v-b392aade>}</span> <span class="token keyword" data-v-b392aade>else</span> <span class="token punctuation" data-v-b392aade>{</span>
      <span class="token keyword" data-v-b392aade>this</span><span class="token punctuation" data-v-b392aade>.</span><span class="token function" data-v-b392aade>$toast</span><span class="token punctuation" data-v-b392aade>(</span>res<span class="token punctuation" data-v-b392aade>.</span>msg<span class="token punctuation" data-v-b392aade>)</span>
    <span class="token punctuation" data-v-b392aade>}</span>
  <span class="token punctuation" data-v-b392aade>}</span><span class="token punctuation" data-v-b392aade>)</span>
<span class="token punctuation" data-v-b392aade>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-b392aade><span class="line-number" data-v-b392aade>1</span><br data-v-b392aade><span class="line-number" data-v-b392aade>2</span><br data-v-b392aade><span class="line-number" data-v-b392aade>3</span><br data-v-b392aade><span class="line-number" data-v-b392aade>4</span><br data-v-b392aade><span class="line-number" data-v-b392aade>5</span><br data-v-b392aade><span class="line-number" data-v-b392aade>6</span><br data-v-b392aade><span class="line-number" data-v-b392aade>7</span><br data-v-b392aade><span class="line-number" data-v-b392aade>8</span><br data-v-b392aade><span class="line-number" data-v-b392aade>9</span><br data-v-b392aade><span class="line-number" data-v-b392aade>10</span><br data-v-b392aade><span class="line-number" data-v-b392aade>11</span><br data-v-b392aade><span class="line-number" data-v-b392aade>12</span><br data-v-b392aade><span class="line-number" data-v-b392aade>13</span><br data-v-b392aade><span class="line-number" data-v-b392aade>14</span><br data-v-b392aade><span class="line-number" data-v-b392aade>15</span><br data-v-b392aade><span class="line-number" data-v-b392aade>16</span><br data-v-b392aade><span class="line-number" data-v-b392aade>17</span><br data-v-b392aade><span class="line-number" data-v-b392aade>18</span><br data-v-b392aade><span class="line-number" data-v-b392aade>19</span><br data-v-b392aade><span class="line-number" data-v-b392aade>20</span><br data-v-b392aade><span class="line-number" data-v-b392aade>21</span><br data-v-b392aade><span class="line-number" data-v-b392aade>22</span><br data-v-b392aade><span class="line-number" data-v-b392aade>23</span><br data-v-b392aade><span class="line-number" data-v-b392aade>24</span><br data-v-b392aade><span class="line-number" data-v-b392aade>25</span><br data-v-b392aade><span class="line-number" data-v-b392aade>26</span><br data-v-b392aade><span class="line-number" data-v-b392aade>27</span><br data-v-b392aade><span class="line-number" data-v-b392aade>28</span><br data-v-b392aade><span class="line-number" data-v-b392aade>29</span><br data-v-b392aade><span class="line-number" data-v-b392aade>30</span><br data-v-b392aade><span class="line-number" data-v-b392aade>31</span><br data-v-b392aade><span class="line-number" data-v-b392aade>32</span><br data-v-b392aade><span class="line-number" data-v-b392aade>33</span><br data-v-b392aade><span class="line-number" data-v-b392aade>34</span><br data-v-b392aade><span class="line-number" data-v-b392aade>35</span><br data-v-b392aade></div></div><h2 id="统一登陆banner" data-v-b392aade><a href="#统一登陆banner" class="header-anchor" data-v-b392aade>#</a> 统一登陆Banner</h2> <p data-v-b392aade>至此，已经实现把登陆相关页面与逻辑从业务中抽离出来，统一维护了。已经胜利在望。接下来只需要在业务H5引入Banner即可</p> <p data-v-b392aade><img src="/assets/img/12.50e24ed1.png" alt="banner" data-v-b392aade></p> <p data-v-b392aade>思考中，设计中。。。</p> <p data-v-b392aade><a href="/project/H5/h5-sdk.html#三、loginsdk" data-v-b392aade>loginSdk</a></p> <h2 id="总结" data-v-b392aade><a href="#总结" class="header-anchor" data-v-b392aade>#</a> 总结</h2> <p data-v-b392aade>在开发H5时，每个业务H5都要重复开发一套登陆页，导致开发效率低，维护困难。希望把登陆相关页面与逻辑从业务中抽离出来，统一维护。我负责登陆H5界面开发。使用Vue开发H5界面；登陆页通过接入微信网页主动授权，实现用户openId关联用户信息。目前统一登陆已接入20+ 业务H5，大大提高了H5开发效率。</p> <p data-v-b392aade>参考：
<a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html" target="_blank" rel="noopener noreferrer" data-v-b392aade>微信网页开发 /网页授权<span data-v-b392aade><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/9/2021, 11:31:39 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/project/B/common-web-system.html" class="prev">
        微前端系统
      </a></span> <span class="next"><a href="/project/H5/h5-sdk.html">
        h5-sdk
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.e8c3aa62.js" defer></script><script src="/assets/js/2.1d5e0d04.js" defer></script><script src="/assets/js/8.c0da64f7.js" defer></script>
  </body>
</html>
